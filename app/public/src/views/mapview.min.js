PivotViewer.Utils.loadScript("lib/wicket/wicket.min.js");PivotViewer.Utils.loadCSS("lib/leaflet/leaflet.css");PivotViewer.Utils.loadScript("lib/leaflet/leaflet.js");PivotViewer.Views.MapView=PivotViewer.Views.IPivotViewerView.subClass({init:function(){this._super();this.locCache=[];this.map=null;this.markers=[];this.overlay;this.overlayBaseImageUrl=null;this.itemsToGeocode=[];this.startGeocode;this.geocodeZero;this.applyBookmark=!1;this.mapService=null;this.APIKey=null;this.geocodeService=null;this.geometryValue=null;this.areaValues=[];this.areaObj;this.buckets=[];this.icons=[];this.iconsSelected=[];this.selectedMarker=null;this.selectedBucket=-1;var n=this;$.subscribe("/PivotViewer/Views/Item/Selected",function(t){n.isActive&&n.selectMarker(t.item)})},setup:function(n,t,i,r){this.width=n;this.height=t;this.offsetX=i;this.offsetY=r;this.currentWidth=this.width;this.currentHeight=this.height;this.currentOffsetX=this.offsetX;this.currentOffsetY=this.offsetY;this.localStorage=Modernizr.localstorage?!0:!1;window.mapView=this},apiLoaded:function(){var n=this;this.map=new google.maps.Map(document.getElementById("pv-map-canvas"));google.maps.event.addListener(this.map,"zoom_changed",function(){$.publish("/PivotViewer/Views/Item/Updated",null);n.getOverlay()});google.maps.event.addListener(this.map,"center_changed",function(){$.publish("/PivotViewer/Views/Item/Updated",null);n.getOverlay()});this.icons=["lib/leaflet/images/Red.png","lib/leaflet/images/Yellow.png","lib/leaflet/images/DarkGreen.png","lib/leaflet/images/Blue.png","lib/leaflet/images/Purple.png","lib/leaflet/images/Orange.png","lib/leaflet/images/Pink.png","lib/leaflet/images/Sky.png","lib/leaflet/images/Lime.png","lib/leaflet/images/Gold.png","lib/leaflet/images/Green.png"];this.iconsSelected=["lib/leaflet/images/RedDot.png","lib/leaflet/images/YellowDot.png","lib/leaflet/images/DarkGreenDot.png","lib/leaflet/images/BlueDot.png","lib/leaflet/images/PurpleDot.png","lib/leaflet/images/OrangeDot.png","lib/leaflet/images/PinkDot.png","lib/leaflet/images/SkyDot.png","lib/leaflet/images/LimeDot.png","lib/leaflet/images/GoldDot.png","lib/leaflet/images/GreenDot.png"];this.clearMarkers=function(){for(var t,n=0;n<this.tiles.length;n++)t=this.tiles[n].marker,t!=undefined&&t.setMap(null)};this.selectMarker=function(t){var i=n.getBucketNumber(t),r;t.marker==n.selectedMarker?(t.marker.setIcon(n.icons[i]),n.selected=null,n.selectedMarker.setZIndex(0),n.selectedMarker=null,n.selectedBucket=-1,$(".pv-toolbarpanel-info").empty(),$(".pv-altinfopanel").fadeIn()):(t.marker.setIcon(n.iconsSelected[i]),t.marker.setZIndex(1e9),n.selected=t,n.selectedMarker!=null&&(n.selectedMarker.setZIndex(0),n.selectedMarker.setIcon(n.icons[n.selectedBucket])),n.selectedMarker=t.marker,n.selectedBucket=i,n.map.panTo(t.loc),$(".pv-toolbarpanel-info").empty(),r="<img style='height:15px;width:auto' src='"+n.icons[i]+"'><\/img>",r+=n.buckets[i].startRange==n.buckets[i].endRange?n.buckets[i].startRange:n.buckets[i].startRange+" to "+n.buckets[i].endRange,$(".pv-toolbarpanel-info").append(r),$(".pv-altinfopanel").hide())};this.newMarker=function(n){n.marker=new google.maps.Marker({position:n.loc,map:this.map,title:n.item.name});n.marker.setIcon(this.icons[this.buckets.ids[n.item.id]]);google.maps.event.addListener(n.marker,"click",function(n){return function(){$.publish("/PivotViewer/Views/Item/Selected",[{item:n}])}}(n))};this.refitBounds=function(){var t=new google.maps.LatLngBounds,n;for(i=0;i<this.filterList.length;i++)n=this.filterList[i],n.loc!=undefined&&(Settings.showMissing||!n.missing)&&t.extend(n.marker.position);this.map.fitBounds(t)};this.getOverlay=function(){var n=this.map.getBounds(),r;if(n){var t=n.getSouthWest(),i=n.getNorthEast(),u=$("#pv-map-canvas").width(),f=$("#pv-map-canvas").height();this.overlayBaseImageUrl!=null&&(this.overlay&&this.overlay.setMap(null),r=this.overlayBaseImageUrl+"&bbox="+t.lng()+","+t.lat()+","+i.lng()+","+i.lat()+"&width="+u+"&height="+f,this.overlay=new google.maps.GroundOverlay(r,n,{opacity:.4}),this.overlay.setMap(this.map))}};$(".pv-mainpanel").append("<div class='pv-altinfopanel' id='pv-altinfopanel'><\/div>");$(".pv-altinfopanel").css("left",$(".pv-mainpanel").offset().left+$(".pv-mainpanel").width()-205+"px").css("height",$(window).height()-$(".pv-toolbarpanel").height()-58+"px");this.activate()},setOptions:function(n){var r,u,t;if($(".pv-viewpanel").append("<div class='pv-mapview-canvas' id='pv-map-canvas'><\/div>"),n.MapService==undefined||n.MapService.toLowerCase()!="openstreetmap")this.APIKey=n.GoogleAPIKey!=undefined?n.GoogleAPIKey:"AIzaSyAnPWLPKMYKQZa2g1p11d_vllwwT7CFdQg",this.mapService="google",PivotViewer.Utils.loadScript("lib/wicket/wicket-gmap3.min.js"),n.GeocodeService=="Google"?this.geocodeService="Google":GeocodeService="Nominatim";else{this.mapService="openstreetmap";this.geocodeService="Nominatim";PivotViewer.Utils.loadScript("lib/wicket/wicket-leaflet.min.js");this.map=new L.Map(document.getElementById("pv-map-canvas"));r="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";u="Map data \u00a9 OpenStreetMap contributors";this.osm=new L.TileLayer(r,{attribution:u});this.map.addLayer(this.osm);this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Red.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Yellow.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/DarkGreen.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Blue.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Purple.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Orange.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Pink.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Sky.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Lime.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Gold.png"}}));this.icons.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/Green.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/RedDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/YellowDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/DarkGreenDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/BlueDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/PurpleDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/OrangeDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/PinkDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/SkyDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/LimeDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/GoldDot.png"}}));this.iconsSelected.push(L.Icon.Default.extend({options:{iconUrl:"lib/leaflet/images/GreenDot.png"}}));t=this;this.map.on("zoomend",function(){$.publish("/PivotViewer/Views/Item/Updated",null);t.getOverlay()});this.map.on("moveend",function(){$.publish("/PivotViewer/Views/Item/Updated",null);t.getOverlay()});this.clearMarkers=function(){for(var t,n=0;n<this.tiles.length;n++)t=this.tiles[n].marker,t!=undefined&&this.map.removeLayer(t)};this.selectMarker=function(n){var i=t.getBucketNumber(n),r;n.marker==t.selectedMarker?(n.marker.setIcon(new t.icons[i]),t.selected=null,t.selectedMarker.setZIndexOffset(0),t.selectedMarker=null,t.selectedBucket=-1,$(".pv-toolbarpanel-info").empty(),$(".pv-altinfopanel").fadeIn()):(n.marker.setIcon(new t.iconsSelected[i]),n.marker.setZIndexOffset(1e9),t.selected=n,t.selectedMarker!=null&&(t.selectedMarker.setIcon(new t.icons[t.selectedBucket]),t.selectedMarker.setZIndexOffset(0)),t.selectedMarker=n.marker,t.selectedBucket=i,t.map.panTo(n.loc),$(".pv-toolbarpanel-info").empty(),r="<img style='height:15px;width:auto' src='"+n.marker._icon.src+"'><\/img>",r+=t.buckets[i].startRange==t.buckets[i].endRange?t.buckets[i].startRange:t.buckets[i].startRange+" to "+t.buckets[i].endRange,$(".pv-toolbarpanel-info").append(r),$(".pv-altinfopanel").hide())};this.newMarker=function(n){n.marker=new L.Marker(n.loc,{title:n.item.name});this.map.addLayer(n.marker);n.marker.setIcon(new this.icons[this.buckets.ids[n.item.id]]);n.marker.on("click",function(n){return function(){$.publish("/PivotViewer/Views/Item/Selected",[{item:n}])}}(n));return marker};this.refitBounds=function(){var t=[],n,r;for(i=0;i<this.filterList.length;i++)n=this.filterList[i],n.marker!=undefined&&t.push(n.marker.getLatLng());r=new L.LatLngBounds(t);this.map.fitBounds(r)};this.getOverlay=function(){var n=this.map.getBounds(),r=n.getWest(),u=n.getEast(),f=n.getNorth(),e=n.getSouth(),t=this.map.getSize(),o=t.x,s=t.y,i;this.overlayBaseImageUrl!=null&&(this.overlay&&this.map.hasLayer(this.overlay)&&this.map.removeLayer(this.overlay),i=this.overlayBaseImageUrl+"&bbox="+r+","+e+","+u+","+f+"&width="+o+"&height="+s,this.overlay=new L.imageOverlay(i,n,{opacity:.4}),this.overlay.addTo(this.map))}}n.MapOverlay!=undefined&&(this.overlayBaseImageUrl=n.MapOverlay)},activate:function(){Modernizr.canvas&&(this.mapService=="google"&&this.map==null?PivotViewer.Utils.loadScript("https://maps.googleapis.com/maps/api/js?key="+this.APIKey+"&sensor=false&callback=mapView.apiLoaded"):this._super(),$(".pv-toolbarpanel-info").fadeIn(),$(".pv-altinfopanel").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").hide(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","0"),$("#MAIN_BODY").css("overflow","auto"),$(".pv-mapview-canvas").fadeIn(),$(".pv-toolbarpanel-sort").fadeIn())},deactivate:function(){this._super();$(".pv-altinfopanel").fadeOut();$(".pv-toolbarpanel-info").fadeOut();$(".pv-mapview-canvas").fadeOut();$(".pv-toolbarpanel-sort").fadeOut()},getBucketNumber:function(n){var t=this.buckets.ids[n.item.id];return t!=undefined?t:-1},bucketize:function(n,t,i){var r,f,u;if(category=PivotCollection.getCategoryByName(i),t[0].item.getFacetByName(i)==undefined)return[{startRange:"(no info)",endRange:"(no info)",tiles:[t[0]],values:["(no info)"],startLabel:"(no info)",endLabel:"(no info)"}];for(r=t[0].item.getFacetByName(i).values[0].value,f=t.length-1;f>0;f--)if(t[f].item.getFacetByName(i)!=undefined)break;return(u=t[f].item.getFacetByName(i).values[0].value,category.isDateTime())?(r=new Date(r),u=new Date(u),u.getFullYear()-r.getFullYear()+r.getFullYear()%10>9?PivotViewer.Utils.getBuckets(t,i,function(n){var t=new Date(n.value).getFullYear();return t-t%10},function(n){var t=new Date(n.value).getFullYear();return t-t%10+"s"}):u.getFullYear()>r.getFullYear()?PivotViewer.Utils.getBuckets(t,i,function(n){return new Date(n.value).getFullYear()},function(n){return new Date(n.value).getFullYear().toString()}):u.getMonth()>r.getMonth()?PivotViewer.Utils.getBuckets(t,i,function(n){return new Date(n.value).getMonth()},function(n){var t=new Date(n.value);return PivotViewer.Utils.getMonthName(t)+" "+t.getFullYear()}):u.getDate()>r.getDate()?PivotViewer.Utils.getBuckets(t,i,function(n){return new Date(n.value).getDate()},function(n){var t=new Date(n.value);return PivotViewer.Utils.getMonthName(t)+" "+t.getDate()+", "+t.getFullYear()}):u.getHours()>r.getHours()?PivotViewer.Utils.getBuckets(t,i,function(n){return new Date(n.value).getHours()},function(n){var t=new Date(n.value);return PivotViewer.Utils.getMonthName(t)+" "+t.getDate()+", "+t.getFullYear()+" "+PivotViewer.Utils.getHour(t)+" "+PivotViewer.Utils.getMeridian(t)}):u.getMinutes()>r.getMinutes()?PivotViewer.Utils.getBuckets(t,i,function(n){return new Date(n.value).getMinutes()},function(n){var t=new Date(n);return PivotViewer.Utils.getMonthName(t)+" "+t.getDate()+", "+t.getFullYear()+" "+PivotViewer.Utils.getHour(t)+":"+t.getMinutes()+" "+PivotViewer.Utils.getMeridian(t)}):PivotViewer.Utils.getBuckets(t,i,function(n){return new Date(n.value).getSeconds()},function(n){var t=new Date(n.value);return PivotViewer.Utils.getMonthName(t)+" "+t.getDate()+", "+t.getFullYear()+" "+PivotViewer.Utils.getHour(t)+":"+t.getMinutes()+"::"+t.getSeconds()+" "+PivotViewer.Utils.getMeridian(t)})):PivotViewer.Utils.getBuckets(t,i)},filter:function(){var d=this,w=0,s,h,f,v,t,n,y,p,o,u,e,l,b,c,k,a,i,r;for(this.buckets=this.bucketize(this.tiles,this.filterList,this.sortCategory),$(".pv-toolbarpanel-info").empty(),this.selected==null&&$(".pv-altinfopanel").fadeIn(),t=0;t<PivotCollection.categories.length;t++)if(f=PivotCollection.categories[t],f.name.toUpperCase().indexOf("GEOMETRY")>=0){for(j=0;j<this.filterList.length;j++)if(o=this.filterList[j].item.getFacetByName(f.name),o!=undefined){this.geometryValue=o.values[0].value;break}if(j<this.filterList.length)break}for(t=0;t<PivotCollection.categories.length;t++)if(f=PivotCollection.categories[t],f.name.toUpperCase().indexOf("AREA")>=0)for(j=0;j<this.filterList.length;j++)if(o=this.filterList[j].item.getFacetByName(f.name),o!=undefined){this.areaValues.push({id:this.filterList[j].item.id,area:o.values[0].value});break}for(s=null,h=null,t=0;t<PivotCollection.categories.length;t++){if(f=PivotCollection.categories[t],v=f.name.toLowerCase(),v.indexOf("location")>=0){f.uiInit==!1&&PV.initUICategory(f);break}if(v.indexOf("latitude")>=0?s=f:v.indexOf("longitude")>=0&&(h=f),s!=null&&h!=null){s.uiInit==!1&&PV.initUICategory(s);h.uiInit==!1&&PV.initUICategory(h);break}}for(t=0;t<this.filterList.length;t++)if((n=this.filterList[t],Settings.showMissing||!n.missing)&&n.loc==undefined)if(y=null,p=null,s!=null&&h!=null)y=n.item.getFacetByName(s.name),p=n.item.getFacetByName(h.name),y!=undefined&&p!=undefined&&(i=y.values[0].value,r=p.values[0].value,r!=null&&i!=null&&(typeof i=="string"&&(i=parseFloat(i)),typeof r=="string"&&(r=parseFloat(r)),n.loc=new L.LatLng(i,r)));else if(f!=null){if(o=n.item.getFacetByName(f.name),o==undefined)continue;if(u=o.values[0].value,u.toLowerCase().indexOf("point(")==0)r=parseFloat(u.substring(6,u.indexOf(" ",6)-6)),i=parseFloat(u.substring(u.indexOf(" ",6)+1,u.indexOf(")")-(u.indexOf(" ")+1))),isNaN(i)||isNaN(r)||(n.loc=new L.LatLng(i,r));else if(u.indexOf(",")>-1)if(i=parseFloat(u.substring(0,u.indexOf(","))),r=parseFloat(u.substring(u.indexOf(","))),isNaN(i)||isNaN(r)){if(u.length>1){for(e=u.replace("_"," ").toUpperCase(),l=0;l<n.item.facets.length;l++)if(n.item.facets[l].name.toUpperCase().indexOf("REGION")>=0){b=n.item.facets[l].values[0].value;b.length>1&&(e=e+", "+b.replace("_"," ").toUpperCase());break}for(c=0;c<n.item.facets.length;c++)if(n.item.facets[c].name.toUpperCase().indexOf("COUNTRY")>=0){k=n.item.facets[c].values[0].value;k.length>1&&(e=e+", "+k.replace("_"," ").toUpperCase());break}if(this.locCache[e]!=undefined)n.loc=this.locCache[e];else if(this.localStorage)a=JSON.parse(localStorage.getItem(e)),a&&(i=parseFloat(a.latitude),r=parseFloat(a.longitude),isNaN(i)||isNaN(r)||(n.loc=new L.LatLng(i,r),this.locCache[e]=a));else if(w<1e3){this.itemsToGeocode[e]==undefined&&(this.itemsToGeocode[e]=[],w++);this.itemsToGeocode[e].push(n);break}}}else n.loc=new L.LatLng(i,r)}w>0&&this.getLocationsFromNames();$(".pv-mapview-canvas").css("height",this.height-12+"px");$(".pv-mapview-canvas").css("width",this.width-415+"px");this.createMap()},getButtonImage:function(){return"images/MapView.png"},getButtonImageSelected:function(){return"images/MapViewSelected.png"},getViewName:function(){return"Map View"},makeGeocodeCallBack:function(n){var t=this,i;return this.geocodeService=="Google"?function(i,r){var u=new L.LatLng(0,0),f,e;if(r==google.maps.GeocoderStatus.OK){var o=i[0].geometry.location,s=o.lat(),h=o.lng();s&&h&&(u=new L.LatLng(s,h))}for(t.locCache[n]=u,t.localStorage&&localStorage.setItem(n,JSON.stringify(u)),f=0;f<t.itemsToGeocode[n].length;f++)t.itemsToGeocode[n][f].loc=u;delete t.itemsToGeocode[n];e=new Date;(e.getTime()-t.geocodeZero.getTime())/1e3>20?(t.redrawMarkers(),t.startGeocode=new Date):(e.getTime()-t.startGeocode.getTime())/1e3>2&&(t.redrawMarkers(),t.refitBounds(),t.getOverlay(),t.startGeocode=new Date);Object.keys(t.itemsToGeocode).length==0&&t.createMap()}:function(i){var r=new L.LatLng(0,0),h=$(i).find("searchresults"),u=$(i).find("place"),e,o,f,s;for(u&&(e=$(u).attr("lat"),o=$(u).attr("lon"),e&&o&&(r=new L.LatLng(e,o))),t.locCache[u]=r,t.localStorage&&localStorage.setItem(n,JSON.stringify(r)),f=0;f<t.itemsToGeocode[n].length;f++)t.itemsToGeocode[n][f].loc=r;delete t.itemsToGeocode[n];s=new Date;(s.getTime()-t.geocodeZero.getTime())/1e3>20?(t.redrawMarkers(),t.startGeocode=new Date):(s.getTime()-t.startGeocode.getTime())/1e3>2&&(t.redrawMarkers(),t.refitBounds(),t.getOverlay(),t.startGeocode=new Date);Object.keys(t.itemsToGeocode).length==0&&t.createMap()}},geocode:function(n,t){var i,u,r;this.geocodeService=="Google"?(i=new google.maps.Geocoder,i.geocode({address:n},this.makeGeocodeCallBack(n))):(u=this,r="http://nominatim.openstreetmap.org/search?q="+encodeURIComponent(n)+"&format=xml",$.ajax({type:"GET",url:r,success:t}))},getLocationsFromNames:function(){for(var n in Object.keys(this.itemsToGeocode))this.geocode(n,this.makeGeocodeCallBack(n));this.startGeocode=new Date;this.startGeocode.setSeconds(this.startGeocode.getSeconds()+2);this.geocodeZero=new Date},createMap:function(){var t,n,i;if(this.geometryValue!=null){t=new Wkt.Wkt;try{t.read(this.geometryValue)}catch(u){try{t.read(this.geometryValue.replace("\n","").replace("\r","").replace("\t",""))}catch(r){r.name==="WKTError"&&Debug.log("Wicket could not understand the WKT string you entered. Check that you have parentheses balanced, and try removing tabs and newline characters.")}}if(n=t.toObject(this.map.defaults),Wkt.isArray(n))for(i=0;i<n.length;i++)this.map.addLayer(n[i]);else this.map.addLayer(n)}this.createMarkers();this.refitBounds();this.getOverlay();this.createLegend()},createMarkers:function(){for(this.clearMarkers&&this.clearMarkers(),i=0;i<this.filterList.length;i++){var n=this.filterList[i];n.loc!=undefined&&(Settings.showMissing||!n.missing)&&this.newMarker(n)}},drawArea:function(){var t,r=new Wkt.Wkt,n,u,i;for(this.areaObj&&this.map.removeLayer(this.areaObj),n=0;n<this.areaValues.length;n++)if(this.areaValues[n].id==this.selected.item.id){t=this.areaValues[n].area;break}if(t){u=!0;try{r.read(t)}catch(e){try{r.read(t.replace("\n","").replace("\r","").replace("\t",""))}catch(f){f.name==="WKTError"&&(Debug.log("Wicket could not understand the WKT string you entered. Check that you have parentheses balanced, and try removing tabs and newline characters."),u=!1)}}if(u)if(this.areaObj=r.toObject({color:"#990000",fillColor:"#EEFFCC",fillOpacity:.6}),Wkt.isArray(this.areaObj))for(i=0;i<this.areaObj.length;i++)this.map.addLayer(this.areaObj[i]);else this.map.addLayer(this.areaObj)}},redrawMarkers:function(){this.createMarkers();this.drawArea()},createLegend:function(){var i=$(".pv-altinfopanel").width()-32,t,n,r;for($(".pv-altinfopanel").empty(),$(".pv-altinfopanel").append("<div class='pv-legend-heading' style='height:28px' title='"+this.sortCategory+"'>"+this.sortCategory+"<\/div>"),t="<table id='pv-legend-data' style='color:#484848;'>",n=0;n<this.buckets.length;n++)r=this.mapService=="google"?this.icons[n]:(new this.icons[n]).options.iconUrl,t+="<tr><td><img src='"+r+"'><\/img><\/td>",t+=this.buckets[n].startRange==this.buckets[n].endRange?"<td><div style='overflow:hidden;white-space:nowrap;width:"+i+"px;text-overflow:ellipsis'>"+this.buckets[n].startLabel+"<\/div><\/td><\/tr>":"<td><div style='overflow:hidden;white-space:nowrap;width:"+i+"px;text-overflow:ellipsis'>"+this.buckets[n].startLabel+" to "+this.buckets[n].endLabel+"<\/div><\/td><\/tr>";t+="<\/table>";$(".pv-altinfopanel").append(t)}});