PivotViewer.Views.TileBasedView=PivotViewer.Views.IPivotViewerView.subClass({init:function(){this._super();var a=this;$.subscribe("/PivotViewer/Views/Canvas/Drag",function(b){if(a.isActive){var c=b.x,d=b.y;c>0&&a.currentOffsetX>a.offsetX?c=0:a.currentOffsetX<a.offsetX&&a.currentWidth==a.width?c=0:c<0&&a.currentOffsetX<-a.currentWidth+a.width?c=0:a.currentOffsetX+=c,d>0&&a.currentOffsetY+a.canvasHeightUIAdjusted>a.currentHeight+a.offsetY?d=0:a.currentOffsetY<a.offsetY&&a.currentHeight==a.height?d=0:d<0&&a.currentOffsetY-a.offsetY<-a.currentHeight+a.height?d=0:a.currentOffsetY+=d,0==c&&0==d||a.offsetTiles(c,d)}})},super_handleClick:function(a){if("init"==a.type)for(var b=0;b<this.filterList.length;b++){var c=this.filterList[b].item.id;if(c==a.id)return this.filterList[b]}else for(var b=0;b<this.filterList.length;b++){var c=this.filterList[b].contains(a.x,a.y);if(c>=0)return this.filterList[b]}},handleClick:function(a){return this.super_handleClick(a)},super_handleHover:function(a){if(null==this.selected)for(var b=0;b<this.filterList.length;b++){var c=this.filterList[b].contains(a.x,a.y);c>=0?this.filterList[b].setSelected(!0):this.filterList[b].setSelected(!1)}},handleHover:function(a){this.super_handleHover(a)},activate:function(){this._super(),$(".pv-toolbarpanel-zoomslider").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","1px"),$("#MAIN_BODY").css("overflow","auto"),$(".pv-toolbarpanel-sort").fadeIn(),$(".pv-canvas").fadeIn()},deactivate:function(){this._super(),$(".pv-toolbarpanel-zoomslider").fadeOut(),$(".pv-toolbarpanel-sort").fadeOut(),$(".pv-canvas").fadeOut()},offsetTiles:function(a,b){for(var c=0;c<this.filterList.length;c++)this.filterList[c]._locations[0].destinationx+=a,this.filterList[c]._locations[0].destinationy+=b},calculateDimensions:function(a,b,c,d){var e=.9,f=c*(d-e*e),g=(b+a*c)*e,h=-1*(b*a),i=(-1*g+Math.sqrt(g*g-4*f*h))/(2*f),j=Math.floor(i*c),k=Math.floor(b/j),l=a>i?Math.floor(a/i):1,m=a-l*i,n=b-k*j;return j<3&&(j=3),{Rows:k,Columns:l,TileMaxWidth:i,TileHeight:j,PaddingX:m,PaddingY:n}},getTileDimensions:function(a,b,c,d,e){var f=.9,g=c*(d-f*f),h=(b+a*c)*f,i=-1*(b*a),j=(-1*h+Math.sqrt(h*h-4*g*i))/(2*g),k=Math.floor(j*c),l=a-e.Columns*j,m=b-e.Rows*k;return{Rows:e.Rows,Columns:e.Columns,TileMaxWidth:j,TileHeight:k,PaddingX:l,PaddingY:m}}});
