function locateBucket(a){for(var b=0;b<bucketRules.length;b++)if(bucketRules[b].value[0]==a)return b}PivotViewer.Utils.loadScript("src/views/definebuckets.js");var cIndex;$(document).on("click","#new-page",function(){var a=window.open();a.document.write('<link href="style/bootstrap.css" rel="stylesheet" type="text/css" /><title>Rules Table</title><code><pre id="new-rule-result" style="position: relative;">'+$("#pv-rule-result").html()+"</pre></code>")}),$(document).on("click","#pv-rule-info",function(){var a=PivotCollection.items.length;$("#ruleModal").modal("toggle"),void 0!=bucketRules[cIndex].value[1]?$("#table_header").html("Value to be explained(X): "+bucketRules[cIndex].name+"; Values: "+bucketRules[cIndex].value[0]+" to "+bucketRules[cIndex].value[1]):$("#table_header").html("Value to be explained(X): "+bucketRules[cIndex].name+"; Values: "+bucketRules[cIndex].value[0]),$("#header_info").html("Total items with value X: "+Cs[cIndex].length+" out of "+a+" ("+Math.round(Cs[cIndex].length/a*100)+"%)");var b,c,d,e,f,g;if(b=ruleFilters[0].name,e="string"==ruleFilters[0].type?ruleFilters[0].value.join(", "):"from "+ruleFilters[0].value[0]+" to "+ruleFilters[0].value[1],$("#filter_values").html("A: "+b+": "+e+" ("+A.length+" out of "+a+", or "+Math.round(A.length/a*100)+"%)"),void 0!=ruleFilters[1]&&(c=ruleFilters[1].name,f="string"==ruleFilters[1].type?ruleFilters[1].value.join(", "):"from "+ruleFilters[1].value[0]+" to "+ruleFilters[1].value[1],$("#filter_values").append("<br>B: "+c+": "+f+" ("+B.length+" out of "+a+", or "+Math.round(B.length/a*100)+"%)")),void 0!=ruleFilters[2]&&(d=ruleFilters[2].name,g="string"==ruleFilters[2].type?ruleFilters[2].value.join(", "):"from "+ruleFilters[2].value[0]+" to "+ruleFilters[2].value[1],$("#filter_values").append("<br>C: "+d+": "+g+" ("+D.length+" out of "+a+", or "+Math.round(D.length/a*100)+"%)")),void 0!=ruleFilters[2]?$("#rule_explain").html("Explainatory rule: if A and B and C then X"):void 0!=ruleFilters[1]?$("#rule_explain").html("Explainatory rule: if A and B then X"):$("#rule_explain").html("Explainatory rule: if A then X"),$("#explain_values").html('<td id="explain" class="rules" style="white-space:normal;"></td><td id="total_ax" class="rules" style="white-space:normal;"></td><td id="total_a_items" class="rules" style="white-space:normal;"></td><td id="total_acc" class="rules" style="white-space:normal;"></td><td id="total_cpl" class="rules" style="white-space:normal;"></td>'),$("#explanation").html('<th class="rules" style="white-space:normal;">Explanation</th><th id="rule_one" class="rules" style="white-space:normal;"></th><th id="rule_two" class="rules" style="white-space:normal;"></th><th id="rule_three" class="rules" style="white-space:normal;"></th><th id="rule_four" class="rules" style="white-space:normal;"></th><th id="rule_five" class="rules" style="white-space:normal;"></th>'),void 0!=ruleFilters[2]){$("#rule_one").html("Total items that have A, B, C and X"),$("#rule_two").html("Total items that have A, B and C"),$("#rule_three").html("Accuracy of explanation,  N(ABCX)/N(ABC)"),$("#rule_four").html("Completeness of explanation, N(ABCX)/N(X)"),$("#rule_five").html("Contribution of A into accuracy of explanation"),$("#explanation").append('<th class="rules_six" style="white-space:normal;">Contribution of B into accuracy of explanation</th>'),$("#explanation").append('<th class="rules_seven" style="white-space:normal;">Contribution of B into accuracy of explanation</th>'),$("#explain").html("ABC->X"),$("#total_ax").html(ABDCs[cIndex].length),$("#total_a_items").html(ABD.length),$("#total_acc").html(ABDCs[cIndex].length+" out of "+ABD.length+" or "+Math.round(ABDCs[cIndex].length/ABD.length*100)+"%"),$("#total_cpl").html(ABDCs[cIndex].length+" out of "+Cs[cIndex].length+" or "+Math.round(ABDCs[cIndex].length/Cs[cIndex].length*100)+"%");var h=Math.round(ABDCs[cIndex].length/ABD.length*100)-Math.round(BDCs[cIndex].length/BD.length*100),i=Math.round(ABDCs[cIndex].length/ABD.length*100)-Math.round(ADCs[cIndex].length/AD.length*100),j=Math.round(ABDCs[cIndex].length/ABD.length*100)-Math.round(ABCs[cIndex].length/AB.length*100);h>10?$("#explain_values").append("<td class='danger'>"+h+"%</td>"):h<-10?$("#explain_values").append("<td class='info'>"+h+"%</td>"):$("#explain_values").append("<td class='success rules' style='white-space:normal;'>"+h+"%</td>"),i>10?$("#explain_values").append("<td class='danger rules' style='white-space:normal;'>"+i+"%</td>"):i<-10?$("#explain_values").append("<td class='info rules' style='white-space:normal;'>"+i+"%</td>"):$("#explain_values").append("<td class='success rules' style='white-space:normal;'>"+i+"%</td>"),j>10?$("#explain_values").append("<td class='danger rules' style='white-space:normal;'>"+j+"%</td>"):j<-10?$("#explain_values").append("<td class='info rules' style='white-space:normal;'>"+j+"%</td>"):$("#explain_values").append("<td class='success rules' style='white-space:normal;'>"+j+"%</td>")}else if(void 0!=ruleFilters[1]){$("#rule_one").html("Total items that have A, B and X"),$("#rule_two").html("Total items that have A and B"),$("#rule_three").html("Accuracy of explanation,  N(ABX)/N(AB)"),$("#rule_four").html("Completeness of explanation, N(ABX)/N(X)"),$("#rule_five").html("Contribution of A into accuracy of explanation"),$("#explanation").append('<th class="rules" style="white-space:normal;">Contribution of B into accuracy of explanation</th>'),$("#explain").html("AB->X"),$("#total_ax").html(ABCs[cIndex].length),$("#total_a_items").html(AB.length),$("#total_acc").html(ABCs[cIndex].length+" out of "+AB.length+" or "+Math.round(ABCs[cIndex].length/AB.length*100)+"%"),$("#total_cpl").html(ABCs[cIndex].length+" out of "+Cs[cIndex].length+" or "+Math.round(ABCs[cIndex].length/Cs[cIndex].length*100)+"%");var h=Math.round(ABCs[cIndex].length/AB.length*100)-Math.round(BCs[cIndex].length/B.length*100),i=Math.round(ABCs[cIndex].length/AB.length*100)-Math.round(ACs[cIndex].length/A.length*100);h>10?$("#explain_values").append("<td class='danger'>"+h+"%</td>"):h<-10?$("#explain_values").append("<td class='info'>"+h+"%</td>"):$("#explain_values").append("<td class='success rules' style='white-space:normal;'>"+h+"%</td>"),i>10?$("#explain_values").append("<td class='danger rules' style='white-space:normal;'>"+i+"%</td>"):i<-10?$("#explain_values").append("<td class='info rules' style='white-space:normal;'>"+i+"%</td>"):$("#explain_values").append("<td class='success rules' style='white-space:normal;'>"+i+"%</td>")}else{$("#rule_one").html("Total items that have A and X"),$("#rule_two").html("Total items that have A"),$("#rule_three").html("Accuracy of explanation,  N(AX)/N(A)"),$("#rule_four").html("Completeness of explanation, N(AX)/N(X)"),$("#rule_five").html("Contribution of A into accuracy of explanation"),$("#explain").html("A->X"),$("#total_ax").html(ACs[cIndex].length),$("#total_a_items").html(A.length);var h=Math.round(ACs[cIndex].length/A.length*100)-Math.round(Cs[cIndex].length/a*100);$("#total_acc").html(ACs[cIndex].length+" out of "+A.length+" or "+Math.round(ACs[cIndex].length/A.length*100)+"%"),$("#total_cpl").html(ACs[cIndex].length+" out of "+Cs[cIndex].length+" or "+Math.round(ACs[cIndex].length/Cs[cIndex].length*100)+"%"),h>10?$("#explain_values").append("<td class='danger'>"+h+"%</td>"):h<-10?$("#explain_values").append("<td class='info'>"+h+"%</td>"):$("#explain_values").append("<td class='success rules' style='white-space:normal;'>"+h+"%</td>")}$("#accum_explain").html(""),void 0!=ruleFilters[2]?($("#accum_explain").append("Accuracy of explanatory rule “if A and B then X” is N(ABX)/N(AB) = "+Math.round(ABCs[cIndex].length/AB.length*100)+"% ("+ABCs[cIndex].length+" out of "+AB.length+")"),$("#accum_explain").append("<br>Accuracy of explanatory rule “if B and C then X” is N(BCX)/N(BC) = "+Math.round(BDCs[cIndex].length/BD.length*100)+"% ("+BDCs[cIndex].length+" out of "+BD.length+")"),$("#accum_explain").append("<br>Accuracy of explanatory rule “if A and C then X” is N(ACX)/N(AC) = "+Math.round(BDCs[cIndex].length/AD.length*100)+"% ("+ADCs[cIndex].length+" out of "+AD.length+")")):void 0!=ruleFilters[1]&&($("#accum_explain").append("Accuracy of explanatory rule “if A then X” is N(AX)/N(A) = "+Math.round(ACs[cIndex].length/A.length*100)+"% ("+ACs[cIndex].length+" out of "+A.length+")"),$("#accum_explain").append("<br>Accuracy of explanatory rule “if B then X” is N(BX)/N(B) = "+Math.round(BCs[cIndex].length/B.length*100)+"% ("+BCs[cIndex].length+" out of "+B.length+")"))}),PivotViewer.Views.BucketView=PivotViewer.Views.TileBasedView.subClass({init:function(){this._super();var a=this;this.buckets=[],this.scale=1,this.canvasHeightUIAdjusted=0,this.titleSpace=62,this.dontZoom=!1,PV.subsets=[null,null],PV.subsets.finalized=!1,$.subscribe("/PivotViewer/Views/Canvas/Zoom",function(b){if(a.isActive){if(a.dontZoom)return void(a.dontZoom=!1);var c=a.scale;void 0!=b.scale?0:1e3;void 0!=b.scale?b.scale>=1?a.scale+=b.scale-1:(a.scale-=b.scale,a.scale<1&&(a.scale=1)):void 0!=b.delta&&(a.scale=a.scale+b.delta),isNaN(a.scale)&&(a.scale=1),a.scale>51&&(a.scale=51);var e=(a.width-a.offsetX)*a.scale;if(e<a.width||a.scale<=1)a.currentOffsetX=a.offsetX,a.currentOffsetY=a.offsetY,a.currentWidth=a.width,a.currentHeight=a.height,a.canvasHeightUIAdjusted=a.height-a.offsetY-a.titleSpace,a.columnWidth=a.origColumnWidth,a.scale=1,$(".pv-bucketview-overlay div").fadeIn("slow"),a.dontZoom=!0,PV.zoom(0),a.recalibrateUISettings();else{var f=a.height*a.scale;a.currentOffsetX=b.x-(b.x-a.currentOffsetX)/c*a.scale,a.currentOffsetY=b.y-(b.y-a.currentOffsetY)/c*a.scale,a.canvasHeightUIAdjusted=f-(a.offsetY+a.titleSpace)/c*a.scale,a.currentWidth=e,a.currentHeight=f,a.columnWidth=a.origColumnWidth*a.scale,$(".pv-bucketview-overlay div").fadeOut("slow"),a.resetUISettings()}if(a.scale!=c&&a.setTilePositions(a.rowscols,a.currentOffsetX,a.currentOffsetY,!0,!0),1==a.scale&&1!=c){for(var g=0;g<a.tiles.length;g++)a.tiles[g].setSelected(!1,null);a.selected=null,$.publish("/PivotViewer/Views/Item/Selected",[{item:a.selected}])}}})},getBucket:function(a){return Math.floor((a-this.offsetX)/this.columnWidth)},recalibrateUISettings:function(){this.rowscols=this.getTileDimensions(this.columnWidth-2,this.canvasHeightUIAdjusted-this.offsetY,this.maxRatio,this.bigCount,this.rowscols)},resetUISettings:function(){this.rowscols=this.calculateDimensions(this.columnWidth-2,this.canvasHeightUIAdjusted-this.offsetY,this.maxRatio,this.bigCount)},handleFilter:function(a,b,c){void 0!=a&&(this.tiles=a),void 0!=b&&(this.oldFilterList=this.filterList,this.filterList=b),void 0!=c&&(this.sortCategory=c),this.filtered=!0,this.isActive&&this.activate()},setup:function(a,b,c,d,e){this.width=a,this.height=b,this.offsetX=c,this.offsetY=d,this.maxRatio=e,this.currentWidth=this.width,this.currentHeight=this.height,this.currentOffsetX=this.offsetX,this.currentOffsetY=this.offsetY,this.rowscols=null,this.bigCount=0},activate:function(){this._super(),DB.isOn()||DB.on(),this.createUI()},filter:function(){PV.subsets.finalized?this.buckets=this.subset(this.filterList,this.sortCategory):this.buckets=this.bucketize(this.filterList,this.sortCategory)},createUI:function(){this.columnWidth=this.origColumnWidth=(this.width-this.offsetX)/this.buckets.length,this.canvasHeightUIAdjusted=this.height-this.offsetY-this.titleSpace;var a="";this.bigCount=0;for(var b=0;b<this.buckets.length;b++){var c=this.buckets[b],d=b%2==0?"bucketview-bucket-dark":"bucketview-bucket-light";(c.equals(PV.subsets[0])||c.equals(PV.subsets[1]))&&(d+=" pv-bucketview-subset");var e=(c.startRange==c.endRange||c.startLabel==c.endLabel?c.startLabel:c.startLabel+"<br>to<br>"+c.endLabel)+(PV.subsets.finalized?b%2?" (2)":" (1)":"");a+="<div class='pv-bucketview-overlay-bucket "+d+"' id='pv-bucketview-overlay-bucket-"+b+"' style='width: "+(Math.floor(this.columnWidth)-4)+"px; height:"+(this.height-2)+"px; left:"+(b*this.columnWidth-2)+"px;'>",a+="<div class='pv-bucketview-overlay-buckettitle' style='top: "+(this.canvasHeightUIAdjusted+4)+"px;'><div class='pv-bucket-countbox'>"+this.buckets[b].tiles.length+"<br>"+Math.round(this.buckets[b].tiles.length/this.filterList.length*100)+"%</div>"+e+"</div></div>",this.bigCount<c.tiles.length&&(this.bigCount=c.tiles.length)}$(".pv-viewpanel-view").append('<div class="modal fade" id="ruleModal"><div class="modal-dialog" id="rule-modal"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Rule Table</h4></div><div class="modal-body" ><code><pre id="pv-rule-result" style="position: relative;         "><h3 id="table_header"></h3><div class="table-responsive"><h3 id="table_header"></h3><h3 id="header_info"></h3><div class="table-responsive" ><table class="table" ><tr><th>Values in filter:</th></tr><tr><td id="filter_values"></td></tr><tr><td id="rule_explain">explainary rule</td></tr></table></div><div class="table-responsive" ><table class="table" ><tr id="explanation"><th class="rules" style="white-space:normal;">Explanation</th><th id="rule_one" class="rules" style="white-space:normal;"></th><th id="rule_two" class="rules" style="white-space:normal;"></th><th id="rule_three" class="rules" style="white-space:normal;"></th><th id="rule_four" class="rules" style="white-space:normal;"></th><th id="rule_five" class="rules" style="white-space:normal;"></th></tr><tr id="explain_values"><td id="explain" class="rules" style="white-space:normal;"></td><td id="total_ax" class="rules" style="white-space:normal;"></td><td id="total_a_items" class="rules" style="white-space:normal;"></td><td id="total_acc" class="rules" style="white-space:normal;"></td><td id="total_cpl" class="rules" style="white-space:normal;"></td></tr></table></div><div class="table-responsive" ><table class="table" ><tr ><td id="accum_explain"></td></tr></table></div></pre></code></div><div class="modal-footer"><button type="button" class="btn btn-default" id="new-page">Open in new window</button><button id="close-rule" type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>'),$(".pv-viewpanel-view").append("<div class='pv-bucketview-overlay'></div>"),$(".pv-bucketview-overlay").css("left",this.offsetX+"px").append(a),$(".pv-bucketview-overlay div").fadeIn("slow");for(var b=0;b<this.tiles.length;b++){var f=this.tiles[b];this.currentWidth=$(".pv-canvas").width();for(var g=f._locations,h=0;h<g.length;h++)g[h].startx=g[h].x,g[h].starty=g[h].y;if(f.startwidth=f.width,f.startheight=f.height,!f.filtered||!Settings.showMissing&&f.missing){f.start=PivotViewer.Utils.now(),f.end=f.start+1e3;for(var h=0;h<g.length;h++){var i=Math.atan2(g[h].y-this.currentHeight/2,g[h].x-this.currentWidth/2);g[h].destinationx=Math.abs(this.currentWidth*Math.cos(i)+this.currentWidth/2),g[h].destinationy=this.currentHeight*Math.sin(i)+this.currentHeight/2}}}var j=this.filterList.length==this.tiles.length?0:500,k=this;setTimeout(function(){var a=$(".pv-toolbarpanel-zoomslider").slider("option","value");a>0&&(k.selected=selectedTile=null,k.currentOffsetX=k.offsetX,k.currentOffsetY=k.offsetY,k.resetUISettings(),PV.zoom(0)),k.resetUISettings();for(var b=TileController._imageController,c=0;c<k.tiles.length;c++)k.tiles[c].origwidth=k.rowscols.TileHeight/b.getRatio(k.tiles[c].item.img),k.tiles[c].origheight=k.rowscols.TileHeight,k.tiles[c].destinationwidth=1,k.tiles[c].destinationheight=1;k.setTilePositions(k.rowscols,k.offsetX,k.offsetY,!1,!1)},j)},deactivate:function(){this._super(),$(".pv-bucketview-overlay div").fadeOut()},getButtonImage:function(){return"images/BucketView.png"},getButtonImageSelected:function(){return"images/BucketViewSelected.png"},getViewName:function(){return"Bucket View"},setTilePositions:function(a,b,c,d,e){var f=e&&this.rowscols?this.rowscols.Columns:a.Columns;e||(this.rowscols=a);for(var i=0;i<this.tiles.length;i++)this.tiles[i].firstFilterItemDone=!1,this.tiles[i]._locations=[this.tiles[i]._locations[0]];for(var j=0;j<this.buckets.length;j++)for(var k=this.buckets[j],l=0,m=0,n=0;n<k.tiles.length;n++){var o=k.tiles[n];if(o.firstFilterItemDone)tileLocation=new PivotViewer.Views.TileLocation,tileLocation.startx=o._locations[0].startx,tileLocation.starty=o._locations[0].starty,tileLocation.x=o._locations[0].x,tileLocation.y=o._locations[0].y,tileLocation.destinationx=j*this.columnWidth+l*a.TileMaxWidth+b,tileLocation.destinationy=this.canvasHeightUIAdjusted-a.TileHeight-m*a.TileHeight+c,o._locations.push(tileLocation);else{var p=o._locations;if(d){for(var i=0;i<p.length;i++)p[i].startx=p[i].x,p[i].starty=p[i].y;o.startwidth=o.width,o.startheight=o.height}o.destinationwidth=a.TileMaxWidth,o.destinationheight=a.TileHeight;for(var i=0;i<p.length;i++)p[i].destinationx=j*this.columnWidth+l*a.TileMaxWidth+b,p[i].destinationy=this.canvasHeightUIAdjusted-a.TileHeight-m*a.TileHeight+c;o.start=PivotViewer.Utils.now(),o.end=o.start+1e3,o.firstFilterItemDone=!0}l==f-1?(l=0,m++):l++}},bucketize:function(a,b,c){void 0==c&&(c=10);var d=PivotCollection.getCategoryByName(b);if("db"==$(".pv-facet[facet='"+PV.cleanName(b).toLowerCase()+"']").attr("mode")){var e=DB.getBuckets(b);return PivotViewer.Utils.fillBuckets(e,a,b),e}if(void 0==a[0].item.getFacetByName(b)){var f=[];return v=new PivotViewer.Models.Bucket("(no info)","(no info)"),f.push(v),f.ids=[],f}for(var g=a[0].item.getFacetByName(b).values[0].value,h=a.length-1;h>0&&void 0==a[h].item.getFacetByName(b);h--);var i=a[h].item.getFacetByName(b).values[0].value;if(d.isDateTime())return g=new Date(g),i=new Date(i),PivotViewer.Utils.getBuckets(a,b,PivotViewer.Utils.getTimeValueFn(g,i),PivotViewer.Utils.getTimeLabelFn(g,i));if(d.isNumber()){var j=[];j.ids=[];var l,m,n,k=i-g;0==k?(l=1,m=g,n=1):(l=Math.pow(10,Math.ceil(Math.log(k)/Math.log(10))-1),d.integer&&l<=1?l=1:k<=5*l&&(l/=2),m=Math.floor(g/l)*l,n=Math.floor((i-m)/l)+1,n>c&&(l*=2,n=Math.ceil(n/2)));for(var h=0;h<n;h++){var o=h*l+m,p=o+l;j[h]=new PivotViewer.Models.Bucket(o,o,o.toString(),p.toString())}for(var h=0;h<a.length;h++){var q=a[h].item,r=q.getFacetByName(b);if(void 0==r)break;for(var s=0;s<r.values.length;s++){var t=r.values[s].value,u=Math.floor((t-m)/l),v=j[u];v.addTile(a[h]),j.ids[q.id]=u,v.endRange<t&&(v.endRange=t)}}for(var w=l,x=0;x<j.length;x++){var v=j[x],y=v.startRange+l-v.endRange;y<w&&(w=y)}w=Math.pow(10,Math.floor(Math.log(w)/Math.log(10))),l-=w>1?1:w;for(var x=0;x<j.length;x++){j[x].startRange+l}for(var A=0,x=0;x<j.length;x++)0==j[x].tiles.length&&A++;if(A>=Math.floor(j.length/2)){var B=[];B.ids=[];for(var x=0;x<j.length>>1;x++){var C=j[2*x],D=j[2*x+1];B.push(C),Array.prototype.push.apply(C.tiles,D.tiles);for(var E in C.ids)B.ids[E]=x;for(var E in D.ids)C.ids[E]=!0,B.ids[E]=x;C.endRange=D.endRange,C.endLabel=D.endLabel}var F=2*x;if(F<j.length){var v=j[F];B.push(v);for(var E in v.ids)B.ids[E]=x}j=B}if(h!=a.length&&Settings.showMissing){j.push(new PivotViewer.Models.Bucket("(no info)","(no info)")),j.ids=[];for(var u=j.length-1,v=j[u];h<a.length;h++)v.addTile(a[h]),v.ids[a[h].item.id]=!0,j.ids[a[h].item.id]=u}return j}return PivotViewer.Utils.getBuckets(a,b)},centerOnTile:function(a){var f,b=a.item,c=a._locations[a.selectedLoc],d=this.rowscols.TileMaxWidth,e=this.rowscols.PaddingX;f=this.buckets.ids[b.id]instanceof Array?this.buckets.ids[b.id][a.selectedLoc]:this.buckets.ids[b.id];var m,g=this.rowscols.Columns,h=Math.round((c.x-this.currentOffsetX-f*(g*d+e))/d),i=f*g+h,j=Math.round((this.canvasHeightUIAdjusted-(c.y-this.currentOffsetY))/a.height)-1,k=a.context.canvas.height,l=a.context.canvas.width-($(".pv-filterpanel").width()+$(".pv-infopanel").width());m=a.height/k>a.height/TileController._imageController.getRatio(b.img)/l?a.origheight/k:a.origwidth/l,null==this.selected&&PV.zoom(Math.round(.75/m*2));var e=this.rowscols.PaddingX*f;this.currentOffsetX=this.width/2-this.rowscols.TileMaxWidth*i-this.rowscols.TileMaxWidth/2-e,this.currentOffsetY=this.height/2-this.canvasHeightUIAdjusted+this.rowscols.TileHeight/2+j*this.rowscols.TileHeight,this.setTilePositions(this.rowscols,this.currentOffsetX,this.currentOffsetY,!0,!0)},handleHover:function(a){if(null==this.selected){for(var b=0;b<this.buckets.length;b++)for(var c=0;c<this.buckets[b].tiles.length;c++){var d=this.buckets[b].tiles[c].contains(a.x,a.y);d>=0?this.buckets[b].tiles[c].setSelected(!0,d):this.buckets[b].tiles[c].setSelected((!1).null)}$(".pv-tooltip").remove(),$(".pv-bucketview-overlay-bucket").removeClass("bucketview-bucket-hover");var e=this.getBucket(a.x);if(e>=0){var f=$("#pv-bucketview-overlay-bucket-"+e);if(f.addClass("bucketview-bucket-hover"),!(this.scale>1)){var g=$(".pv-bucketview-overlay-buckettitle").eq(e),h=g.offset();if(a.x>=h.left&&a.x<=h.left+g.width()&&a.y<=h.top&&a.y>=h.top-g.height()){var i=this.buckets[e],j=PivotCollection.getCategoryByName(this.sortCategory).type==PivotViewer.Models.FacetType.String,k=1==ruleNums||2==ruleNums||3==ruleNums;cIndex=locateBucket(i.startRange);var l="<div class='pv-tooltip'>"+this.sortCategory+" Bucket "+(e+1)+":<br>"+(i.startLabel==i.endLabel?" Value: "+(j?'"':"")+i.startLabel+(j?'"':"")+"; ":"Values: from "+(j?'"':"")+i.startLabel+(j?'"':"")+"  to "+(j?'"':"")+i.endLabel+(j?'"':"")+"; ")+i.tiles.length+" of "+this.filterList.length+" items ("+Math.round(i.tiles.length/this.filterList.length*100)+"%)           "+(void 0!=A[0]?"<br><i>Without filter(s): "+Cs[cIndex].length+" of "+PivotCollection.items.length+" items ("+Math.round(Cs[cIndex].length/PivotCollection.items.length*100)+"%)</i> ":"");if(void 0!=A[0]){var m=Math.round(i.tiles.length/this.filterList.length*100)-Math.round(Cs[cIndex].length/PivotCollection.items.length*100);l+=m>10?'<br><i><font color="red">Contribution of filter(s): '+m+"%</font></i>":m<-10?'<br><i><font color="blue">Contribution of filter(s): '+m+"%</font></i>":'<br><i><font color="green">Contribution of filter(s): '+m+"%</font></i>"}l+=k?"<button type = 'button' id='pv-rule-info' >more info</button>":"",l+=Settings.showMissing?"</div>":"<br><i>(Some items may be missing values for this variable.)</i></div>",$(".pv-viewpanel").append(l),$(".pv-tooltip").offset({left:h.left,top:h.top-g.height()+$(".pv-canvas").offset().top+10})}}}}},handleClick:function(a){if(this.hasSubsets()&&!PV.subsets.finalized)return PV.subsets.finalized=!0,void PV.filterViews();var b=this._super(a);if("init"==a.type&&(this.resetUISettings(),1==_options.authoring&&(b.selectedLoc=PARA.selected_loc)),null!=this.selected&&this.selected.setSelected(!1),null!=b)this.selected!=b?(1==_options.authoring&&(PARA.selected_loc=b.selectedLoc),b.setSelected(!0,null),this.centerOnTile(b),this.setSelected(b),$(".pv-bucketview-overlay div").fadeOut("slow")):(b=null,this.setSelected(null),PV.zoom(0),$(".pv-bucketview-overlay div").fadeIn("slow"));else{this.setSelected(null),PV.zoom(0),$(".pv-bucketview-overlay div").fadeIn("slow");var c=this.getBucket(a.x);if(c>=0&&c<this.buckets.length){var d=this.buckets[c];$.publish("/PivotViewer/Views/Item/Filtered",[{category:this.sortCategory,min:d.startRange,max:d.endRange,values:d.values,clearFilters:!0}])}}$.publish("/PivotViewer/Views/Item/Selected",[{item:b}])},handleContextMenu:function(a){if(!PV.subsets.finalized){var b=this.getBucket(a.x),c=$("#pv-bucketview-overlay-bucket-"+b);this.addSubset(this.buckets[b])?c.addClass("pv-bucketview-subset"):c.removeClass("pv-bucketview-subset")}},addSubset:function(a){if(0==a.tiles.length)return!1;PV.subsets.finalized=!1;var b=this.getSubset(a.tiles[0].item.id);if(b!=-1)return 0==b&&(PV.subsets[0]=PV.subsets[1]),PV.subsets[1]=null,null==PV.subsets[0]&&this.clearSubsets(),!1;if(null!=PV.subsets[1])return!1;if(null==PV.subsets[0]){$(".pv-filterpanel-clearall").after("<div class='pv-subset-clear'>Subset</div>");var c=this;$(".pv-subset-clear").css("visibility","visible").on("click.subset",function(){c.clearSubsets()}),$(".pv-filterpanel-clearall").css("visibility","visible").on("click.subset",function(){c.clearSubsets()}),PV.subsets[0]=a}else PV.subsets[1]=a;return!0},subset:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];null!=PV.subsets[1]&&this.getSubset(e.item.id)==-1||c.push(e)}var f=this.bucketize(c,b,5),g=[];g.ids=[];for(var d=0;d<f.length;d++){var h=f[d];g[2*d]=new PivotViewer.Models.Bucket(h.startRange,h.startLabel,h.endRange,h.endLabel),g[2*d+1]=new PivotViewer.Models.Bucket(h.startRange,h.startLabel,h.endRange,h.endLabel);for(var i=0;i<h.tiles.length;i++){var e=h.tiles[i],j=e.item.id,k=2*d+(PV.subsets[0].ids[j]?0:1);g[k].addTile(e),g.ids[j]=k}for(var i=0;i<h.values.length;i++)g[k].addValue(h.values[i])}return g},getSubset:function(a){return null==PV.subsets[0]?-1:PV.subsets[0].ids[a]?0:null!=PV.subsets[1]&&PV.subsets[1].ids[a]?1:-1},hasSubsets:function(){return null!=PV.subsets[0]},clearSubsets:function(){PV.subsets[0]=PV.subsets[1]=null,PV.subsets.finalized=!1,PV.filterViews(),$(".pv-subset-clear").remove(),$(".pv-filterpanel-clearall").off("click.subset"),this.tiles.length==this.filterList.length&&$(".pv-filterpanel-clearall").css("visibility","hidden")}});
