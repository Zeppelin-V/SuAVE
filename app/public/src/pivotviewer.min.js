var PV={},PivotCollection=new PivotViewer.Models.Collection,TileController=null,Loader=null,LoadSem=new Semaphore(1),Settings={showMissing:!1,visibleCategories:undefined};(function(n){var t=[],i=[],s=[],h=[],r=null,f=[],y,e,p,o,w;_stringFilters=[];_numericFilters=[];_datetimeFilters=[];_selectedFilters=[];_currentView=0;_sortCategory=null;_tiles=[];_filterList=[];_selectedItem=null;_imageController=null;_mouseDrag=null;_mouseMove=null;_self=null;_nameMapping=[];_options={};var c={init:function(t){_self=this;_self.addClass("pv-wrapper");n(document).on("contextmenu",function(){return!1});_options=t;n.getJSON("defaults.json").always(function(i){for(var u=Object.keys(i),r=0;r<u.length;r++)t[u[r]]==undefined&&t[u[r]]==i[u[r]];if(t.ImageController==undefined)_imageController=new PivotViewer.Views.DeepZoomImageController;else if(t.ImageController instanceof PivotViewer.Views.IImageController)_imageController=t.ImageController;else throw"Image Controller does not inherit from PivotViewer.Views.IImageController.";if(t.Loader==undefined){n(".pv-wrapper").append("<div id='pv-file-selection' class='pv-modal-dialog modal-lg'><div><div id='pv-modal-text'><p>Use Existing Project:<br><select id='pv-server-file' class='pv-server-file'><option>Select a file<\/option><\/select><p>Create New Project:<br><input id='pv-load-file' class='pv-load-file' type=file accept='.csv'><\/div><\/div><\/div>");$pv_server_file=n("#pv-server-file");n.getJSON("../project_list.php",function(t){n.each(t,function(n,t){$pv_server_file.append('<option value="'+t+'">'+t+"<\/option>")})});$pv_server_file.on("change",function(){Loader=$pv_server_file.val().endsWith(".cxml")?new PivotViewer.Models.Loaders.CXMLLoader("projects/"+$pv_server_file.val()):new PivotViewer.Models.Loaders.CSVLoader("projects/"+$pv_server_file.val());l(t);window.open("#pv-modal-dialog-close","_self")});n(".pv-load-file").on("change",function(){var i=n("#pv-load-file")[0];Loader=new PivotViewer.Models.Loaders.LocalCSVLoader(i.files[0]);l(t)});window.open("#pv-file-selection","_self")}else Loader=t.Loader,l(t)}).fail(function(n,t,i){var r=t+", "+i;Debug.log("Getting defaults file failed: "+r)})}},l=function(){if(_self.append("<div class='pv-loading'><img src='images/loading.gif' alt='Loading' /><span>Loading...<\/span><\/div>"),n(".pv-loading").css("top",n(".pv-wrapper").height()/2-33+"px"),n(".pv-loading").css("left",n(".pv-wrapper").width()/2-43+"px"),Loader==undefined)throw"Collection loader is undefined.";if(Loader instanceof PivotViewer.Models.Loaders.ICollectionLoader)Loader.loadCollection(PivotCollection);else throw"Collection loader does not inherit from PivotViewer.Models.Loaders.ICollectionLoader.";},nt=function(n,t,i){var u=["<ul class='pv-filterpanel-accordion-facet-list'>"],r,f;if(t)for(r=0;r<t.length;r++)f=r+1,u[f]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(n)+"__"+PV.cleanName(t[r].name.toString())+"'>",u[f]+="<input itemvalue='"+PV.cleanName(t[r].name.toString())+"' itemfacet='"+PV.cleanName(n.toString())+"' startdate='"+t[r].start.toISOString()+"' enddate='"+t[r].end.toISOString()+"' class='pv-facet-value' type='checkbox' />",u[f]+="<span class='pv-facet-value-label'>"+t[r].name+"<\/span>",u[f]+="<span class='pv-facet-value-count'>0<\/span>",u[f]+="<\/li>";if(u[t.length+1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-LineBreak' style='border-bottom:thin solid #E2E2E2;'><\/li>",u[t.length+2]="<\/ul>",u[t.length+3]="<ul class='pv-filterpanel-accordion-facet-list'>",i)for(r=0;r<i.length;r++)f=r+4+t.length,u[f]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(n)+"__"+PV.cleanName(i[r].name.toString())+"'>",u[f]+="<input itemvalue='"+PV.cleanName(i[r].name.toString())+"' itemfacet='"+PV.cleanName(n.toString())+"' startdate='"+i[r].start.toISOString()+"' enddate='"+i[r].end.toISOString()+"' class='pv-facet-value' type='checkbox' />",u[f]+="<span class='pv-facet-value-label'>"+i[r].name+"<\/span>",u[f]+="<span class='pv-facet-value-count'>0<\/span>",u[f]+="<\/li>";return u[t.length+i.length+4]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-LineBreak2' style='border-bottom:thin solid #E2E2E2;'><\/li>",u[t.length+i.length+5]="<\/ul>",u.join("")},tt=function(n){var t=["<ul class='pv-filterpanel-accordion-facet-list'>"];return t[1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(n)+"__CustomRange'>",t[1]+="<input itemvalue='CustomRange' itemfacet='"+PV.cleanName(n)+"' class='pv-facet-value' type='checkbox' />",t[1]+="<span class='pv-facet-value-label'>Custom Range<\/span>",t[1]+="<\/li>",t[1]+="<ul class='pv-filterpanel-accordion-facet-list'>",t[1]+="<li class='pv-filterpanel-accordion-facet-list-item' id='pv-custom-range-"+PV.cleanName(n)+"__Start' style='visibility:hidden;float:right'>",t[1]+="<span class='pv-facet-customrange-label'>Start:<\/span>",t[1]+="<input itemvalue='CustomRangeStart' itemfacet='"+PV.cleanName(n)+"' id='pv-custom-range-"+PV.cleanName(n)+"__StartDate' class='pv-facet-customrange' type='text'/>",t[1]+="<\/li>",t[1]+="<li class='pv-filterpanel-accordion-facet-list-item' id='pv-custom-range-"+PV.cleanName(n)+"__Finish' style='visibility:hidden;float:right'>",t[1]+="<span class='pv-facet-customrange-label'>End:<\/span>",t[1]+="<input itemvalue='CustomRangeFinish' itemfacet='"+PV.cleanName(n)+"' id='pv-custom-range-"+PV.cleanName(n)+"__FinishDate' class='pv-facet-customrange' type='text'/>",t[1]+="<\/li>",t[t.length]="<\/ul>",t.join("")},it=function(n){var u=i[n],r,t;return u==undefined?"":(r=u["(no info)"],t="<ul class='pv-filterpanel-accordion-facet-list'>",r!=undefined&&(t+="<li class='pv-filterpanel-accordion-facet-list-item'  id='"+r.id+"'>",t+="<input itemvalue='"+PV.cleanName(r.value)+"' itemfacet='"+PV.cleanName(n)+"' class='pv-facet-value' type='checkbox' />",t+="<span class='pv-facet-value-label'>"+r.value+"<\/span>",t+="<span class='pv-facet-value-count'>0<\/span>",t+="<\/li>"),t+="<li class='pv-filterpanel-accordion-facet-list-item'  style='border-bottom:thin solid #E2E2E2;'><\/li>",t+"<\/ul>")},rt=function(n){var t=["<ul class='pv-filterpanel-accordion-facet-list'>"],f=i[n],r=1,e,u;for(e in f.values)u=f.values[e],t[r]="<li class='pv-filterpanel-accordion-facet-list-item'  id='"+u.id+"'>",t[r]+="<input itemvalue='"+PV.cleanName(u.value)+"' itemfacet='"+PV.cleanName(n)+"' class='pv-facet-value' type='checkbox' />",t[r]+="<span class='pv-facet-value-label'>"+u.value+"<\/span>",t[r]+="<span class='pv-facet-value-count'>0<\/span>",t[r++]+="<\/li>";return t[t.length]="<\/ul>",t.join("")},k=function(t,i,r){var s=PivotViewer.Utils.escapeMetaChars(PV.cleanName(t.name)),e=n("#pv-filterpanel-category-numberitem-"+s),h=e.attr("created")==undefined,o,c,y,p,w,f,l;h&&e.append("<span class='pv-facet-numericslider-range-val'>&nbsp;<\/span><br>");e.find("svg").remove();var u=r(i),a="<svg class='pv-filterpanel-accordion-facet-chart' width='165' height='80'>",v=.5+165/u.histogram.length|0,b=u.histogram.length>1?Math.max.apply(null,u.histogram):1;for(o=0;o<u.histogram.length;o++)c=.5+80/b*u.histogram[o],y=.5+v*o|0,a+="<rect x='"+y+"' y='"+(80-c)+"' width='"+v+"' height='"+c+"'><\/rect>";e.find("br").after(a+"<\/svg>");h&&(p=t.getValueLabel(u.min),w=t.getValueLabel(u.max),e.append("<div id='pv-facet-numericslider-"+s+"' class='pv-facet-numericslider'><\/div><table width=100%><tr><td class='pv-facet-numericslider-range-min'>"+p+"<\/td><td align=right class='pv-facet-numericslider-range-max'>"+w+"<\/td><\/tr><\/table>"),e.attr("created",1));f=n("#pv-facet-numericslider-"+s);l=u.max-u.min;h&&f.modSlider({values:[u.min,u.max]});f.modSlider("option","min",u.min);f.modSlider("option","max",u.max);f.modSlider("option","step",l<10&&!t.integer?l/u.histogram.length:1);h&&(f.modSlider("option","range",!0),f.modSlider("option","start",function(n,t){this.startMin=t.values[0];this.startMax=t.values[t.values.length-1]}),f.modSlider("option","slide",function(i,r){var u=t.getValueLabel(r.values[0]),f=t.getValueLabel(r.values[r.values.length-1]);n(this).parent().find(".pv-facet-numericslider-range-val").text(u+" - "+f)}),f.modSlider("option","stop",function(i,r){PV._stopSlider(n("#pv-facet-numericslider-"+s),t,i,r)}))},a=function(n,t){k(n,t,PivotViewer.Utils.getHistogram)},v=function(n,t){k(n,t,PivotViewer.Utils.getOrdinalHistogram)};PV._stopSlider=function(t,i,r,u){var t=n("#pv-facet-numericslider-"+PV.cleanName(i.name)),f=t.modSlider("option","min"),e=t.modSlider("option","max");if(u.values[0]>f||u.values[u.values.length-1]<e)t.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible");else if(u.values[0]==f&&u.values[u.values.length-1]==e&&(t.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),_numericFilters[i.name]==undefined))return;PV.filterCollection({category:i,enlarge:t[0].startMin>u.values[0]||t[0].startMax<u.values[u.values.length-1],min:u.values[0],max:u.values[u.values.length-1],rangeMin:f,rangeMax:e})};PV.selectView=function(i){var r,u;if(typeof i=="string"||i instanceof String){for(u=0;u<t.length;u++)if(t[u].getViewName().toLowerCase().startsWith(i.toLowerCase())){r=u;break}}else r=i;PV.deselectInfoPanel();n("#pv-viewpanel-view-"+_currentView+"-image").attr("src",t[_currentView].getButtonImage());t[_currentView].deactivate();n("#pv-viewpanel-view-"+r+"-image").attr("src",t[r].getButtonImageSelected());t[r].activate();_currentView=r};PV.getCurrentView=function(){return t[_currentView]};PV.filterViews=function(){for(var n=0;n<t.length;n++)t[n].handleFilter(_tiles,_filterList,_sortCategory)};y=function(t){var e,o,u,r;if(PivotCollection.getCategoryByName(t).type!=PivotViewer.Models.FacetType.DateTime){var f=n("#pv-cat-"+PivotViewer.Utils.escapeMetaChars(PV.cleanName(t))+" ul"),s=f.prev().text().replace("Sort: ",""),i=f.children("li").get();if(s=="A-Z")i.sort(function(t,i){var r=n(t).children().first().attr("itemvalue"),u=n(i).children().first().attr("itemvalue");return r<u?1:r>u?-1:0});else if(s=="Quantity")i.sort(function(t,i){var r=parseInt(n(t).children(".pv-facet-value-count").text()),u=parseInt(n(i).children(".pv-facet-value-count").text());return r<u?-1:r>u?1:0});else if(e=PivotCollection.getCategoryByName(t),e.customSort!=undefined){for(o=[],r=e.customSort.sortValues.length-1;r>=0;r--)for(u=0;u<i.length;u++)facet.customSort.sortValues[r]==n(i[u]).children(".pv-facet-value-label").text()&&o.push(i[u]);i=o}for(r=0;r<i.length;r++)f.prepend(i[r])}};PV.filterCollection=function(t){var ut,et,v,h,s,d,pt,st,lt,at,p,vt,f,yt,a,ft,y,ot,c,wt,it,l,tt,u,o,w,ct,b,nt,g,bt,k,i,rt;if(PV.deselectInfoPanel(),_selectedItem=null,ut=[],et=null,t==undefined){if(r!=null){for(pt=0,et=[],i=0,ot=_tiles.length;i<ot;i++)u=_tiles[i].item.getFacetByName(r.facet),u!=undefined&&u.values[0].value.toLowerCase().indexOf(r.value)>=0?(et[i]=!0,pt++):et[i]=!1;if(pt==0){n("#pv-long-search").css("text-decoration","line-through").css("color","red");return}}for(st=n(".pv-facet-value:checked"),ut=[],v=[],h=[],s=[],d=[],i=0;i<st.length;i++){var p=_nameMapping[n(st[i]).attr("itemfacet")],g=_nameMapping[n(st[i]).attr("itemvalue")],f=PivotCollection.getCategoryByName(p);f.doFilter&&(f.isString()?(a=v[p],a!=undefined?a.value[g+"a"]=!0:(a={facet:p,value:[],index:i},a.value[g+"a"]=!0,v.push(a),v[p]=a,d[p]=!0)):f.isDateTime()&&(lt=n("#pv-custom-range-"+PV.cleanName(p)+"__StartDate")[0].value,at=n("#pv-custom-range-"+PV.cleanName(p)+"__FinishDate")[0].value,lt&&at?ft={value:g,startDate:new Date(lt),endDate:new Date(at)}:(lt=n(st[i]).attr("startdate"),at=n(st[i]).attr("enddate"),ft={value:g,startDate:new Date(lt),endDate:new Date(at)}),y=h[p],y!=undefined?y.value.push(ft):(y={facet:p,value:[ft]},h.push(y),h[p]=y,d[p]=!0)))}for(i=0,ot=PivotCollection.categories.length;i<ot;i++)if((f=PivotCollection.categories[i],f.doFilter)&&(p=f.name,(PivotCollection.categories[i].type==PivotViewer.Models.FacetType.Number||PivotCollection.categories[i].type==PivotViewer.Models.FacetType.Ordinal)&&(vt=n("#pv-filterpanel-category-numberitem-"+PV.cleanName(p)).find(".pv-facet-numericslider"),vt.length>0))){var ht=vt.modSlider("values"),kt=vt.modSlider("option","max"),dt=vt.modSlider("option","min");(ht[0]!=dt||ht[ht.length-1]!=kt)&&(s.push({facet:p,selectedMin:ht[0],selectedMax:ht[ht.length-1],rangeMin:dt,rangeMax:kt}),s[p]=s[i],d[p]=!0)}}else{if(ut=[],v=_stringFilters,h=_datetimeFilters,s=_numericFilters,d=_selectedFilters,f=t.category,!f.doFilter)return;if(f.isNumber()||f.isOrdinal())numericFilter=s[f.name],numericFilter==undefined?(numericFilter={facet:f.name,selectedMin:t.min,selectedMax:t.max,rangeMin:t.rangeMin,rangeMax:t.rangeMax},s.push(numericFilter),s[f.name]=numericFilter):(numericFilter.selectedMin=t.min,numericFilter.selectedMax=t.max),d[f.name]=!0;else if(!t.enlarge&&d[f.name]!=undefined||t.clear){if(f.isString())a=v[f.name],delete a.value[t.value+"a"],a.value.splice(a.value.indexOf(t.value),1),Object.keys(a.value).length==0&&(delete v[f.name],v.splice(a.index,1),delete d[f.name]);else for(y=h[f.name],yt=0;yt<y.value.length;yt++)if(y.value[yt].value==t.value){y.value.splice(yt,1);y.value.length==0&&(delete h[f.name],h.splice(y.index,1),delete d[f.name]);break}}else f.isString()?(a=v[f.name],a!=undefined?(a.value[t.value+"a"]=!0,a.value.push(t.value)):(a={facet:f.name,value:[t.value],index:i},a.value[t.value+"a"]=!0,v.push(a),v[f.name]=a)):(ft={value:t.value,startDate:t.min,endDate:t.max},y=h[f.name],y!=undefined?y.value.push(ft):(y={facet:f.name,value:[ft]},h.push(y),h[f.name]=y)),d[f.name]=!0}for(i=0,ot=_tiles.length;i<ot;i++){if(c=_tiles[i],t!=undefined&&(!t.enlarge||c.filtered)){if(t.enlarge||c.filtered){if(t.enlarge){ut.push(c);continue}}else continue;if(t.category.isString())if(u=c.item.getFacetByName(t.category.name),u==undefined){if(t.value=="(no info)"==t.clear){c.filtered=!1;continue}}else{for(o=0;o<u.values.length;o++)if(u.values[o].value==t.value!=t.clear)break;if(o==u.values.length){c.filtered=!1;continue}}else if(t.category.isNumber()||t.category.isOrdinal())if(u=c.item.getFacetByName(t.category.name),u==undefined){c.filtered=!1;continue}else{for(o=0,w=u.values.length;o<w;o++)if(it=parseFloat(u.values[o].value),u=s[f.name],!isNaN(it)&&it>=u.selectedMin&&it<=u.selectedMax)break;if(o==w){c.filtered=!1;continue}}else if(u=c.item.getFacetByName(t.category.name),wt=h[t.category.name],u==undefined){if(t.value=="(no info)"==t.clear){c.filtered=!1;continue}}else{for(o=0,w=u.values.length;o<w;o++){for(ct=new Date(u.values[o].value),b=0,nt=wt.value.length;b<nt;b++)if(g=wt.value[b],(ct>=g.startDate&&ct<=g.endDate)==t.clear)break;if(b==nt!=t.clear)break}if(o==w){c.filtered=!1;continue}}ut.push(c);continue}if(et!=null){if(!et[i]){c.filtered=!1;continue}}else if(r!=null&&(u=_tiles[i].item.getFacetByName(r.facet),u==undefined||u.values[0].value.toLowerCase().indexOf(r.value)<0)){c.filtered=!1;continue}for(l=0,tt=v.length;l<tt;l++){if(u=c.item.getFacetByName(v[l].facet),u==undefined)if(v[l].value["(no info)a"])continue;else break;for(o=0,w=u.values.length;o<w;o++)if(v[l].value[u.values[o].value+"a"])break;if(o==w)break}if(l<tt){c.filtered=!1;continue}for(l=0,tt=s.length;l<tt;l++){if(u=c.item.getFacetByName(s[l].facet),u==undefined)if(s[l].selectedMin=="(no info)")continue;else break;for(o=0,w=u.values.length;o<w;o++)if(it=parseFloat(u.values[o].value),!isNaN(it)&&it>=s[l].selectedMin&&it<=s[l].selectedMax)break;if(o==w)break}if(l<tt){c.filtered=!1;continue}for(l=0,tt=h.length;l<tt;l++){if(u=c.item.getFacetByName(h[l].facet),u==undefined){for(b=0,nt=h[l].value.length;b<nt;b++)if(h[l].value[b].value=="(no info)")break;if(b==nt)break;else continue}for(o=0,w=u.values.length;o<w;o++){for(ct=new Date(u.values[o].value),b=0,nt=h[l].value.length;b<nt;b++)if(g=h[l].value[b],ct>=g.startDate&&ct<=g.endDate)break;if(b<nt)break}if(o==w)break}if(l<tt){c.filtered=!1;continue}c.filtered=!0;ut.push(c)}for(_filterList=ut,_numericFilters=s,_stringFilters=v,_datetimeFilters=h,_selectedFilters=d,r!=null||_numericFilters.length!=0||_stringFilters.length!=0||_datetimeFilters.length!=0?n(".pv-filterpanel-clearall").css("visibility","visible"):n(".pv-filterpanel-clearall").css("visibility","hidden"),i=0;i<PivotCollection.categories.length;i++)PivotCollection.categories[i].recount=!0;if(e(n(".pv-facet").eq(n(".pv-filterpanel-accordion").accordion("option","active"))),n("#pv-toolbarpanel-countbox").html(_filterList.length),bt=n(".pv-toolbarpanel-breadcrumb"),bt.empty(),v.length>0||s.length>0||h.length>0){for(k="|",i=0;i<v.length;i++)k+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+v[i].facet+":<\/span><span class='pv-toolbarpanel-breadcrumb-values'>",k+=v[i].value.join(", "),k+="<\/span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;<\/span>";for(i=0;i<s.length;i++)k+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+s[i].facet+":<\/span><span class='pv-toolbarpanel-breadcrumb-values'>",k+=s[i].selectedMin==s[i].rangeMin?"Under "+s[i].selectedMax:s[i].selectedMax==s[i].rangeMax?"Over "+s[i].selectedMin:s[i].selectedMin==s[i].selectedMax?s[i].selectedMin:s[i].selectedMin+" - "+s[i].selectedMax,k+="<\/span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;<\/span>";for(i=0;i<h.length;i++)for(rt=0;rt<h[i].value.length;rt++){if(k+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+h[i].facet+":<\/span><span class='pv-toolbarpanel-breadcrumb-values'>",h[i].value[rt].startDate!=undefined&&h[i].value[rt].endDate!=undefined){var gt=new Date(h[i].value[rt].startDate),ni=new Date(h[i].value[rt].endDate),ti=PivotViewer.Utils.getTimeLabelFn(gt,ni);k+=ti({value:gt})+" - "+ti({value:ni})}else k+=h[i].value[rt].value;k+="<\/span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;<\/span>"}bt.append(k);TileController.setCircularEasingBoth()}PV.filterViews()};PV.initUICategory=function(t){Loader.loadColumn(t);LoadSem.acquire(function(r){var a=n("#pv-cat-"+PV.cleanName(t.name)),c,v,u,o,l,p,e,f;if(t.isDateTime()){ut(t);a.append(nt(t.name,t.datetimeBuckets[0],t.datetimeBuckets[1]));a.append(it(t.name));a.append(tt(t.name));n("#pv-cat-"+PV.cleanName(t.name)+" .pv-facet-customrange").on("change",function(){g(this)});n("#pv-cat-"+PV.cleanName(t.name)+" .pv-facet-value").on("click.pv",function(){PV.clickValue(this)});n("#pv-cat-"+PV.cleanName(t.name)+" .pv-facet-value-label").on("click.pv",function(){var t=n(this).prev();t.prop("checked",!t.prop("checked"));PV.clickValue(t[0])})}else if(t.isString()){for(c=0;c<PivotCollection.items.length;c++)if(v=PivotCollection.items[c],u=v.getFacetByName(t.name),u!=undefined)for(o=0;o<u.values.length;o++){var l=u.values[o].value,p="pv-facet-value-"+PV.cleanName(u.name)+"__"+PV.cleanName(u.values[o].value),e=i[u.name];e==undefined&&(e=i[u.name]={values:[],facet:u.name,filtered:!0});f=e.values[l];f==undefined?e.values[l]={id:p,value:l,count:1}:f.count++}else p="pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName("(no info)"),e=i[t.name],e==undefined&&(e=i[t.name]={values:[],facet:t.name,filtered:!0}),f=e.values["(no info)"],f==undefined?e.values["(no info)"]={id:p,value:"(no info)",count:1}:f.count++;a.append("<input class='pv-value-search' id='pv-value-search-"+PV.cleanName(t.name)+"' type='text' placeholder='Search values...' size=15><div class='pv-search-clear' id='pv-value-search-clear-"+PV.cleanName(t.name)+"'>&nbsp;<\/div><br>");t.customSort!=undefined||t.customSort!=null?a.append("<span class='pv-filterpanel-accordion-facet-sort' customSort='"+t.customSort.name+"'>Sort: "+t.customSort.name+"<\/span>"):a.append("<span class='pv-filterpanel-accordion-facet-sort'>Sort: A-Z<\/span>");a.append(rt(t.name));v=i[t.name];for(l in v.values)f=v.values[l],f.valueItem=n("#"+f.id),f.itemCount=f.valueItem.find("span").last();n("#pv-value-search-"+PV.cleanName(t.name)).on("keyup",function(){var i=PV.cleanName(t.name),u=PV.cleanName(this.value.toLowerCase()),r;u!=""?(r=[],r=n('.pv-filterpanel-accordion-facet-list-item[id^="pv-facet-value-'+i+'"]'),r.hide(),r.filter(function(){return PV.cleanName(n(this).children().eq(0).attr("itemvalue").toLowerCase()).indexOf(u)>=0&&n(this).children().eq(2).html()>0}).show(),n("#pv-value-search-clear-"+i).css("visibility","visible")):(n('.pv-filterpanel-accordion-facet-list-item[id^="pv-facet-value-'+i+'"]').show(),n("#pv-value-search-clear-"+i).css("visibility","hidden"))});n("#pv-value-search-clear-"+PV.cleanName(t.name)).click(function(){var i=PV.cleanName(t.name);n("#pv-value-search-"+i).val("");n("#pv-value-search-clear-"+i).css("visibility","hidden");n('.pv-filterpanel-accordion-facet-list-item[id^="pv-facet-value-'+i+'"]').show()});n("#pv-cat-"+PV.cleanName(t.name)+" .pv-facet-value").click(function(){PV.clickValue(this)});n("#pv-cat-"+PV.cleanName(t.name)+" .pv-facet-value-label").click(function(){var t=n(this).prev();t.prop("checked",!t.prop("checked"));PV.clickValue(t[0])});n("#pv-cat-"+PV.cleanName(t.name)+" .pv-filterpanel-accordion-facet-sort").click(function(){var t=n(this),i=t.text(),u=t.parent().prev().children("a").text(),r=t.attr("customSort");i=="Sort: A-Z"?n(this).text("Sort: Quantity"):i=="Sort: Quantity"&&r==undefined?n(this).text("Sort: A-Z"):i=="Sort: Quantity"?n(this).text("Sort: "+r):n(this).text("Sort: A-Z");y(u)})}else if(t.isNumber()){for(c=0;c<PivotCollection.items.length;c++)if(v=PivotCollection.items[c],u=v.getFacetByName(t.name),u!=undefined)for(o=0;o<u.values.length;o++)l=u.values[o].value,f=s[u.name],f!=undefined?f.values.push(l):s[u.name]={facet:u.name,values:[l],filtered:!0};else p="pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName("(no info)"),e=i[t.name],e==undefined&&(e=i[t.name]={values:[],facet:t.name,filtered:!0}),f=e.values["(no info)"],f==undefined?e.values["(no info)"]={id:p,value:"(no info)",count:1}:f.count++;a.append("<div id='pv-filterpanel-category-numberitem-"+PV.cleanName(t.name)+"'><\/div>")}else if(t.isOrdinal()){for(c=0;c<PivotCollection.items.length;c++)if(v=PivotCollection.items[c],u=v.getFacetByName(t.name),u!=undefined)for(o=0;o<u.values.length;o++)l=u.values[o].value,f=h[u.name],f!=undefined?f.values.push(l):h[u.name]={facet:u.name,values:[l],filtered:!0};else p="pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName("(no info)"),e=i[t.name],e==undefined&&(e=i[t.name]={values:[],facet:t.name,filtered:!0}),f=e.values["(no info)"],f==undefined?e.values["(no info)"]={id:p,value:"(no info)",count:1}:f.count++;a.append("<div id='pv-filterpanel-category-numberitem-"+PV.cleanName(t.name)+"'><\/div>")}t.uiInit=!0;r()})};e=function(t){var r=PivotCollection.getCategoryByName(_nameMapping[t.attr("facet")]);r.isFilterVisible&&r.recount&&(r.uiInit||PV.initUICategory(r),LoadSem.acquire(function(t){var k=[],g,c,tt,u,p,f,b,e,nt,w,o,l,d;if(_filterList.length*2<_tiles.length)k=_filterList;else for(o=0;o<_tiles.length;o++)_tiles[o].filtered||k.push(_tiles[o]);if(r.isString()){for(c=[],tt=PivotViewer.Utils.escapeMetaChars("pv-facet-value-"+PV.cleanName(r.name)+"__"+PV.cleanName("(no info)")),f=0;f<k.length;f++){if(l=k[f].item.getFacetByName(r.name),l==undefined){p=c[tt];p!=undefined?p.count++:c[tt]={count:1};continue}for(e=0;e<l.values.length;e++)u=PivotViewer.Utils.escapeMetaChars("pv-facet-value-"+PV.cleanName(r.name)+"__"+PV.cleanName(l.values[e].value)),p=c[u],p!=undefined?p.count++:c[u]={count:1}}if(k==_filterList){w=i[r.name].values;for(g in w)u=w[g],c[u.id]==undefined?_selectedFilters[r.name]||u.valueItem.hide():(u.valueItem.show(),u.itemCount.text(c[u.id].count))}else{w=i[r.name].values;for(g in w)u=w[g],nt=c[u.id]==undefined?i[r.name].values[g].count:i[r.name].values[g].count-c[u.id].count,nt==0?_selectedFilters[r.name]||u.valueItem.hide():(u.valueItem.show(),u.itemCount.text(nt))}y(r.name)}else if(r.isDateTime()){for(c=[],tt=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(r.name)+"__"+PV.cleanName("(no info)")),o=0;o<k.length;o++)if(l=k[o].item.getFacetByName(r.name),l==undefined)p=c[tt],p!=undefined?p.count++:c[u]={count:1};else for(f=0;f<r.datetimeBuckets.length&&f<2;f++)for(b=r.datetimeBuckets[f],e=0;e<b.length;e++)if(b[e].items[k[o].item.id+"a"]!=undefined){u=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(r.name)+"__"+PV.cleanName(b[e].name.toString()));p=c[u];p!=undefined?p.count++:c[u]={count:1};break}if(k==_filterList)for(f=0;f<r.datetimeBuckets.length&&f<2;f++)for(b=r.datetimeBuckets[f],e=0;e<b.length;e++)u=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(r.name)+"__"+PV.cleanName(b[e].name.toString())),c[u]==undefined?_selectedFilters[r.name]||n(u).hide():(n(u).show(),n(u).find("span").last().text(c[u].count));else for(f=0;f<r.datetimeBuckets.length&&f<2;f++)for(b=r.datetimeBuckets[f],e=0;e<b.length;e++)u=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(r.name)+"__"+PV.cleanName(b[e].name.toString())),nt=c[u]==undefined?b[e].items.length:b[e].items.length-c[u].count,nt==0?_selectedFilters[r.name]||n(u).hide():(n(u).show(),n(u).find("span").last().text(nt))}else if(r.isNumber()){if(!_selectedFilters[r.name])if(_filterList.length==_tiles.length)a(r,s[r.name].values);else{for(w=[],o=0;o<_filterList.length;o++)if(l=_filterList[o].item.getFacetByName(r.name),l!=undefined)for(d=0;d<l.values.length;d++)w.push(l.values[d].value);a(r,w)}}else if(r.isOrdinal()&&!_selectedFilters[r.name])if(_filterList.length==_tiles.length)v(r,h[r.name].values);else{for(w=[],o=0;o<_filterList.length;o++)if(l=_filterList[o].item.getFacetByName(r.name),l!=undefined)for(d=0;d<l.values.length;d++)w.push(l.values[d].value);v(r,w)}Settings.showMissing?n("#pv-facet-value-"+PV.cleanName(r.name)+"__"+PV.cleanName("(no info)")).show():n("#pv-facet-value-"+PV.cleanName(r.name)+"__"+PV.cleanName("(no info)")).hide();r.recount=!1;t()}))};PV.deselectInfoPanel=function(){n(".pv-infopanel").fadeOut();n(".pv-infopanel-heading").empty();n(".pv-infopanel-details").empty()};PV.cleanName=function(n){var t=n.replace(/[^\w]/gi,"_");return _nameMapping[t]=n,t};PV.uncleanName=function(n){return _nameMapping[n]};n.subscribe("/PivotViewer/Models/Collection/Loaded",function(){var t=Lawnchair({name:PivotCollection.name});t.get("Settings",function(t){var i;if(t!=null)for(Settings=t.value,i=0;i<Settings.visibleCategories.length;i++)Settings.visibleCategories[PivotCollection.categories[Settings.visibleCategories[i]].name]=!0;else for(Settings.showMissing=!1,Settings.visibleCategories=[],i=0;i<PivotCollection.categories.length;i++)Settings.visibleCategories.push(i),Settings.visibleCategories[PivotCollection.categories[i].name]=!0;n.publish("/PivotView/Models/Settings/Loaded")})});n.subscribe("/PivotView/Models/Settings/Loaded",function(){var t="<div class='pv-toolbarpanel'>",e=PivotCollection.brandImage,u,f,i,r,o;e.length>0&&(t+="<img class='pv-toolbarpanel-brandimage' src='"+e+"'><\/img>");t+="<span class='pv-toolbarpanel-name'>"+PivotCollection.name+"<\/span>";t+="<span class='pv-countbox' id='pv-toolbarpanel-countbox' width=25><\/span>";t+="<div class='pv-toolbarpanel-breadcrumb'><\/div>";t+="<div class='pv-toolbarpanel-viewcontrols'><\/div>";t+="<div id='pv-primsortcontrols' class='pv-toolbarpanel-sortcontrols'><\/div>";t+="<div class='pv-toolbarpanel-zoomcontrols'><div class='pv-toolbarpanel-zoomslider'><\/div><\/div>";t+="<div class='pv-toolbarpanel-info'><\/div>";t+="<\/div>";_self.append(t);n("#pv-altsort").hide();n(".pv-toolbarpanel-zoomslider").slider({max:100,stop:function(n,t){PV.zoom(t.value)}});_self.append("<div class='pv-mainpanel'><\/div>");u=n(window).height()-n(".pv-toolbarpanel").height()-30;n(".pv-mainpanel").css("height",u+"px");n(".pv-mainpanel").append("<div class='pv-filterpanel'><\/div>");n(".pv-mainpanel").append("<div class='pv-viewpanel'><canvas class='pv-canvas' width='"+_self.width()+"' height='"+u+"px'><\/canvas><\/div>");n(".pv-mainpanel").append("<div class='pv-infopanel'><\/div>");f=n(".pv-filterpanel");f.append("<div class='pv-filterpanel-clearall'>Clear All<\/div>").append("<input class='pv-filterpanel-search' type='text' placeholder='Search variables...' /><div class='pv-search-clear' id='pv-filterpanel-search-clear'>&nbsp;<\/div>").css("height",u-13+"px");n(".pv-filterpanel-search").css("width",f.width()-15+"px");i=n(".pv-infopanel");i.css("left",n(".pv-mainpanel").offset().left+n(".pv-mainpanel").width()-205+"px").css("height",u-28+"px");i.append("<div class='pv-infopanel-controls'><\/div>");n(".pv-infopanel-controls").append("<div><div class='pv-infopanel-controls-navleft'><\/div><div class='pv-infopanel-controls-navleftdisabled'><\/div><div class='pv-infopanel-controls-navbar'><\/div><div class='pv-infopanel-controls-navright'><\/div><div class='pv-infopanel-controls-navrightdisabled'><\/div><\/div>");n(".pv-infopanel-controls-navleftdisabled").hide();n(".pv-infopanel-controls-navrightdisabled").hide();i.append("<div class='pv-infopanel-heading'><\/div>");i.append("<div class='pv-infopanel-details'><\/div>");PivotCollection.maxRelatedLinks>0&&i.append("<div class='pv-infopanel-related'><\/div>");PivotCollection.copyrightName!=""&&i.append("<div class='pv-infopanel-copyright'><a href=\""+PivotCollection.copyrightHref+'" target="_blank">'+PivotCollection.copyrightName+"<\/a><\/div>");i.hide();r=PivotCollection.imageBase;r.indexOf("http",0)>=0||r.indexOf("www.",0)>=0||(r=PivotCollection.base.substring(0,PivotCollection.base.lastIndexOf("/")+1)+r);o=n(".pv-canvas")[0].getContext("2d");TileController=new PivotViewer.Views.TileController(_imageController);_tiles=TileController.initTiles(PivotCollection.items,r,o);_imageController.setup(r.replace("\\","/"))});n.subscribe("/PivotViewer/Settings/Changed",function(t){var i=PivotCollection.categories[t.visibleCategories[0]];i.uiInit||PV.initUICategory(i);PV.selectView(0);LoadSem.acquire(function(r){var o=n(".pv-facet"),c=n(".pv-toolbarpanel-sort"),h=n("#pv-long-search-cat"),s,u;for(o.hide(),o.attr("visible","invisible"),n(".pv-toolbarpanel-sort option").remove(),n("#pv-long-search-cat option").remove(),f=[],s=0;s<t.visibleCategories.length;s++)(u=PivotCollection.categories[t.visibleCategories[s]],u.isFilterVisible)&&(u.isLongString()?(h.append("<option value='"+PV.cleanName(u.name.toLowerCase())+"'>"+u.name+"<\/option>"),f.push(u)):(u.recount=!0,o.eq(u.visIndex).show(),o.eq(u.visIndex).attr("visible","visible"),c.append("<option value='"+s+"' search='"+PV.cleanName(u.name.toLowerCase())+"'>"+u.name+"<\/option>")));n("#pv-long-search-cat option").length==0?(h.hide(),n("#pv-long-search").hide()):(h.show(),n("#pv-long-search").show());e(o.eq(i.visIndex));n(".pv-filterpanel-accordion").accordion("option","active",i.visIndex);n("#pv-primsort").trigger("change");r()})});n.subscribe("/PivotViewer/ImageController/Collection/Loaded",function(){for(var l,k,a,h,s,u,v=["<div class='pv-filterpanel-accordion'>"],c=["<div id='pv-long-search-box'><br><select id='pv-long-search-cat'>"],y=[],p=0,i=0;i<PivotCollection.categories.length;i++)u=PivotCollection.categories[i],u.isFilterVisible&&(u.isLongString()?(c.push("<option value='"+PV.cleanName(u.name.toLowerCase())+"'>"+u.name+"<\/option>"),f.push(u)):(p++,v.push("<h3 class='pv-facet' style='display:inherit' facet='"+PV.cleanName(u.name.toLowerCase())+"'><a href='#' title='"+u.name+"'>"+u.name+"<\/a><div class='pv-filterpanel-accordion-heading-clear' facetType='"+u.type+"'>&nbsp;<\/div><\/h3><div style='display:'inherit' style='height:30%' id='pv-cat-"+PV.cleanName(u.name)+"'><\/div>"),y.push("<option value='"+i+"' search='"+PV.cleanName(u.name.toLowerCase())+"'>"+u.name+"<\/option>")));if(c.length>1){c.push("<\/div><\/select>");n(".pv-filterpanel").append(c.join("")+"<span class='pv-search-clear' id='pv-long-search-clear'>&nbsp;<\/span><input type=text length=25 id='pv-long-search' placeholder='Search text...'>");n("#pv-long-search").on("keyup",function(t){var u=this.value.toLowerCase(),i;t.keyCode==13?(i=PivotCollection.getCategoryByName([n("#pv-long-search-cat").val()]),i.uiInit||(Loader.loadColumn(i),i.uiInit=!0),LoadSem.acquire(function(t){r=n("#pv-long-search").val()!=null&&n("#pv-long-search").val()!=""?{facet:_nameMapping[n("#pv-long-search-cat").val()],value:n("#pv-long-search").val().toLowerCase()}:null;PV.filterCollection();t()})):n("#pv-long-search").css("text-decoration","").css("color","black");n("#pv-long-search-clear").css("visibility","visible")});n("#pv-long-search-clear").click(function(){n("#pv-long-search").val("");n("#pv-long-search-clear").css("visibility","hidden");r!=null&&(r=null,PV.filterCollection())});n("#pv-long-search-cat").on("mousedown",function(){var r,t,i,u;if(n(this).attr("dirty")==1)for(n("#pv-long-search-cat option").remove(),r=n(".pv-filterpanel-search").val(),t=0;t<f.length;t++)(i=f[t],u=PV.cleanName(i.name.toLowerCase()),r!=""&&u.indexOf(r)<0)||n("#pv-long-search-cat").append("<option value='"+PV.cleanName(i.name.toLowerCase())+"'>"+i.name+"<\/option>");n(this).attr("dirty",0)})}v.push("<\/div>");n(".pv-filterpanel").append(v.join(""));n(".pv-filterpanel-accordion").css("height",n(".pv-filterpanel").height()-n(".pv-filterpanel-search").height()-75-n("#pv-long-search-box").height()+"px");n(".pv-filterpanel-accordion").accordion({icons:!1});n("#pv-primsortcontrols").append('<select id="pv-primsort" class="pv-toolbarpanel-sort">'+y.join("")+"<\/select>");n(".pv-filterpanel-accordion").accordion("option","active",p);var d=n(".pv-viewpanel"),nt=_self.width(),tt=n(".pv-mainpanel").height(),it=n(".pv-filterpanel").width()+18;for(PivotCollection.config==undefined&&(PivotCollection.config=[]),PivotCollection.config.views==undefined&&(PivotCollection.config.views=["grid","bucket","crosstab"]),_options.View!=undefined&&PivotCollection.config.views.indexOf(_options.View)<0&&PivotCollection.config.views.push(_options.View),i=0;i<PivotCollection.config.views.length;i++)l=PivotCollection.config.views[i],PivotViewer.Utils.loadScript("src/views/"+l.toLowerCase()+"view.min.js"),eval("var view = new PivotViewer.Views."+l.charAt(0).toUpperCase()+l.substring(1)+"View()"),view.setOptions(_options),t.push(view);for(d.append("<div class='pv-viewpanel-view'><\/div>"),i=0;i<t.length;i++)t[i]instanceof PivotViewer.Views.IPivotViewerView&&(t[i].setup(nt,tt,it,4,TileController.getMaxTileRatio()),n(".pv-toolbarpanel-viewcontrols").append("<div class='pv-toolbarpanel-view' id='pv-toolbarpanel-view-"+i+"' title='"+t[i].getViewName()+"'><img id='pv-viewpanel-view-"+i+"-image' src='"+t[i].getButtonImage()+"' alt='"+t[i].getViewName()+"' /><\/div>"));for(n(".pv-loading").remove(),k=n(".pv-toolbarpanel").innerWidth()-(n(".pv-toolbarpanel-brandimage").outerWidth(!0)+25+n(".pv-toolbarpanel-name").outerWidth(!0)+30+n(".pv-toolbarpanel-zoomcontrols").outerWidth(!0)+t.length*29+2*n(".pv-toolbarpanel-sortcontrols").outerWidth(!0)),n(".pv-toolbarpanel-breadcrumb").css("width",k+"px"),a=n(".pv-filterpanel"),a.append("<div class='pv-filterpanel-version'><a href='#pv-open-version'>About<\/a>&nbsp;<a href='#pv-open-Settings'>Settings<\/a><\/div>"),a.append("<div id='pv-open-version' class='pv-modal-dialog'><div><a href='#pv-modal-dialog-close' title='Close' class='pv-modal-dialog-close'>X<\/a><h2>SuAVE: <u>Su<\/u>rvey <u>A<\/u>nalysis <u>V<\/u>isualization and <u>E<\/u>xploration<\/h2><p>This app was designed and developed at the <a href='www.sdsc.edu'>San Diego Supercomputer Center<\/a> for the purpose of enabling innovative visualization of common analytical and statistical techniques with the particular application to education.<p>Project Leads:<br>Ilya Zaslavsky, SDSC (<a href='mailto:zaslavsk@sdsc.edu'>zaslavsk@sdsc.edu<\/a>)<br>Prof. Akos Rona-Tas, UCSD Sociology (<a href='mailto:aronatas@ucsd.edu'>aronatas@ucsd.edu<\/a>)<br>Prof. Kevin Lewis, UCSD Sociology (<a href='mailto:lewis@ucsd.edu'>lewis@ucsd.edu<\/a>)<p>Lead Programmer:<br>Ren&eacute; Patnode, UCSD Sociology (<a href='mailto:rpatnode@ucsd.edu'>rpatnode@ucsd.edu<\/a>)<p>Funded by <a href='http://www.nsf.gov/awardsearch/showAward?AWD_ID=1443082'>NSF Grant ACI-1443082<\/a>.<\/div><\/div>"),a.append("<div id='pv-open-Settings' class='pv-modal-dialog modal-xl'><div><h2>Settings<\/h2><div id='pv-options-text'>&nbsp;<\/div><\/div><\/div>"),h="<input type='checkbox' id='show-missing'"+(Settings.showMissing?" checked":"")+"> Display missing values<p><h3>Visible Variables (Double-click to select)<\/h3><p>",h+="<table><tr><th>All Variables:<\/th><th>Variables to Display:<\/th><tr><td><select id='pv-all-columns' multiple style='width:250px' size=20>",i=0;i<PivotCollection.categories.length;i++)u=PivotCollection.categories[i],h+="<option value="+i+" search='"+PV.cleanName(u.name.toLowerCase())+"'>"+u.name+"<\/option>";if(h+="<\/select><\/td><td><select id='pv-column-select' multiple style='width:250px' size=20>",Settings.visibleCategories.length==0)h+="<option value='-1'>Select Variables...<\/option>";else for(i=0;i<Settings.visibleCategories.length;i++)u=PivotCollection.categories[Settings.visibleCategories[i]],h+="<option value="+Settings.visibleCategories[i]+" search='"+PV.cleanName(u.name.toLowerCase())+"'>"+u.name+"<\/option>";h+="<\/select><\/td><td width=200><input id='pv-column-search' placeholder='Search For Variable...' type='text' size=20><div class='pv-search-clear' id='pv-column-search-clear'>&nbsp;<\/div><p><button id='pv-column-select-all'>Select All<\/button><p><button id='pv-column-deselect-all'>Deselect All<\/button><p><button id='pv-settings-submit'>Submit<\/button><p><button id='pv-Settings-cancel'>Cancel<\/button><\/td><\/table>";n("#pv-options-text").html(h);n("#pv-all-columns").dblclick(function(){var i,u,r,t;if(!(n("#pv-all-columns option[value='-1']").length>0)){for(i=parseFloat(n("#pv-all-columns").val()),u=PivotCollection.categories[i],n("#pv-column-select option[value='-1']").length>0&&n("#pv-column-select option[value='-1']").remove(),r=n("#pv-column-select option"),t=0;t<r.length;t++)if(parseFloat(r[t].value)==i)break;else if(parseFloat(r[t].value)>i){n(r[t]).before(n("<option><\/option>").attr("search",PV.cleanName(u.name.toLowerCase())).val(i).html(u.name));break}t==r.length&&n("#pv-column-select").append("<option value="+i+" search='"+PV.cleanName(u.name.toLowerCase())+"'>"+u.name+"<\/option>")}});n("#pv-column-select").dblclick(function(){if(!(n("#pv-column-select option[value='-1']").length>0)){var t=parseFloat(n("#pv-column-select").val()),i=PivotCollection.categories[t];n("#pv-column-select option[value='"+t+"']").remove();n("#pv-column-select option").length==0&&n("#pv-column-select").append("<option value='-1'>Select Variables...<\/option>")}});n("#pv-column-select-all").click(function(){var e=n("#pv-all-columns option"),u=n("#pv-column-select option"),i,t,r,f;if(e.eq(0).val()!=-1)for(u.eq(0).val()==-1&&n("#pv-column-select option").remove(),i=0,t=0;i<e.length;)r=parseFloat(e.eq(i).val()),f=PivotCollection.categories[r],t==u.length?(n("#pv-column-select").append(n("<option><\/option>").attr("search",PV.cleanName(f.name.toLowerCase())).val(r).html(f.name)),i++):r==parseFloat(u[t].value)?(i++,t++):parseFloat(u[t].value)>r?(n(u[t]).before(n("<option><\/option>").attr("search",PV.cleanName(f.name.toLowerCase())).val(r).html(f.name)),i++):t++});n("#pv-column-deselect-all").click(function(){n("#pv-column-select option").remove();n("#pv-column-select").append("<option value='-1'>Select Variables...<\/option>")});n("#pv-settings-submit").click(function(){var i,t,u,r;for(Settings.visibleCategories=[],i=n("#pv-column-select option"),t=0;t<i.length;t++)Settings.visibleCategories.push(i[t].value),Settings.visibleCategories[i[t].innerHTML]=!0;Settings.showMissing=n("#show-missing").prop("checked");u=Lawnchair({name:PivotCollection.name});u.save({key:"Settings",value:Settings});n.publish("/PivotViewer/Settings/Changed",[Settings]);window.open("#pv-modal-dialog-close","_self");_sortCategory=n("#pv-primsort option").eq(0).html();r=PivotCollection.getCategoryByName(_sortCategory);r.uiInit||PV.initUICategory(r);LoadSem.acquire(function(n){var t,i;for(_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters)),_filterList=[],t=0;t<_tiles.length;t++)i=_tiles[t],i.missing=!Settings.showMissing&&i.item.getFacetByName(r.name)==undefined,i.filtered&&_filterList.push(_tiles[t]);PV.filterViews();n()})});n("#pv-Settings-cancel").click(function(){window.open("#pv-modal-dialog-close","_self");n("#show-missing").prop("checked",Settings.showMissing);n("#pv-all-columns option").eq(0).val()==-1&&n("#pv-all-columns option").remove();o("#pv-all-columns");n("#pv-column-select option").eq(0).val()==-1&&n("#pv-column-select option").remove();w("#pv-column-select",!0);n("#pv-column-search").val("");n("#pv-column-search-clear").css("visibility","hidden")});n("#pv-column-search").on("keyup",function(){var t=this.value.toLowerCase();t!=""?(n("#pv-all-columns option").eq(0).val()==-1&&n("#pv-all-columns option").remove(),o("#pv-all-columns",t),n("#pv-column-search-clear").css("visibility","visible"),n("#pv-all-columns option").length==0&&n("#pv-all-columns").append("<option value='-1' css:'display: block'>No matching variables.<\/option>")):(n("#pv-column-search-clear").css("visibility","hidden"),o("#pv-all-columns"))});n("#pv-column-search-clear").click(function(){n("#pv-column-search").val("");n("#pv-column-search-clear").css("visibility","hidden");n("#pv-all-columns option").eq(0).val()==-1&&n("#pv-all-columns option").remove();o("#pv-all-columns")});n(".pv-toolbarpanel-view").click(function(){var n=this.id.substring(this.id.lastIndexOf("-")+1,this.id.length);n!=null&&PV.selectView(parseInt(n))});n("#pv-primsort").on("change",function(){_sortCategory=n("#pv-primsort option:selected").html();var t=PivotCollection.getCategoryByName(_sortCategory);t.uiInit||PV.initUICategory(t);LoadSem.acquire(function(n){var t,i;for(_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters)),_filterList=[],t=0;t<_tiles.length;t++)i=_tiles[t],i.missing=!Settings.showMissing&&i.item.getFacetByName(_sortCategory)==undefined,i.filtered&&_filterList.push(_tiles[t]);PV.filterViews();n()})});n(".pv-facet").click(function(){e(n(this))});n(".pv-filterpanel-clearall").click(function(){var i=n(".pv-facet-value:checked"),t,u;for(i.prop("checked",!1),t=0;t<i.length;t++)i.eq(t).attr("itemvalue")=="CustomRange"&&b(n(i[t]).attr("itemfacet"));u=n(".pv-facet-numericslider");u.modSlider("clearValues");u.siblings(".pv-facet-numericslider-range-val").html("&nbsp;");n(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden");n("#pv-long-search-clear").css("visibility","hidden");n("#pv-long-search").val("");r=null;PV.filterCollection()});n(".pv-filterpanel-accordion-heading-clear").click(function(){var t=this.attributes.facetType.value,i,r,u;if(t=="DateTime")for(i=n(this).parent().next().find(".pv-facet-value:checked"),i.prop("checked",!1),r=0;r<i.length;r++)b(n(i[r]).attr("itemfacet"));else t=="String"?n(this).parent().next().find(".pv-facet-value:checked").prop("checked",!1):(t=="Number"||t=="Ordinal")&&(u=n(this).parent().next().find(".pv-facet-numericslider"),u.modSlider("clearValues"),u.siblings(".pv-facet-numericslider-range-val").html("&nbsp;"));PV.filterCollection();n(this).css("visibility","hidden")});n(".pv-facet-customrange").on("change",function(){g(this)});n(".pv-infopanel-details").on("click",".detail-item-value-filter",function(){return n.publish("/PivotViewer/Views/Item/Filtered",[{category:n(this).parent().children().attr("pv-detail-item-title"),min:n(this).attr("pv-detail-item-value"),values:null}]),!1});n(".pv-infopanel-details").on("click",".pv-infopanel-detail-description-more",function(){var t=n(this),i=t.prev();t.text()=="More"?(i.css("height",""),t.text("Less")):(i.css("height","100px"),t.text("More"))});n(".pv-infopanel-controls-navleft").click(function(){for(var r,i=1;i<_filterList.length;i++)if(_filterList[i].item.id==_selectedItem.item.id){r=_filterList[i-1];n.publish("/PivotViewer/Views/Item/Selected",[{item:r}]);t[_currentView].centerOnTile(r);break}});n(".pv-infopanel-controls-navright").click(function(){for(var r,i=0;i<_filterList.length-1;i++)if(_filterList[i].item.id==_selectedItem.item.id){r=_filterList[i+1];n.publish("/PivotViewer/Views/Item/Selected",[{item:r}]);t[_currentView].centerOnTile(r);break}});n(".pv-toolbarpanel-sort").on("mousedown",function(){n(this).attr("dirty")==1&&w("#"+n(this).attr("id"),!1,PV.cleanName(n(".pv-filterpanel-search").val().toLowerCase()));n(this).attr("dirty",0)});n(".pv-value-search").on("keyup",function(){var r=PV.cleanName(this.value.toLowerCase()),i,t;r!=""?(i=PivotCollection.getCategoryByName(_nameMapping[n(".pv-facet").eq(n(".pv-filterpanel-accordion").accordion("option","active")).attr("facet")]),t=[],i.isString()&&i.name.toLowerCase().indexOf(r)==-1&&(t=n('.pv-filterpanel-accordion-facet-list-item[id^="pv-facet-value-'+PV.cleanName(i.name)+'"]'),t.hide(),t=t.filter(function(){return PV.cleanName(n(this).children().eq(0).attr("itemvalue").toLowerCase()).indexOf(r)>=0&&n(this).children().eq(2).html()>0}),t.show())):n(".pv-filterpanel-accordion-facet-list-item").show()});n("#pv-value-search-clear").click(function(){n(".pv-value-search").val("");n("#pv-value-search-clear").css("visibility","hidden");n(".pv-filterpanel-accordion").accordion("option","collapsible",!1);n(".pv-filterpanel-accordion-facet-list-item").show()});n(".pv-filterpanel-search").on("keyup",function(){var i=PV.cleanName(this.value.toLowerCase()),t,r;i!=""?(t=n(".pv-facet[facet*='"+i+"'][visible='visible']"),t.show(),n(".pv-toolbarpanel-sort").attr("dirty",1),n("#pv-long-search-cat").attr("dirty",1),n("#pv-long-search-cat").val(n("#pv-long-search-cat option[value*='"+i+"']").eq(0).val()),n(".pv-facet:not([facet*='"+i+"'][visible='visible'])").hide(),n("#pv-filterpanel-search-clear").css("visibility","visible"),t.length>0?(r=PivotCollection.getCategoryByName(_nameMapping[t.eq(0).attr("facet")]),r.uiInit||PV.initUICategory(r),LoadSem.acquire(function(i){n(".pv-filterpanel-accordion").accordion("option","collapsible",!1);n(".pv-filterpanel-accordion").accordion("option","active",r.visIndex);e(t.eq(0));i()})):(n(".pv-filterpanel-accordion").accordion("option","collapsible",!0),n(".pv-filterpanel-accordion").accordion("option","active",!1))):(n(".pv-facet[visible='visible']").show(),n(".pv-toolbarpanel-sort").attr("dirty",1),n("#pv-long-search-cat").attr("dirty",1),n(".pv-filterpanel-accordion").accordion("option","collapsible",!1),n("#pv-filterpanel-search-clear").css("visibility","hidden"))});n("#pv-filterpanel-search-clear").click(function(){n(".pv-filterpanel-search").val("");n(".pv-toolbarpanel-sort").attr("dirty",1);n("#pv-long-search-cat").attr("dirty",1);n("#pv-filterpanel-search-clear").css("visibility","hidden");n(".pv-filterpanel-accordion").accordion("option","collapsible",!1);n(".pv-facet[visible='visible']").show()});s=n(".pv-canvas");s.mouseup(function(t){if(t.which!=1)return!1;var i=n(this).offset();_mouseMove&&(_mouseMove.x!=0||_mouseMove.y!=0)||PV.getCurrentView().handleClick({x:t.pageX-i.left,y:t.pageY-i.top});_mouseDrag=null;_mouseMove=!1});s.mouseout(function(){_mouseDrag=null;_mouseMove=!1});s.mousedown(function(t){if(t.which!=1)return!1;var i=n(this).offset(),r=t.pageX-i.left,u=t.pageY-i.top;_mouseDrag={x:r,y:u}});s.mousemove(function(t){var u=n(this).offset(),i=t.pageX-u.left,r=t.pageY-u.top;_mouseDrag==null?PV.getCurrentView().handleHover({x:i,y:r}):(_mouseMove={x:i-_mouseDrag.x,y:r-_mouseDrag.y},_mouseDrag={x:i,y:r},n.publish("/PivotViewer/Views/Canvas/Drag",[_mouseMove]))});s.on("mousewheel",function(t,i){var u=n(this).offset(),r;TileController.setQuarticEasingOut();r=n(".pv-toolbarpanel-zoomslider").slider("option","value");i>0?r=r<5?5:r+5:i<0&&(r=r-5);r=Math.max(0,Math.min(100,r));PV.zoom(r,t.pageX-u.left,t.pageY-u.top)});s.on("contextmenu",function(t){var i=n(this).offset();PV.getCurrentView().handleContextMenu({x:t.pageX-i.left,y:t.pageY-i.top})});s.on("touchstart",function(t){var i=t.originalEvent,r=n(this).offset();_mouseDrag={x:i.touches[0].pageX-r.left,y:i.touches[0].pageY-r.top}});s.on("touchmove",function(t){var i,r,s,h;try{if(i=t.originalEvent,t.preventDefault(),i.touches.length>1){t.preventDefault();var u=1e7,f=1e7,e=0,o=0;for(r=0;r<i.touches.length;r++)i.touches[r].pageX<u&&(u=i.touches[r].pageX),i.touches[r].pageX>e&&(e=i.touches[r].pageX),i.touches[r].pageY<f&&(f=i.touches[r].pageY),i.touches[r].pageY>o&&(o=i.touches[r].pageY);s=(u+e)/2;h=(f+o)/2;TileController.setLinearEasingBoth();n.publish("/PivotViewer/Views/Canvas/Zoom",[{x:s,y:h,scale:i.scale}]);return}var c=n(this).offset(),l=i.touches[0].pageX-c.left,a=i.touches[0].pageY-c.top;_mouseMove={x:l-_mouseDrag.x,y:a-_mouseDrag.y};_mouseDrag={x:l,y:a};n.publish("/PivotViewer/Views/Canvas/Drag",[_mouseMove])}catch(v){Debug.log(v.message)}});s.on("touchend",function(t){var i=t.originalEvent;if(i.touches.length==1&&_mouseDrag==null){var r=n(this).offset(),u=i.touches[0].pageX-r.left,f=i.touches[0].pageY-r.top;_mouseMove&&(_mouseMove.x!=0||_mouseMove.y!=0)||PV.getCurrentView().handleClick({x:u,y:f})}_mouseDrag=null;_mouseMove=!1;return});_sortCategory=n("#pv-primsort option").eq(0).html();u=PivotCollection.getCategoryByName(_sortCategory);u.uiInit||PV.initUICategory(u);LoadSem.acquire(function(t){var i,r;for(_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters)),i=0;i<_tiles.length;i++)r=_tiles[i],r.missing=!Settings.showMissing&&r.item.getFacetByName(_sortCategory)==undefined;PV.filterCollection();Settings.visibleCategories.length<PivotCollection.categories.length?n.publish("/PivotViewer/Settings/Changed",[Settings]):n(".pv-facet").attr("visible","visible");_options.View!=undefined?PV.selectView(_options.View):PV.selectView(0);TileController.beginAnimation();t()})});p=0;PV.zoom=function(t,i,r){i==undefined&&(i=n(".pv-canvas").width()/2);r==undefined&&(r=n(".pv-canvas").height()/2);n(".pv-toolbarpanel-zoomslider").slider("option","value",t);n.publish("/PivotViewer/Views/Canvas/Zoom",[{x:i,y:r,delta:.5*(t-p)}]);p=t};o=function(t,i){var u,r,o,f,e;for(i==undefined&&(i=""),u=n(t),r=0;r<u.length;r++){for(o=u.eq(r).val(),u.eq(r).children().remove(),f=0;f<PivotCollection.categories.length;f++)e=PivotCollection.categories[f],(f==o||e.name.toLowerCase().indexOf(i)!=-1)&&u.eq(r).append("<option value="+f+" search='"+PV.cleanName(e.name.toLowerCase())+"'>"+e.name+"<\/option>");u.eq(r).val(o)}};w=function(t,i,r){var f,u,s,o,h,e;for(r==undefined&&(r=""),i==undefined&&(i=!1),f=n(t),u=0;u<f.length;u++){for(s=f.eq(u).val(),f.eq(u).children().remove(),o=0;o<Settings.visibleCategories.length;o++)h=Settings.visibleCategories[o],e=PivotCollection.categories[h],(e.isFilterVisible&&!e.isLongString()||i)&&(h==s||PV.cleanName(e.name).toLowerCase().indexOf(r)!=-1)&&f.eq(u).append("<option value="+Settings.visibleCategories[o]+" search='"+PV.cleanName(e.name.toLowerCase())+"'>"+e.name+"<\/option>");f.eq(u).val(s)}};n.subscribe("/PivotViewer/Views/Item/Selected",function(i){var r,l,o,f,s,u,h,a,e,c;if(i.item===undefined||i.item==null){PV.deselectInfoPanel();_selectedItem!=null&&_selectedItem.setSelected(!1);t[_currentView].setSelected(null);return}if(r=i.item,r!=null){for(l=!0,n(".pv-infopanel-heading").empty(),n(".pv-infopanel-heading").append('<a href="'+r.item.href+'" target="_blank">'+r.item.name+"<\/a><\/div>"),o=n(".pv-infopanel-details"),o.empty(),r.item.description!=undefined&&r.item.description.length>0&&o.append("<div class='pv-infopanel-detail-description' style='height:100px;'>"+r.item.description+"<\/div><div class='pv-infopanel-detail-description-more'>More<\/div>"),r.item.id==_filterList[0].id?(n(".pv-infopanel-controls-navleft").hide(),n(".pv-infopanel-controls-navleftdisabled").show()):(n(".pv-infopanel-controls-navleft").show(),n(".pv-infopanel-controls-navleftdisabled").hide()),r.item.id==_filterList[_filterList.length-1].id?(n(".pv-infopanel-controls-navright").hide(),n(".pv-infopanel-controls-navrightdisabled").show()):(n(".pv-infopanel-controls-navright").show(),n(".pv-infopanel-controls-navrightdisabled").hide()),f=[],s=Loader.getRow(r.item.id),u=0;u<s.length;u++)if(h=PivotCollection.getCategoryByName(s[u].name),Settings.visibleCategories[h.name]){for(f[u]="<div class='pv-infopanel-detail "+(l?"detail-dark":"detail-light")+"'><div class='pv-infopanel-detail-item detail-item-title' pv-detail-item-title='"+h.name+"'>"+h.name+"<\/div>",a=0;a<s[u].values.length;a++)e=s[u].values[a],f[u]+="<div pv-detail-item-value='"+e.value+"' class='pv-infopanel-detail-item detail-item-value"+(h.isFilterVisible?" detail-item-value-filter":"")+"'>",f[u]+=e.href!=null&&e.href!=""?"<a class='detail-item-link' href='"+e.href+"'>"+e.label+"<\/a>":e.label,f[u]+="<\/div>";f[u]+="<\/div>";l=!l}if(r.item.links.length>0)for(n(".pv-infopanel-related").empty(),c=0;c<r.item.links.length;c++)n(".pv-infopanel-related").append("<a href='"+r.item.links[c].href+"'>"+r.item.links[c].name+"<\/a><br>");o.append(f.join(""));n(".pv-infopanel").fadeIn();o.css("height",n(".pv-infopanel").height()-(n(".pv-infopanel-controls").height()+n(".pv-infopanel-heading").height()+n(".pv-infopanel-copyright").height()+n(".pv-infopanel-related").height())-20+"px");_selectedItem!=null&&_selectedItem.setSelected(!1);r.setSelected(!0);_selectedItem=r;t[_currentView].setSelected(_selectedItem)}});n.subscribe("/PivotViewer/Views/Item/Filtered",function(t){var u,f,r,i;if(t!=undefined&&t!=null){for(u=t.length!=undefined?t:[t],f=0;f<u.length;f++)r=u[f],i=PivotCollection.getCategoryByName(r.category),i.uiInit||(PV.initUICategory(i),i.isNumber()?a(i,s[i.name].values):i.isOrdinal()&&v(i,h[i.name].values)),LoadSem.acquire(function(t){var o,f,a,e,l;if(i.isString())if(n(".pv-facet-value[itemfacet='"+PV.cleanName(i.name)+"']").prop("checked",!1),r.values){if(r.values.length==1)f=n(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(i.name)+"__"+PV.cleanName(r.values[0].toString()))+" input"),f.prop("checked",!0),u.length==1&&PV.clickValue(f[0]);else if(r.values.length>0){for(o=0;o<r.values.length;o++)n(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(i.name)+"__"+PV.cleanName(r.values[o].toString()))+" input").prop("checked",!0);n(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(i.name)+"__"+PV.cleanName(r.values[0].toString()))+" input").parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible");u.length==1&&PV.filterCollection()}}else f=n(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(i.name)+"__"+PV.cleanName(r.min.toString()))+" input"),f.prop("checked",!0),u.length==1&&PV.clickValue(f[0]);else if(i.isNumber()||i.isOrdinal())a=n("#pv-facet-numericslider-"+PivotViewer.Utils.escapeMetaChars(PV.cleanName(i.name))),r.max==undefined&&(r.max=r.min),PV.dragCategorySlider(a,r.min,r.max,u.length==1);else if(i.isDateTime()){e=PV.cleanName(i.name);n("#pv-facet-value-"+e+"__CustomRange:first-child").prop("checked",!0);d(e);var c=n("#pv-custom-range-"+e+"__StartDate"),v=n("#pv-custom-range-"+e+"__FinishDate"),s=new Date(r.min),h=new Date(r.max);c[0].value=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear();v[0].value=h.getMonth()+1+"/"+h.getDate()+"/"+h.getFullYear();c.datepicker("option","minDate",s);v.datepicker("option","maxDate",h);l=n(c).parent().parent().parent().parent().children().next().find(".pv-facet-value:checked");l.find("[itemvalue!='CustomRange']").prop("checked",!1);l.parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible");u.length==1&&PV.filterCollection()}t()});u.length>1&&PV.filterCollection()}});PV.clickValue=function(t){var u=PivotCollection.getCategoryByName(_nameMapping[n(t).attr("itemfacet")]),f=_nameMapping[n(t).attr("itemvalue")],i,r;if(n(t).prop("checked")){if(n(t).parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"),n(t).attr("itemvalue")=="CustomRange"){d(n(t).attr("itemfacet"));return}i=n("input[itemfacet|='"+n(t).attr("itemfacet")+"']:checked").length>1;r=!1}else n(t).prop("checked")||(n(t).attr("itemvalue")=="CustomRange"&&b(n(t).attr("itemfacet")),n("input[itemfacet|='"+n(t).attr("itemfacet")+"']:checked").length==0?(i=!0,n(t).parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden")):i=!1,r=!0);u.isString()?PV.filterCollection({category:u,enlarge:i,clear:r,value:f}):(start=n(t).attr("startdate"),end=n(t).attr("enddate"),PV.filterCollection({category:u,enlarge:i,clear:r,value:f,min:new Date(start),max:new Date(end)}))};PV.dragCategorySlider=function(t,i,r,u){var f=n(t),e=f.modSlider("option","min"),o=f.modSlider("option","max");i=="(no info)"&&(i=0);i>e||r<o?(f.parent().find(".pv-facet-numericslider-range-val").text(i+" - "+r),f.modSlider("values",0,i),f.modSlider("values",1,r),f.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible")):i==e&&r==o&&f.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden");u!=!1&&PV.filterCollection()};var u=function(n,t,i,r,u){n[t]==undefined&&(n[t]=[]);var e=n[t],f=e[i+"a"];f!=undefined?(f.items[r+"a"]=r,f.items.push(r),f.start>u?f.start=u:f.end<u&&(f.end=u)):(f=new PivotViewer.Models.DateTimeInfo(i,u,u),f.items[r+"a"]=r,f.items.push(r),e.push(f),e[i+"a"]=f)},ut=function(n){for(var t,f,h,c,l,a,v,d,tt,i,o=new Date(864e13),s=new Date(-864e13),y=!1,p=!1,w=!1,r=0;r<PivotCollection.items.length;r++)(f=PivotCollection.items[r],h=f.getFacetByName(n.name),h!=undefined)&&(t=new Date(h.values[0].value),t<o&&(o=t),t>s&&(s=t),t.getHours()!=0&&(y=!0),t.getMinutes()!=0&&(p=!0),t.getSeconds()!=0&&(w=!0));var g=s.getFullYear()-o.getFullYear()+o.getFullYear()%10>9,b=s.getFullYear()>o.getFullYear(),k=b||s.getMonth()>o.getMonth(),nt=k||s.getDate()>o.getDate();for(r=0;r<PivotCollection.items.length;r++)if(f=PivotCollection.items[r],h=f.getFacetByName(n.name),h!=undefined){var t=new Date(h.values[0].value),i=0,e=t.getFullYear(),it=e-e%10;g&&u(n.datetimeBuckets,i++,it+"s",f.id,t);b&&u(n.datetimeBuckets,i++,e,f.id,t);c=PivotViewer.Utils.getMonthName(t);k&&u(n.datetimeBuckets,i++,c+", "+e,f.id,t);l=t.getDate();nt&&u(n.datetimeBuckets,i++,c+" "+l+", "+e,f.id,t);a=PivotViewer.Utils.getHour(t);v=PivotViewer.Utils.getMeridian(t);y&&u(n.datetimeBuckets,i++,c+" "+l+", "+e+" "+a+" "+v,f.id,t);d=PivotViewer.Utils.getMinutes(t);p&&u(n.datetimeBuckets,i++,c+" "+l+", "+e+" "+a+":"+d+" "+v,f.id,t);tt=PivotViewer.Utils.getSeconds(t);w&&u(n.datetimeBuckets,i,c+" "+l+", "+e+" "+a+":"+d+":"+tt+" "+v,f.id,t)}for(r=0;r<n.datetimeBuckets.length;r++)n.datetimeBuckets[r].sort(function(n,t){return n.start-t.start});i=0;g&&(n.datetimeBuckets.decade=n.datetimeBuckets[i++]);b&&(n.datetimeBuckets.year=n.datetimeBuckets[i++]);k&&(n.datetimeBuckets.month=n.datetimeBuckets[i++]);nt&&(n.datetimeBuckets.day=n.datetimeBuckets[i++]);y&&(n.datetimeBuckets.hour=n.datetimeBuckets[i++]);p&&(n.datetimeBuckets.minute=n.datetimeBuckets[i++]);w&&(n.datetimeBuckets.second=n.datetimeBuckets[i])},b=function(t){n("#pv-custom-range-"+t+"__Start").css("visibility","hidden");n("#pv-custom-range-"+t+"__Finish").css("visibility","hidden");n("#pv-custom-range-"+t+"__StartDate").datepicker("setDate",null);n("#pv-custom-range-"+t+"__FinishDate").datepicker("setDate",null);n("#pv-custom-range-"+t+"__FinishDate").datepicker("option","minDate",null);n("#pv-custom-range-"+t+"__StartDate").datepicker("option","minDate",null);n("#pv-custom-range-"+t+"__FinishDate").datepicker("option","maxDate",null);n("#pv-custom-range-"+t+"__StartDate").datepicker("option","maxDate",null)},d=function(t){var o=_nameMapping[t],i=PivotCollection.getCategoryByName(o),r,u,f,e;n("#pv-custom-range-"+t+"__Start").css("visibility","visible");n("#pv-custom-range-"+t+"__Finish").css("visibility","visible");n("#pv-custom-range-"+t+"__StartDate").datepicker({showOn:"button",changeMonth:!0,changeYear:!0,buttonText:"Show Date",buttonImageOnly:!0,buttonImage:"http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"});n("#pv-custom-range-"+t+"__FinishDate").datepicker({showOn:"button",changeMonth:!0,changeYear:!0,buttonText:"Show Date",buttonImageOnly:!0,buttonImage:"http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"});i.datetimeBuckets.day!=undefined&&i.datetimeBuckets.day.length>0&&(f=i.datetimeBuckets.day[i.datetimeBuckets.day.length-1].start,e=i.datetimeBuckets.day[0].start,n("#pv-custom-range-"+t+"__StartDate").datepicker("option","defaultDate",e),n("#pv-custom-range-"+t+"__FinishDate").datepicker("option","defaultDate",f),i.datetimeBuckets.year!=undefined&&i.datetimeBuckets.year.length>0&&(r=i.datetimeBuckets.year[i.datetimeBuckets.year.length-1].name,u=i.datetimeBuckets.year[0].name,n("#pv-custom-range-"+t+"__StartDate").datepicker("option","yearRange",u+":"+r),n("#pv-custom-range-"+t+"__FinishDate").datepicker("option","yearRange",u+":"+r)))},g=function(t){var i,r,f,u;if(n(t).attr("itemvalue")=="CustomRangeStart"?(i=n(t)[0].value,r=n("#pv-custom-range-"+n(t).attr("itemfacet")+"__FinishDate")[0].value,r==""&&n("#pv-custom-range-"+n(t).attr("itemfacet")+"__FinishDate").datepicker("option","minDate",new Date(i))):n(t).attr("itemvalue")=="CustomRangeFinish"&&(r=n(t)[0].value,i=n("#pv-custom-range-"+n(t).attr("itemfacet")+"__StartDate")[0].value,i==""&&n("#pv-custom-range-"+n(t).attr("itemfacet")+"__StartDate").datepicker("option","maxDate",new Date(r))),i&&r){for(f=n(t).parent().parent().parent().parent().children().next().find(".pv-facet-value:checked"),u=0;u<f.length;u++)n(f[u]).attr("itemvalue")!="CustomRange"&&n(f[u]).prop("checked",!1);PV.filterCollection()}};n.fn.PivotViewer=function(t){if(c[t])return c[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on jQuery.PivotViewer");else return c.init.apply(this,arguments)}})(jQuery);