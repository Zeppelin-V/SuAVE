var PV={},PivotCollection=new PivotViewer.Models.Collection,TileController=null,Loader=null,LoadSem=new Semaphore(1),Settings={showMissing:!1,visibleCategories:void 0},PARA={},timeout=null,_tooltip_item=null,_tooltip_enable=!0,A=[],B=[],D=[],AB=[],AD=[],BD=[],ABD=[],Cs=[],ACs=[],BCs=[],ABCs=[],ADCs=[],BDCs=[],ABDCs=[],ABCs=[],ruleFilters=[],bucketRules=[],ruleNums=0,graphPara={};!function($){function getAllTable(){for(var a=0;a<Cs.length;a++){ACs[a]=[],BCs[a]=[],ABCs[a]=[],ADCs[a]=[],BDCs[a]=[],ABDCs[a]=[];for(var b=0;b<A.length;b++){var c=A[b].getFacetByName(bucketRules[a].name);void 0!=c&&("string"==bucketRules[a].type?bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&ACs[a].push(A[b]):(bucketRules[a].type="nonstring")&&bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&ACs[a].push(A[b]))}for(var b=0;b<B.length;b++){var c=B[b].getFacetByName(bucketRules[a].name);void 0!=c&&("string"==bucketRules[a].type?bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&BCs[a].push(B[b]):(bucketRules[a].type="nonstring")&&bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&BCs[a].push(B[b]))}for(var b=0;b<AB.length;b++){var c=AB[b].getFacetByName(bucketRules[a].name);void 0!=c&&("string"==bucketRules[a].type?bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&ABCs[a].push(AB[b]):(bucketRules[a].type="nonstring")&&bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&ABCs[a].push(AB[b]))}for(var b=0;b<AD.length;b++){var c=AD[b].getFacetByName(bucketRules[a].name);void 0!=c&&("string"==bucketRules[a].type?bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&ADCs[a].push(AD[b]):(bucketRules[a].type="nonstring")&&bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&ADCs[a].push(AD[b]))}for(var b=0;b<BD.length;b++){var c=BD[b].getFacetByName(bucketRules[a].name);void 0!=c&&("string"==bucketRules[a].type?bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&BDCs[a].push(BD[b]):(bucketRules[a].type="nonstring")&&bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&BDCs[a].push(BD[b]))}for(var b=0;b<ABD.length;b++){var c=ABD[b].getFacetByName(bucketRules[a].name);void 0!=c&&("string"==bucketRules[a].type?bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&ABDCs[a].push(ABD[b]):(bucketRules[a].type="nonstring")&&bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&ABDCs[a].push(ABD[b]))}}}var _views=[],_itemTotals=[],_numericItemTotals=[],_ordinalItemTotals=[],_longstringFilters=null,_longStringCategories=[];_stringFilters=[],_numericFilters=[],_datetimeFilters=[],_selectedFilters=[],_currentView=0,_sortCategory=null,_tiles=[],_filterList=[],_selectedItem=null,_imageController=null,_mouseDrag=null,_mouseMove=null,_self=null,_nameMapping=[],_enabledView=[],_options={},_rEnable=!1,_listObj={},1==_options.authoring&&(PARA.y_axis=null,PARA.selected_id=-1);var methods={init:function(a){_self=this,_self.addClass("pv-wrapper"),$(document).on("contextmenu",function(){return!1}),_options=a,$.getJSON("defaults.json").always(function(b){for(var c=Object.keys(b),d=0;d<c.length;d++)void 0==a[c[d]]&&a[c[d]]==b[c[d]];if(void 0==a.ImageController)_imageController=new PivotViewer.Views.DeepZoomImageController;else{if(!(a.ImageController instanceof PivotViewer.Views.IImageController))throw"Image Controller does not inherit from PivotViewer.Views.IImageController.";_imageController=a.ImageController}_enabledView=a.Views,void 0==a.Loader?($(".pv-wrapper").append("<div id='pv-file-selection' class='pv-modal-dialog modal-lg'><div><div id='pv-modal-text'><p>Use Existing Project:<br><select id='pv-server-file' class='pv-server-file'><option>Select a file</option></select><p>Create New Project:<br><input id='pv-load-file' class='pv-load-file' type=file accept='.csv'></div></div></div>"),$pv_server_file=$("#pv-server-file"),$.getJSON("../project_list.php",function(a){$.each(a,function(a,b){$pv_server_file.append('<option value="'+b+'">'+b+"</option>")})}),$pv_server_file.on("change",function(b){Loader=$pv_server_file.val().endsWith(".cxml")?new PivotViewer.Models.Loaders.CXMLLoader("projects/"+$pv_server_file.val()):new PivotViewer.Models.Loaders.CSVLoader("projects/"+$pv_server_file.val()),PV._initCollectionLoader(a),window.open("#pv-modal-dialog-close","_self")}),$(".pv-load-file").on("change",function(b){var c=$("#pv-load-file")[0];Loader=new PivotViewer.Models.Loaders.LocalCSVLoader(c.files[0]),PV._initCollectionLoader(a)}),window.open("#pv-file-selection","_self")):(Loader=a.Loader,PV._initCollectionLoader(a))}).fail(function(a,b,c){var d=b+", "+c;Debug.log("Getting defaults file failed: "+d)})}};PV._initCollectionLoader=function(a){if(_self.append("<div class='pv-loading'><img src='images/loading.gif' alt='Loading' /><span>Loading...</span></div>"),$(".pv-loading").css("top",$(".pv-wrapper").height()/2-33+"px"),$(".pv-loading").css("left",$(".pv-wrapper").width()/2-43+"px"),void 0==Loader)throw"Collection loader is undefined.";if(!(Loader instanceof PivotViewer.Models.Loaders.ICollectionLoader))throw"Collection loader does not inherit from PivotViewer.Models.Loaders.ICollectionLoader.";a.dzc&&(PivotCollection.imageBase=a.dzc),Loader.loadCollection(PivotCollection)},PV._bucketizeDateTimeFacet=function(a,b,c){var d=["<ul class='pv-filterpanel-accordion-facet-list'>"];if(b)for(var e=0;e<b.length;e++){var f=e+1;d[f]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(a)+"__"+PV.cleanName(b[e].name.toString())+"'>",d[f]+="<input itemvalue='"+PV.cleanName(b[e].name.toString())+"' itemfacet='"+PV.cleanName(a.toString())+"' startdate='"+b[e].start.toISOString()+"' enddate='"+b[e].end.toISOString()+"' class='pv-facet-value' type='checkbox' />",d[f]+="<span class='pv-facet-value-label'>"+b[e].name+"</span>",d[f]+="<span class='pv-facet-value-count'>0</span>",d[f]+="</li>"}if(d[b.length+1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-LineBreak' style='border-bottom:thin solid #E2E2E2;'></li>",d[b.length+2]="</ul>",d[b.length+3]="<ul class='pv-filterpanel-accordion-facet-list'>",c)for(var e=0;e<c.length;e++){var f=e+4+b.length;d[f]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(a)+"__"+PV.cleanName(c[e].name.toString())+"'>",d[f]+="<input itemvalue='"+PV.cleanName(c[e].name.toString())+"' itemfacet='"+PV.cleanName(a.toString())+"' startdate='"+c[e].start.toISOString()+"' enddate='"+c[e].end.toISOString()+"' class='pv-facet-value' type='checkbox' />",d[f]+="<span class='pv-facet-value-label'>"+c[e].name+"</span>",d[f]+="<span class='pv-facet-value-count'>0</span>",d[f]+="</li>"}return d[b.length+c.length+4]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-LineBreak2' style='border-bottom:thin solid #E2E2E2;'></li>",d[b.length+c.length+5]="</ul>",d.join("")},PV._createCustomRange=function(a){var b=["<ul class='pv-filterpanel-accordion-facet-list'>"];return b[1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(a)+"__CustomRange'>",b[1]+="<input itemvalue='CustomRange' itemfacet='"+PV.cleanName(a)+"' class='pv-facet-value' type='checkbox' />",b[1]+="<span class='pv-facet-value-label'>Custom Range</span>",b[1]+="</li>",b[1]+="<ul class='pv-filterpanel-accordion-facet-list'>",b[1]+="<li class='pv-filterpanel-accordion-facet-list-item' id='pv-custom-range-"+PV.cleanName(a)+"__Start' style='visibility:hidden;float:right'>",b[1]+="<span class='pv-facet-customrange-label'>Start:</span>",b[1]+="<input itemvalue='CustomRangeStart' itemfacet='"+PV.cleanName(a)+"' id='pv-custom-range-"+PV.cleanName(a)+"__StartDate' class='pv-facet-customrange' type='text'/>",b[1]+="</li>",b[1]+="<li class='pv-filterpanel-accordion-facet-list-item' id='pv-custom-range-"+PV.cleanName(a)+"__Finish' style='visibility:hidden;float:right'>",b[1]+="<span class='pv-facet-customrange-label'>End:</span>",b[1]+="<input itemvalue='CustomRangeFinish' itemfacet='"+PV.cleanName(a)+"' id='pv-custom-range-"+PV.cleanName(a)+"__FinishDate' class='pv-facet-customrange' type='text'/>",b[1]+="</li>",b[b.length]="</ul>",b.join("")},PV._createDatetimeNoInfoFacet=function(a){var b=_itemTotals[a];if(void 0==b)return"";var c=b["(no info)"],d="<ul class='pv-filterpanel-accordion-facet-list'>";return void 0!=c&&(d+="<li class='pv-filterpanel-accordion-facet-list-item'  id='"+c.id+"'>",d+="<input itemvalue='"+PV.cleanName(c.value)+"' itemfacet='"+PV.cleanName(a)+"' class='pv-facet-value' type='checkbox' />",d+="<span class='pv-facet-value-label'>"+c.value+"</span>",d+="<span class='pv-facet-value-count'>0</span>",d+="</li>"),d+="<li class='pv-filterpanel-accordion-facet-list-item'  style='border-bottom:thin solid #E2E2E2;'></li>",d+="</ul>"},PV._createStringFilters=function(a){var b=["<ul class='pv-filterpanel-accordion-facet-list list'>"],c=_itemTotals[a],d=1;for(var e in c.values){var f=c.values[e];b[d]="<li class='pv-filterpanel-accordion-facet-list-item'  id='"+f.id+"'>",b[d]+="<input itemvalue='"+PV.cleanName(f.value)+"' itemfacet='"+PV.cleanName(a)+"' class='pv-facet-value' type='checkbox' />",b[d]+="<span class='pv-facet-value-label'>"+f.value+"</span>",b[d]+="<span class='pv-facet-value-count'>0</span>",b[d++]+="</li>"}return b[b.length]="</ul>",b.join("")+'<ul class="pagination"></ul>'},PV._refreshSliderWidget=function(a,b,c){var d=PivotViewer.Utils.escapeMetaChars(PV.cleanName(a.name)),e=$("#pv-filterpanel-category-numberitem-"+d),f=void 0==e.attr("created");f&&e.append("<span class='pv-facet-numericslider-range-val'>&nbsp;</span><br>"),e.find("svg").remove();for(var g=c(b),h="<svg class='pv-filterpanel-accordion-facet-chart' width='165' height='80'>",i=.5+165/g.histogram.length|0,j=g.histogram.length>1?Math.max.apply(null,g.histogram):1,k=0;k<g.histogram.length;k++){var l=.5+80/j*g.histogram[k],m=.5+i*k|0;h+="<rect x='"+m+"' y='"+(80-l)+"' width='"+i+"' height='"+l+"'></rect>"}if(e.find("br").after(h+"</svg>"),f){var n=a.getValueLabel(g.min),o=a.getValueLabel(g.max);e.append("<div id='pv-facet-numericslider-"+d+"' class='pv-facet-numericslider'></div><table width=100%><tr><td class='pv-facet-numericslider-range-min'>"+n+"</td><td align=right class='pv-facet-numericslider-range-max'>"+o+"</td></tr></table>"),e.attr("created",1)}var p=$("#pv-facet-numericslider-"+d),q=g.max-g.min;f&&p.modSlider({values:[g.min,g.max]}),p.modSlider("option","min",g.min),p.modSlider("option","max",g.max),p.modSlider("option","step",q<10&&!a.integer?q/g.histogram.length:1),f&&(p.modSlider("option","range",!0),p.modSlider("option","start",function(a,b){this.startMin=b.values[0],this.startMax=b.values[b.values.length-1]}),p.modSlider("option","slide",function(b,c){var d=a.getValueLabel(c.values[0]),e=a.getValueLabel(c.values[c.values.length-1]);$(this).parent().find(".pv-facet-numericslider-range-val").text(d+" - "+e)}),p.modSlider("option","stop",function(b,c){PV._stopSlider($("#pv-facet-numericslider-"+d),a,b,c)}))},PV._refreshNumberWidget=function(a,b){PV._refreshSliderWidget(a,b,PivotViewer.Utils.getHistogram)},PV._refreshOrdinalWidget=function(a,b){PV._refreshSliderWidget(a,b,PivotViewer.Utils.getOrdinalHistogram)},PV._stopSlider=function(a,b,c,d){var a=$("#pv-facet-numericslider-"+PV.cleanName(b.name)),e=a.modSlider("option","min"),f=a.modSlider("option","max");if(d.values[0]>e||d.values[d.values.length-1]<f)a.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible");else if(d.values[0]==e&&d.values[d.values.length-1]==f&&(a.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),void 0==_numericFilters[b.name]))return;PV.filterCollection({category:b,enlarge:a[0].startMin>d.values[0]||a[0].startMax<d.values[d.values.length-1],min:d.values[0],max:d.values[d.values.length-1],rangeMin:e,rangeMax:f})},PV.selectView=function(a){var b;if("string"==typeof a||a instanceof String){for(var c=0;c<_views.length;c++)if(_views[c].getViewName().toLowerCase().startsWith(a.toLowerCase())){b=c;break}}else b=a;PV.deselectInfoPanel(),PV.getCurrentView().handleClick({type:"clear"}),$("#pv-viewpanel-view-"+_currentView+"-image").attr("src",_views[_currentView].getButtonImage()),_views[_currentView].deactivate(),$("#pv-viewpanel-view-"+b+"-image").attr("src",_views[b].getButtonImageSelected()),_views[b].activate(),_currentView=b,1==_currentView&&PV.getBucketFilters();var d=_views[b].getViewName().toLowerCase();1==_options.authoring&&(PV.getGraphParameters(),PARA.view=d.substr(0,d.indexOf("view")-1),"crosstab"!=PARA.view?PARA.y_axis=null:PARA.y_axis=$("#pv-altsort option:selected").html())},PV.getCurrentView=function(){return _views[_currentView]},PV.filterViews=function(){if(void 0!=_views[1]){for(var a=0;a<_views.length;a++)_views[a].handleFilter(_tiles,_filterList,_sortCategory);PV.getBucketFilters(),PV.getRuleFilters(),1==_options.authoring&&PV.getGraphParameters()}},PV.getGraphParameters=function(){graphPara={};var a=_views[_currentView].getViewName().toLowerCase();if(graphPara.view=a.substr(0,a.indexOf("view")-1),"map"==graphPara.view)graphPara.mData=[],setTimeout(function(){for(var a=_views[_currentView].filterList,b=0;b<a.length;b++)a[b].loc&&graphPara.mData.push([a[b].loc.lat,a[b].loc.lng])},2e3);else if("grid"==graphPara.view)graphPara.x=$("#pv-primsort option:selected").html(),graphPara.gSize=_views[_currentView].filterList.length;else if(_views[_currentView].buckets&&!_views[_currentView].bucketsY){graphPara.x=$("#pv-primsort option:selected").html(),graphPara.xData=[];for(var b=_views[_currentView].buckets,c=0;c<b.length;c++){var d=[];b[c].startRange==b[c].endRange?d.push(b[c].endLabel):d.push(b[c].startLabel+" to "+b[c].endLabel),d.push(b[c].tiles.length),graphPara.xData.push(d)}b=[]}else if(_views[_currentView].bucketsY){graphPara.x=$("#pv-primsort option:selected").html(),graphPara.y=$("#pv-altsort option:selected").html(),graphPara.yData=[];var b=_views[_currentView].buckets;graphPara.xSize=b.length,graphPara.ySize=b[0].subBuckets.length,graphPara.xLabels=[],graphPara.yLabels=[];for(var c=0;c<graphPara.xSize;c++)for(var e=0;e<graphPara.ySize;e++){var d=[];b[c].startRange==b[c].endRange?d.push(b[c].endLabel):d.push(b[c].startLabel+" to "+b[c].endLabel),b[c].subBuckets[e].startRange==b[c].subBuckets[e].endRange?d.push(b[c].subBuckets[e].endLabel):d.push(b[c].subBuckets[e].startLabel+" to "+b[c].subBuckets[e].endLabel),d.push(b[c].subBuckets[e].tiles.length),graphPara.yData.push(d)}b=[]}else graphPara.x=$("#pv-primsort option:selected").html()},PV.getBucketFilters=function(){bucketRules=[];var a;a=PivotCollection.getCategoryByName(_sortCategory).isString()||PivotCollection.getCategoryByName(_sortCategory).isLocation()?"string":"nonstring";for(var b=_views[1].buckets,c=0;c<b.length;c++)if("string"==a){var d=[b[c].startRange,b[c].endRange];bucketRules.push({name:_sortCategory,type:a,value:d})}else{var d=[b[c].startRange,b[c].endRange];bucketRules.push({name:_sortCategory,type:a,value:d})}void 0!=bucketRules&&PV.getBucketsCount()},PV.getBucketsCount=function(){Cs=[];for(var a=0;a<bucketRules.length;a++){Cs[a]=[];for(var b=0;b<PivotCollection.items.length;b++)if("string"==bucketRules[a].type){var c=PivotCollection.items[b].getFacetByName(bucketRules[a].name);void 0!=c&&bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&Cs[a].push(PivotCollection.items[b])}else if(bucketRules[a].type="nonstring"){var c=PivotCollection.items[b].getFacetByName(bucketRules[a].name);void 0!=c&&bucketRules[a].value[0]<=c.values[0].value&&bucketRules[a].value[1]>=c.values[0].value&&Cs[a].push(PivotCollection.items[b])}}},PV.getRuleFilters=function(){ruleFilters=[],ruleNums=0;for(var a=0;a<_stringFilters.length;a++){ruleNums++;for(var b=_stringFilters[a].facet,c="string",d=[],e=0;e<_stringFilters[a].value.length;e++)d.push(_stringFilters[a].value[e]);ruleFilters.push({name:b,type:c,value:d})}for(var a=0;a<_numericFilters.length;a++){ruleNums++;var b=_numericFilters[a].facet,c="nonstring",f=_numericFilters[a].selectedMax,g=_numericFilters[a].selectedMin;ruleFilters.push({name:b,type:c,value:[g,f]})}PV.ruleCount()},PV.ruleCount=function(){if(!(0==ruleNums||ruleNums>3)){A=[],B=[],D=[],AB=[],AD=[],BD=[],ABD=[];for(var a=0;a<PivotCollection.items.length;a++){if("string"==ruleFilters[0].type){var b=PivotCollection.items[a].getFacetByName(ruleFilters[0].name);void 0!=b&&$.inArray(b.values[0].value,ruleFilters[0].value)>-1&&A.push(PivotCollection.items[a])}else if(ruleFilters[0].type="nonstring"){var b=PivotCollection.items[a].getFacetByName(ruleFilters[0].name);void 0!=b&&ruleFilters[0].value[0]<=b.values[0].value&&ruleFilters[0].value[1]>=b.values[0].value&&A.push(PivotCollection.items[a])}if(1!=ruleNums){if("string"==ruleFilters[1].type){var b=PivotCollection.items[a].getFacetByName(ruleFilters[1].name);void 0!=b&&$.inArray(b.values[0].value,ruleFilters[1].value)>-1&&B.push(PivotCollection.items[a])}else if(ruleFilters[1].type="nonstring"){var b=PivotCollection.items[a].getFacetByName(ruleFilters[1].name);void 0!=b&&ruleFilters[1].value[0]<=b.values[0].value&&ruleFilters[1].value[1]>=b.values[0].value&&B.push(PivotCollection.items[a])}if(2!=ruleNums)if("string"==ruleFilters[2].type){var b=PivotCollection.items[a].getFacetByName(ruleFilters[2].name);void 0!=b&&$.inArray(b.values[0].value,ruleFilters[2].value)>-1&&D.push(PivotCollection.items[a])}else if(ruleFilters[2].type="nonstring"){var b=PivotCollection.items[a].getFacetByName(ruleFilters[2].name);void 0!=b&&ruleFilters[2].value[0]<=b.values[0].value&&ruleFilters[2].value[1]>=b.values[0].value&&D.push(PivotCollection.items[a])}}}if(1==ruleNums)return void getAllTable();for(var a=0;a<A.length;a++){var b=A[a].getFacetByName(ruleFilters[1].name);void 0!=b&&("string"==ruleFilters[1].type?$.inArray(b.values[0].value,ruleFilters[1].value)>-1&&AB.push(A[a]):(ruleFilters[1].type="nonstring")&&ruleFilters[1].value[0]<=b.values[0].value&&ruleFilters[1].value[1]>=b.values[0].value&&AB.push(A[a]))}if(2==ruleNums)return void getAllTable();for(var a=0;a<A.length;a++){var b=A[a].getFacetByName(ruleFilters[2].name);void 0!=b&&("string"==ruleFilters[2].type?$.inArray(b.values[0].value,ruleFilters[2].value)>-1&&AD.push(A[a]):(ruleFilters[2].type="nonstring")&&ruleFilters[2].value[0]<=b.values[0].value&&ruleFilters[2].value[1]>=b.values[0].value&&AD.push(A[a]))}for(var a=0;a<B.length;a++){var b=B[a].getFacetByName(ruleFilters[2].name);void 0!=b&&("string"==ruleFilters[2].type?$.inArray(b.values[0].value,ruleFilters[2].value)>-1&&BD.push(B[a]):(ruleFilters[2].type="nonstring")&&ruleFilters[2].value[0]<=b.values[0].value&&ruleFilters[2].value[1]>=b.values[0].value&&BD.push(B[a]))}for(var a=0;a<BD.length;a++){var b=BD[a].getFacetByName(ruleFilters[0].name);void 0!=b&&("string"==ruleFilters[0].type?$.inArray(b.values[0].value,ruleFilters[0].value)>-1&&ABD.push(BD[a]):(ruleFilters[0].type="nonstring")&&ruleFilters[0].value[0]<=b.values[0].value&&ruleFilters[0].value[1]>=b.values[0].value&&ABD.push(BD[a]))}getAllTable()}},PV._sortStringValues=function(a){if(PivotCollection.getCategoryByName(a).type!=PivotViewer.Models.FacetType.DateTime){var b=$("#pv-cat-"+PivotViewer.Utils.escapeMetaChars(PV.cleanName(a))+" .pv-filterpanel-accordion-facet-list"),c=b.prev().text().replace("Sort: ","");if("A-Z"==c)_listObj[PV.cleanName(a)].sort("pv-facet-value-label",{order:"asc"});else if("Quantity"==c)_listObj[PV.cleanName(a)].sort("pv-facet-value-count",{order:"desc"});else{var d=PivotCollection.getCategoryByName(a);if(void 0!=d.customSort){for(var e=[],f=d.customSort.sortValues.length-1;f>=0;f--)for(var g=0;g<items.length;g++)facet.customSort.sortValues[f]==$(items[g]).children(".pv-facet-value-label").text()&&e.push(items[g]);items=e}}}},PV.filterCollection=function(a){PV.deselectInfoPanel(),_selectedItem=null;var d,e,f,g,b=[],c=null;if(void 0==a){if(null!=_longstringFilters){var h=0;c=[];for(var i=0,j=_tiles.length;i<j;i++){var k=_tiles[i].item.getFacetByName(_longstringFilters.facet);void 0!=k&&k.values[0].value.toLowerCase().indexOf(_longstringFilters.value)>=0?(c[i]=!0,h++):c[i]=!1}if(0==h)return void $("#pv-long-search").css("text-decoration","line-through").css("color","red")}var l=$(".pv-facet-value:checked");b=[],d=[],e=[],f=[],g=[];for(var i=0;i<l.length;i++){var m=_nameMapping[$(l[i]).attr("itemfacet")],n=_nameMapping[$(l[i]).attr("itemvalue")],o=PivotCollection.getCategoryByName(m);if(o.doFilter)if(o.isString()||o.isLocation()){var p=d[m];void 0!=p?p.value[n+"a"]=!0:(p={facet:m,value:[],index:i},p.value[n+"a"]=!0,p.value=_stringFilters[m].value,d.push(p),d[m]=p,g[m]=!0)}else if(o.isDateTime()){var s,q=$("#pv-custom-range-"+PV.cleanName(m)+"__StartDate")[0].value,r=$("#pv-custom-range-"+PV.cleanName(m)+"__FinishDate")[0].value;q&&r?s={value:n,startDate:new Date(q),endDate:new Date(r)}:(q=$(l[i]).attr("startdate"),r=$(l[i]).attr("enddate"),s={value:n,startDate:new Date(q),endDate:new Date(r)});var t=e[m];void 0!=t?t.value.push(s):(t={facet:m,value:[s],index:i},e.push(t),e[m]=t,g[m]=!0)}}for(var i=0,j=PivotCollection.categories.length;i<j;i++){var o=PivotCollection.categories[i];if(o.doFilter){var m=o.name;if(PivotCollection.categories[i].type==PivotViewer.Models.FacetType.Number||PivotCollection.categories[i].type==PivotViewer.Models.FacetType.Ordinal){var u=$("#pv-filterpanel-category-numberitem-"+PV.cleanName(m)).find(".pv-facet-numericslider");if(u.length>0){var v=u.modSlider("values"),w=u.modSlider("option","max"),x=u.modSlider("option","min");v[0]==x&&v[v.length-1]==w||(f.push({facet:m,selectedMin:v[0],selectedMax:v[v.length-1],rangeMin:x,rangeMax:w}),f[m]=f[i],g[m]=!0)}}}}}else{b=[],d=_stringFilters,e=_datetimeFilters,f=_numericFilters,g=_selectedFilters;var o=a.category;if(!o.doFilter)return;if(o.isNumber()||o.isOrdinal())numericFilter=f[o.name],void 0==numericFilter?(numericFilter={facet:o.name,selectedMin:a.min,selectedMax:a.max,rangeMin:a.rangeMin,rangeMax:a.rangeMax},f.push(numericFilter),f[o.name]=numericFilter):(numericFilter.selectedMin=a.min,numericFilter.selectedMax=a.max),g[o.name]=!0;else if(!a.enlarge&&void 0!=g[o.name]||a.clear)if(o.isString()||o.isLocation()){var p=d[o.name];delete p.value[a.value+"a"],p.value.splice(p.value.indexOf(a.value),1),0==Object.keys(p.value).length&&(delete d[o.name],d.splice(p.index,1),delete g[o.name])}else{t=e[o.name];for(var y=0;y<t.value.length;y++)if(t.value[y].value==a.value){t.value.splice(y,1),0==t.value.length&&(delete e[o.name],e.splice(t.index,1),delete g[o.name]);break}}else{if(o.isString()||o.isLocation()){var p=d[o.name];void 0!=p?(p.value[a.value+"a"]=!0,p.value.push(a.value)):(p={facet:o.name,value:[a.value],index:d.length},p.value[a.value+"a"]=!0,d.push(p),d[o.name]=p)}else{var s={value:a.value,startDate:a.min,endDate:a.max},t=e[o.name];void 0!=t?t.value.push(s):(t={facet:o.name,value:[s],index:e.length},e.push(t),e[o.name]=t)}g[o.name]=!0}}for(var i=0,j=_tiles.length;i<j;i++){var z=_tiles[i];if(null!=c){if(!c[i]){z.filtered=!1;continue}}else if(null!=_longstringFilters){var k=_tiles[i].item.getFacetByName(_longstringFilters.facet);if(void 0==k||k.values[0].value.toLowerCase().indexOf(_longstringFilters.value)<0){z.filtered=!1;continue}}for(var C=0,D=d.length;C<D;C++){var k=z.item.getFacetByName(d[C].facet);if(void 0==k){if(d[C].value["(no info)a"])continue;break}for(var E,F,E=0,F=k.values.length;E<F&&!d[C].value[k.values[E].value+"a"];E++);if(E==F)break}if(C<D)z.filtered=!1;else{for(var C=0,D=f.length;C<D;C++){var k=z.item.getFacetByName(f[C].facet);if(void 0==k){if("(no info)"==f[C].selectedMin)continue;break}for(var E,F,E=0,F=k.values.length;E<F;E++){var G=parseFloat(k.values[E].value);if(!isNaN(G)&&G>=f[C].selectedMin&&G<=f[C].selectedMax)break}if(E==F)break}if(C<D)z.filtered=!1;else{for(var C=0,D=e.length;C<D;C++){var k=z.item.getFacetByName(e[C].facet);if(void 0!=k){for(var E,F,E=0,F=k.values.length;E<F;E++){for(var J=new Date(k.values[E].value),H=0,I=e[C].value.length;H<I;H++){var n=e[C].value[H];if(J>=n.startDate&&J<=n.endDate)break}if(H<I)break}if(E==F)break}else{for(var H,I,H=0,I=e[C].value.length;H<I&&"(no info)"!=e[C].value[H].value;H++);if(H==I)break}}C<D?z.filtered=!1:(z.filtered=!0,b.push(z))}}}_filterList=b,_numericFilters=f,_stringFilters=d,_datetimeFilters=e,_selectedFilters=g,null!=_longstringFilters||0!=_numericFilters.length||0!=_stringFilters.length||0!=_datetimeFilters.length?$(".pv-filterpanel-clearall").css("visibility","visible"):$(".pv-filterpanel-clearall").css("visibility","hidden");var K=PivotCollection.getCategoryByName(_nameMapping[$(".pv-facet").eq($(".pv-filterpanel-accordion").accordion("option","active")).attr("facet")]);if(a&&a.category==K){for(var i=0;i<K.index;i++)PivotCollection.categories[i].recount=!0;for(var i=K.index+1;i<PivotCollection.categories.length;i++)PivotCollection.categories[i].recount=!0}else{for(var i=0;i<PivotCollection.categories.length;i++)PivotCollection.categories[i].recount=!0;PV._filterCategory($(".pv-facet").eq($(".pv-filterpanel-accordion").accordion("option","active")))}$("#pv-toolbarpanel-countbox").html(_filterList.length);var L=$(".pv-toolbarpanel-breadcrumb");if(L.empty(),d.length>0||f.length>0||e.length>0){for(var M="|",i=0;i<d.length;i++)M+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+d[i].facet+":</span><span class='pv-toolbarpanel-breadcrumb-values'>",M+=d[i].value.join(", "),M+="</span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;</span>";for(var i=0;i<f.length;i++)M+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+f[i].facet+":</span><span class='pv-toolbarpanel-breadcrumb-values'>",M+=f[i].selectedMin==f[i].rangeMin?"Under "+f[i].selectedMax:f[i].selectedMax==f[i].rangeMax?"Over "+f[i].selectedMin:f[i].selectedMin==f[i].selectedMax?f[i].selectedMin:f[i].selectedMin+" - "+f[i].selectedMax,M+="</span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;</span>";for(var i=0;i<e.length;i++)for(var N=0;N<e[i].value.length;N++){if(M+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+e[i].facet+":</span><span class='pv-toolbarpanel-breadcrumb-values'>",void 0!=e[i].value[N].startDate&&void 0!=e[i].value[N].endDate){var O=new Date(e[i].value[N].startDate),P=new Date(e[i].value[N].endDate),Q=PivotViewer.Utils.getTimeLabelFn(O,P);M+=Q({value:O})+" - "+Q({value:P})}else M+=e[i].value[N].value;M+="</span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;</span>"}L.append(M),TileController.setCircularEasingBoth()}A=[],B=[],AB=[],Cs=[],ACs=[],BCs=[],ABCs=[],PivotViewer.Models.string_filters=_stringFilters,PV.filterViews(),1==_options.authoring&&(PARA.string_filters=_stringFilters,PARA.num_filters=_numericFilters)},PV.initUICategory=function(a){Loader.loadColumn(a),LoadSem.acquire(function(b){var c=$("#pv-cat-"+PV.cleanName(a.name));if(a.isDateTime())PV._createDatetimeBuckets(a),c.append(PV._bucketizeDateTimeFacet(a.name,a.datetimeBuckets[0],a.datetimeBuckets[1])),c.append(PV._createDatetimeNoInfoFacet(a.name)),c.append(PV._createCustomRange(a.name)),$("#pv-cat-"+PV.cleanName(a.name)+" .pv-facet-customrange").on("change",function(a){PV._changeCustomRange(this)}),$("#pv-cat-"+PV.cleanName(a.name)+" .pv-facet-value").on("click.pv",function(a){PV.clickValue(this)}),$("#pv-cat-"+PV.cleanName(a.name)+" .pv-facet-value-label").on("click.pv",function(a){var b=$(this).prev();b.prop("checked",!b.prop("checked")),PV.clickValue(b[0])});else if(a.isString()||a.isLocation()){for(var d=0;d<PivotCollection.items.length;d++){var e=PivotCollection.items[d],f=e.getFacetByName(a.name);if(void 0!=f)for(var g=0;g<f.values.length;g++){var h=f.values[g].value,i="pv-facet-value-"+PV.cleanName(f.name)+"__"+PV.cleanName(f.values[g].value),j=_itemTotals[f.name];void 0==j&&(j=_itemTotals[f.name]={values:[],facet:f.name,filtered:!0});var k=j.values[h];void 0==k?j.values[h]={id:i,value:h,count:1}:k.count++}else{var i="pv-facet-value-"+PV.cleanName(a.name)+"__"+PV.cleanName("(no info)"),j=_itemTotals[a.name];void 0==j&&(j=_itemTotals[a.name]={values:[],facet:a.name,filtered:!0});var k=j.values["(no info)"];void 0==k?j.values["(no info)"]={id:i,value:"(no info)",count:1}:k.count++}}c.append("<input class='pv-value-search' id='pv-value-search-"+PV.cleanName(a.name)+"' type='text' placeholder='Search values...' size=15><div class='pv-search-clear' id='pv-value-search-clear-"+PV.cleanName(a.name)+"'>&nbsp;</div><br>"),void 0!=a.customSort||null!=a.customSort?c.append("<span class='pv-filterpanel-accordion-facet-sort' customSort='"+a.customSort.name+"'>Sort: "+a.customSort.name+"</span>"):c.append("<span class='pv-filterpanel-accordion-facet-sort'>Sort: A-Z</span>"),c.append(PV._createStringFilters(a.name));var e=_itemTotals[a.name];for(h in e.values)k=e.values[h],k.valueItem=$("#"+k.id),k.itemCount=k.valueItem.find("span").last();$("#pv-value-search-"+PV.cleanName(a.name)).on("keyup",function(b){var c=PV.cleanName(a.name),d=PV.cleanName(this.value.toLowerCase()),e=0,f=_listObj[PV.cleanName(a.name)];""!=d?($("#pv-value-search-clear-"+c).css("visibility","visible"),f.filter(function(a){var b=$(a.elm).children().eq(0).attr("itemvalue").toLowerCase().indexOf(d)>=0&&$(a.elm).children().eq(2).html()>0;return!!b&&(e++,!0)})):($("#pv-value-search-clear-"+c).css("visibility","hidden"),f.filter(function(a){return e++,!0})),e<=10?$(".pagination").hide():$(".pagination").show()}),$("#pv-value-search-clear-"+PV.cleanName(a.name)).click(function(b){var c=PV.cleanName(a.name);$("#pv-value-search-"+c).val(""),$("#pv-value-search-clear-"+c).css("visibility","hidden"),$('.pv-filterpanel-accordion-facet-list-item[id^="pv-facet-value-'+c+'"]').show()}),$("#pv-cat-"+PV.cleanName(a.name)+" .pv-facet-value").click(function(a){PV.clickValue(this)}),$("#pv-cat-"+PV.cleanName(a.name)+" .pv-facet-value-label").click(function(a){var b=$(this).prev();b.prop("checked",!b.prop("checked")),PV.clickValue(b[0])}),$("#pv-cat-"+PV.cleanName(a.name)+" .pv-filterpanel-accordion-facet-sort").click(function(a){var b=$(this),c=b.text(),d=b.parent().prev().children("a").text(),e=b.attr("customSort");"Sort: A-Z"==c?$(this).text("Sort: Quantity"):"Sort: Quantity"==c&&void 0==e?$(this).text("Sort: A-Z"):"Sort: Quantity"==c?$(this).text("Sort: "+e):$(this).text("Sort: A-Z"),PV._sortStringValues(d)})}else if(a.isNumber()){for(var d=0;d<PivotCollection.items.length;d++){var e=PivotCollection.items[d],f=e.getFacetByName(a.name);if(void 0!=f)for(var g=0;g<f.values.length;g++){var h=f.values[g].value,k=_numericItemTotals[f.name];void 0!=k?k.values.push(h):_numericItemTotals[f.name]={facet:f.name,values:[h],filtered:!0}}else{var i="pv-facet-value-"+PV.cleanName(a.name)+"__"+PV.cleanName("(no info)"),j=_itemTotals[a.name];void 0==j&&(j=_itemTotals[a.name]={values:[],facet:a.name,filtered:!0});var k=j.values["(no info)"];void 0==k?j.values["(no info)"]={id:i,value:"(no info)",count:1}:k.count++}}c.append("<div id='pv-filterpanel-category-numberitem-"+PV.cleanName(a.name)+"'></div>")}else if(a.isOrdinal()){for(var d=0;d<PivotCollection.items.length;d++){var e=PivotCollection.items[d],f=e.getFacetByName(a.name);if(void 0!=f)for(var g=0;g<f.values.length;g++){var h=f.values[g].value,k=_ordinalItemTotals[f.name];void 0!=k?k.values.push(h):_ordinalItemTotals[f.name]={facet:f.name,values:[h],filtered:!0}}else{var i="pv-facet-value-"+PV.cleanName(a.name)+"__"+PV.cleanName("(no info)"),j=_itemTotals[a.name];void 0==j&&(j=_itemTotals[a.name]={values:[],facet:a.name,filtered:!0});var k=j.values["(no info)"];void 0==k?j.values["(no info)"]={id:i,value:"(no info)",count:1}:k.count++}}c.append("<div id='pv-filterpanel-category-numberitem-"+PV.cleanName(a.name)+"'></div>")}a.uiInit=!0,b()})},PV._filterCategory=function(a){var b=PivotCollection.getCategoryByName(_nameMapping[a.attr("facet")]);
b.isFilterVisible&&(b.uiInit||PV.initUICategory(b),LoadSem.acquire(function(a){var c=[];if(2*_filterList.length<_tiles.length)c=_filterList;else for(var d=0;d<_tiles.length;d++)_tiles[d].filtered||c.push(_tiles[d]);if(b.isString()||b.isLocation()){for(var e=[],f=PivotViewer.Utils.escapeMetaChars("pv-facet-value-"+PV.cleanName(b.name)+"__"+PV.cleanName("(no info)")),g=0;g<c.length;g++){var h=c[g].item.getFacetByName(b.name);if(void 0!=h)for(var j=0;j<h.values.length;j++){var k=PivotViewer.Utils.escapeMetaChars("pv-facet-value-"+PV.cleanName(b.name)+"__"+PV.cleanName(h.values[j].value)),i=e[k];void 0!=i?i.count++:e[k]={count:1}}else{var i=e[f];void 0!=i?i.count++:e[f]={count:1}}}if(c==_filterList){var l=_itemTotals[b.name].values;for(var m in l){var k=l[m];void 0==e[k.id]?_selectedFilters[b.name]||k.valueItem.hide():(k.valueItem.show(),k.itemCount.text(e[k.id].count))}}else{var l=_itemTotals[b.name].values;for(var m in l){var n,k=l[m];n=void 0==e[k.id]?_itemTotals[b.name].values[m].count:_itemTotals[b.name].values[m].count-e[k.id].count,0==n?_selectedFilters[b.name]||k.valueItem.hide():(k.valueItem.css("display","list-item"),k.itemCount.text(n))}}var o={valueNames:["pv-facet-value-label","pv-facet-value-count"],page:10,plugins:[ListPagination({outerWindow:1})]};if(_listObj[PV.cleanName(b.name)]||(_listObj[PV.cleanName(b.name)]=new List("pv-cat-"+PV.cleanName(b.name),o)),b.recount)for(var d=0;d<_listObj[PV.cleanName(b.name)].items.length;d++){var k=_listObj[PV.cleanName(b.name)].items[d],m=k._values["pv-facet-value-label"];k._values["pv-facet-value-count"]=$(k.elm.lastChild).text()}var n=0;_listObj[PV.cleanName(b.name)].filter(function(a){return"none"!=$(a.elm).css("display")&&(n++,!0)}),n<=10?$(".pagination").hide():$(".pagination").show()}else if(b.isDateTime()){for(var e=[],f=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(b.name)+"__"+PV.cleanName("(no info)")),d=0;d<c.length;d++){var h=c[d].item.getFacetByName(b.name);if(void 0==h){var i=e[f];void 0!=i?i.count++:e[k]={count:1}}else for(var g=0;g<b.datetimeBuckets.length&&g<2;g++)for(var p=b.datetimeBuckets[g],j=0;j<p.length;j++)if(void 0!=p[j].items[c[d].item.id+"a"]){var k=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(b.name)+"__"+PV.cleanName(p[j].name.toString())),i=e[k];void 0!=i?i.count++:e[k]={count:1};break}}if(c==_filterList)for(var g=0;g<b.datetimeBuckets.length&&g<2;g++)for(var p=b.datetimeBuckets[g],j=0;j<p.length;j++)k=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(b.name)+"__"+PV.cleanName(p[j].name.toString())),void 0==e[k]?_selectedFilters[b.name]||$(k).hide():($(k).show(),$(k).find("span").last().text(e[k].count));else for(var g=0;g<b.datetimeBuckets.length&&g<2;g++)for(var p=b.datetimeBuckets[g],j=0;j<p.length;j++){k=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(b.name)+"__"+PV.cleanName(p[j].name.toString()));var n;n=void 0==e[k]?p[j].items.length:p[j].items.length-e[k].count,0==n?_selectedFilters[b.name]||$(k).hide():($(k).show(),$(k).find("span").last().text(n))}}else if(b.isNumber()){if(!_selectedFilters[b.name])if(_filterList.length==_tiles.length)PV._refreshNumberWidget(b,_numericItemTotals[b.name].values);else{for(var l=[],d=0;d<_filterList.length;d++){var h=_filterList[d].item.getFacetByName(b.name);if(void 0!=h)for(var q=0;q<h.values.length;q++)l.push(h.values[q].value)}PV._refreshNumberWidget(b,l)}}else if(b.isOrdinal()&&!_selectedFilters[b.name])if(_filterList.length==_tiles.length)PV._refreshOrdinalWidget(b,_ordinalItemTotals[b.name].values);else{for(var l=[],d=0;d<_filterList.length;d++){var h=_filterList[d].item.getFacetByName(b.name);if(void 0!=h)for(var q=0;q<h.values.length;q++)l.push(h.values[q].value)}PV._refreshOrdinalWidget(b,l)}Settings.showMissing?$("#pv-facet-value-"+PV.cleanName(b.name)+"__"+PV.cleanName("(no info)")).show():$("#pv-facet-value-"+PV.cleanName(b.name)+"__"+PV.cleanName("(no info)")).hide(),b.recount=!1,a()}))},PV.deselectInfoPanel=function(){$(".pv-infopanel").fadeOut(),$(".pv-infopanel-heading").empty(),$(".pv-infopanel-details").empty()},PV.cleanName=function(a){var b=a.replace(/[^\w]/gi,"_");return _nameMapping[b]=a,b},PV.uncleanName=function(a){return _nameMapping[a]},$.subscribe("/PivotViewer/Models/Collection/Loaded",function(a){var b=Lawnchair({name:PivotCollection.name},function(a,b){});b.get("Settings",function(a){if(null!=a){Settings=a.value;for(var b=0;b<Settings.visibleCategories.length;b++)Settings.visibleCategories[PivotCollection.categories[Settings.visibleCategories[b]].name]=!0}else{Settings.showMissing=!1,Settings.visibleCategories=[];for(var b=0;b<PivotCollection.categories.length;b++)Settings.visibleCategories.push(b),Settings.visibleCategories[PivotCollection.categories[b].name]=!0}$.publish("/PivotView/Models/Settings/Loaded")})}),$.subscribe("/PivotView/Models/Settings/Loaded",function(a){var b="<div class='pv-toolbarpanel'>",c=PivotCollection.brandImage;c.length>0&&(b+="<img class='pv-toolbarpanel-brandimage' src='"+c+"'></img>"),b+="<span class='pv-toolbarpanel-name'>"+PivotCollection.name+"</span>",b+="<span class='pv-countbox' id='pv-toolbarpanel-countbox' width=25></span>",b+="<div class='pv-toolbarpanel-breadcrumb'></div>",b+="<div class='pv-toolbarpanel-viewcontrols'></div>",b+="<div id='pv-primsortcontrols' class='pv-toolbarpanel-sortcontrols'></div>",b+="<div class='pv-toolbarpanel-zoomcontrols'><div class='pv-toolbarpanel-zoomslider'></div></div>",b+="<div class='pv-toolbarpanel-info'></div>",b+="</div>",_self.append(b),$("#pv-altsort").hide(),$(".pv-toolbarpanel-zoomslider").slider({max:100,stop:function(a,b){PV.zoom(b.value)}}),_self.append("<div class='pv-mainpanel'></div>");var d=$(window).height()-$(".pv-toolbarpanel").height()-30;$(".pv-mainpanel").css("height",d+"px"),$(".pv-mainpanel").append("<div class='pv-filterpanel'></div>"),$(".pv-mainpanel").append("<div class='pv-viewpanel'><canvas class='pv-canvas' width='"+_self.width()+"' height='"+d+"px'></canvas></div>"),$(".pv-mainpanel").append("<div class='pv-infopanel'></div>");var e=$(".pv-filterpanel");e.append("<div class='pv-filterpanel-clearall'>Clear All</div>").append("<input class='pv-filterpanel-search' type='text' placeholder='Search variables...' /><div class='pv-search-clear' id='pv-filterpanel-search-clear'>&nbsp;</div>").css("height",d-13+"px"),$(".pv-filterpanel-search").css("width",e.width()-15+"px");var f=$(".pv-infopanel");f.css("left",$(".pv-mainpanel").offset().left+$(".pv-mainpanel").width()-205+"px").css("height",d-28+"px"),f.append("<div class='pv-infopanel-controls'></div>"),$(".pv-infopanel-controls").append("<div><div class='pv-infopanel-controls-navleft'></div><div class='pv-infopanel-controls-navleftdisabled'></div><div class='pv-infopanel-controls-navbar'></div><div class='pv-infopanel-controls-navright'></div><div class='pv-infopanel-controls-navrightdisabled'></div></div>"),$(".pv-infopanel-controls-navleftdisabled").hide(),$(".pv-infopanel-controls-navrightdisabled").hide(),f.append("<div class='pv-infopanel-heading'></div>"),f.append("<div class='pv-infopanel-details'></div>"),PivotCollection.maxRelatedLinks>0&&f.append("<div class='pv-infopanel-related'></div>"),""!=PivotCollection.copyrightName&&f.append("<div class='pv-infopanel-copyright'><a href=\""+PivotCollection.copyrightHref+'" target="_blank">'+PivotCollection.copyrightName+"</a></div>"),f.hide();var g=PivotCollection.imageBase;g.indexOf("http",0)>=0||g.indexOf("www.",0)>=0||(g=PivotCollection.base.substring(0,PivotCollection.base.lastIndexOf("/")+1)+g);var h=$(".pv-canvas")[0].getContext("2d");TileController=new PivotViewer.Views.TileController(_imageController),_tiles=TileController.initTiles(PivotCollection.items,g,h),_imageController.setup(g.replace("\\","/"))}),$.subscribe("/PivotViewer/Settings/Changed",function(a){var b=PivotCollection.categories[a.visibleCategories[0]];b.uiInit||PV.initUICategory(b),PV.selectView(0),LoadSem.acquire(function(c){var d=$(".pv-facet"),e=$(".pv-toolbarpanel-sort"),f=$("#pv-long-search-cat");d.hide(),d.attr("visible","invisible"),$(".pv-toolbarpanel-sort option").remove(),$("#pv-long-search-cat option").remove(),_longStringCategories=[];for(var g=0;g<a.visibleCategories.length;g++){var h=PivotCollection.categories[a.visibleCategories[g]];h.isFilterVisible&&(h.isLongString()?(f.append("<option value='"+PV.cleanName(h.name)+"'>"+h.name+"</option>"),_longStringCategories.push(h)):(h.recount=!0,d.eq(h.visIndex).show(),d.eq(h.visIndex).attr("visible","visible"),e.append("<option value='"+g+"' search='"+PV.cleanName(h.name.toLowerCase())+"'>"+h.name+"</option>")))}0==$("#pv-long-search-cat option").length?(f.hide(),$("#pv-long-search").hide()):(f.show(),$("#pv-long-search").show()),PV._filterCategory(d.eq(b.visIndex)),$(".pv-filterpanel-accordion").accordion("option","active",b.visIndex),$("#pv-primsort").trigger("change"),c()})}),$.subscribe("/PivotViewer/ImageController/Collection/Loaded",function(event){for(var facets=["<div class='pv-filterpanel-accordion'>"],longSearch=["<div id='pv-long-search-box'><br><select id='pv-long-search-cat'>"],sort=[],activeNumber=0,i=0;i<PivotCollection.categories.length;i++){var category=PivotCollection.categories[i];category.isFilterVisible&&(category.isLongString()?(longSearch.push("<option value='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"),_longStringCategories.push(category)):(activeNumber++,facets.push("<h3 class='pv-facet' style='display:inherit' facet='"+PV.cleanName(category.name.toLowerCase())+"'><a href='#' title='"+category.name+"'>"+category.name+"</a><div class='pv-filterpanel-accordion-heading-clear' facetType='"+category.type+"'>&nbsp;</div></h3><div style='display:'inherit' style='height:30%' id='pv-cat-"+PV.cleanName(category.name)+"'></div>"),sort.push("<option value='"+i+"' search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>")))}longSearch.length>1&&(longSearch.push("</div></select>"),$(".pv-filterpanel").append(longSearch.join("")+"<span class='pv-search-clear' id='pv-long-search-clear'>&nbsp;</span><input type=text length=25 id='pv-long-search' placeholder='Search text...'>"),$("#pv-long-search").on("keyup",function(a){this.value.toLowerCase();if(13==a.keyCode){var c=PivotCollection.getCategoryByName([$("#pv-long-search-cat option:selected").text()]);c.uiInit||(Loader.loadColumn(c),c.uiInit=!0),LoadSem.acquire(function(a){_longstringFilters=null!=$("#pv-long-search").val()&&""!=$("#pv-long-search").val()?{facet:$("#pv-long-search-cat option:selected").text(),value:$("#pv-long-search").val().toLowerCase()}:null,PV.filterCollection(),a()})}else $("#pv-long-search").css("text-decoration","").css("color","black");$("#pv-long-search-clear").css("visibility","visible")}),$("#pv-long-search-clear").click(function(a){$("#pv-long-search").val(""),$("#pv-long-search-clear").css("visibility","hidden"),null!=_longstringFilters&&(_longstringFilters=null,PV.filterCollection())}),$("#pv-long-search-cat").on("mousedown",function(a){if(1==$(this).attr("dirty")){$("#pv-long-search-cat option").remove();for(var b=$(".pv-filterpanel-search").val(),c=0;c<_longStringCategories.length;c++){var d=_longStringCategories[c],e=PV.cleanName(d.name);""!=b&&e.indexOf(b)<0||$("#pv-long-search-cat").append("<option value='"+PV.cleanName(d.name)+"'>"+d.name+"</option>")}}$(this).attr("dirty",0)})),facets.push("</div>"),$(".pv-filterpanel").append(facets.join("")),$(".pv-filterpanel-accordion").css("height",$(".pv-filterpanel").height()-$(".pv-filterpanel-search").height()-75-$("#pv-long-search-box").height()+"px"),$(".pv-filterpanel-accordion").accordion({icons:!1}),$("#pv-primsortcontrols").append('<select id="pv-primsort" class="pv-toolbarpanel-sort">'+sort.join("")+"</select>"),$(".pv-filterpanel-accordion").accordion("option","active",activeNumber);var viewPanel=$(".pv-viewpanel"),width=_self.width(),height=$(".pv-mainpanel").height(),offsetX=$(".pv-filterpanel").width()+18,offsetY=4;void 0==PivotCollection.config&&(PivotCollection.config=[]),void 0==PivotCollection.config.views&&(void 0==_enabledView?PivotCollection.config.views=["grid","bucket","crosstab"]:PivotCollection.config.views=_enabledView),void 0!=_options.View&&PivotCollection.config.views.indexOf(_options.View)<0&&PivotCollection.config.views.push(_options.View);for(var i=0;i<PivotCollection.config.views.length;i++)if("r"!=PivotCollection.config.views[i]){var viewName=PivotCollection.config.views[i];PivotViewer.Utils.loadScript("src/views/"+viewName.toLowerCase()+"view.min.js"),eval("var view = new PivotViewer.Views."+viewName.charAt(0).toUpperCase()+viewName.substring(1)+"View()"),view.setOptions(_options),_views.push(view)}else _rEnable=!0;viewPanel.append("<div class='pv-viewpanel-view'></div>");for(var i=0;i<_views.length;i++)_views[i]instanceof PivotViewer.Views.IPivotViewerView&&(_views[i].setup(width,height,offsetX,offsetY,TileController.getMaxTileRatio()),$(".pv-toolbarpanel-viewcontrols").append("<div class='pv-toolbarpanel-view' id='pv-toolbarpanel-view-"+i+"' title='"+_views[i].getViewName()+"'><img id='pv-viewpanel-view-"+i+"-image' src='"+_views[i].getButtonImage()+"' alt='"+_views[i].getViewName()+"' /></div>"));1==_rEnable&&($(".pv-toolbarpanel-viewcontrols").append("<div class='pv-toolbarpanel-view'id='pv-toolbarpanel-view-10' title='Statistical Model'><a href='#pv-open-Model'> <img id='pv-toolbarpanel-view-10-image' src='images/ModelView.png'></a></div>"),$(".pv-toolbarpanel-viewcontrols").append('<div class="modal fade" id="myModal" role="dialog" style="z-index:100000;"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">R result</h4></div><div class="modal-body" ><code><pre id="pv-model-result" style="position: relative;             "></pre></code></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>'),$(".pv-toolbarpanel-viewcontrols").append("<div id='pv-open-Model' class='pv-modal-dialog modal-xl'><div><h2>Statistical Model</h2><div id='pv-model-text'>&nbsp;</div></div></div>")),$(".pv-loading").remove();var controlsWidth=$(".pv-toolbarpanel").innerWidth()-($(".pv-toolbarpanel-brandimage").outerWidth(!0)+25+$(".pv-toolbarpanel-name").outerWidth(!0)+30+$(".pv-toolbarpanel-zoomcontrols").outerWidth(!0)+29*_views.length+2*$(".pv-toolbarpanel-sortcontrols").outerWidth(!0));$(".pv-toolbarpanel-breadcrumb").css("width",controlsWidth+"px");var filterPanel=$(".pv-filterpanel");filterPanel.append("<div class='pv-filterpanel-version'><a href='#pv-open-version'>About</a>&nbsp;<a href='#pv-open-Settings'>Settings</a></div>"),filterPanel.append("<div id='pv-open-version' class='pv-modal-dialog'><div><a href='#pv-modal-dialog-close' title='Close' class='pv-modal-dialog-close'>X</a><h2>SuAVE: <u>Su</u>rvey <u>A</u>nalysis <u>V</u>isualization and <u>E</u>xploration</h2><p>This app was designed and developed at the <a href='www.sdsc.edu'>San Diego Supercomputer Center</a> for the purpose of enabling innovative visualization of common analytical and statistical techniques with the particular application to education.<p>Project Leads:<br>Ilya Zaslavsky, SDSC (<a href='mailto:zaslavsk@sdsc.edu'>zaslavsk@sdsc.edu</a>)<br>Prof. Akos Rona-Tas, UCSD Sociology (<a href='mailto:aronatas@ucsd.edu'>aronatas@ucsd.edu</a>)<br>Prof. Kevin Lewis, UCSD Sociology (<a href='mailto:lewis@ucsd.edu'>lewis@ucsd.edu</a>)<p>Lead Programmer:<br>Ren&eacute; Patnode, UCSD Sociology (<a href='mailto:rpatnode@ucsd.edu'>rpatnode@ucsd.edu</a>)<p>Funded by <a href='http://www.nsf.gov/awardsearch/showAward?AWD_ID=1443082'>NSF Grant ACI-1443082</a>.</div></div>"),filterPanel.append("<div id='pv-open-Settings' class='pv-modal-dialog modal-xl'><div><h2>Settings</h2><div id='pv-options-text'>&nbsp;</div></div></div>");var html="<input type='checkbox' id='show-missing'"+(Settings.showMissing?" checked":"")+"> Display missing values<p><h3>Visible Variables (Double-click to select)</h3><p>";html+="<table><tr><th>All Variables:</th><th>Variables to Display:</th><tr><td><select id='pv-all-columns' multiple style='width:250px' size=20>";for(var i=0;i<PivotCollection.categories.length;i++){var category=PivotCollection.categories[i];html+="<option value="+i+" search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"}if(html+="</select></td><td><select id='pv-column-select' multiple style='width:250px' size=20>",0==Settings.visibleCategories.length)html+="<option value='-1'>Select Variables...</option>";else for(var i=0;i<Settings.visibleCategories.length;i++){var category=PivotCollection.categories[Settings.visibleCategories[i]];html+="<option value="+Settings.visibleCategories[i]+" search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"}html+="</select></td><td width=200><input id='pv-column-search' placeholder='Search For Variable...' type='text' size=20><div class='pv-search-clear' id='pv-column-search-clear'>&nbsp;</div><p><button id='pv-column-select-all'>Select All</button><p><button id='pv-column-deselect-all'>Deselect All</button><p><button id='pv-settings-submit'>Submit</button><p><button id='pv-Settings-cancel'>Cancel</button></td></table>",$("#pv-options-text").html(html);var modelHtml="<p><h3>Press ctrl(Windows)/command(Mac) to select independent variables</h3><p>";modelHtml+="<table><tr><th>Dependent Variable:</th><th>Independent Variables:</th><tr><td><select id='pv-all-variables1' style='width:250px' size=20>";for(var i=0;i<PivotCollection.categories.length;i++){var category=PivotCollection.categories[i];modelHtml+="<option value="+i+" search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"}modelHtml+="</select></td><td><select id='pv-all-variables2' multiple style='width:250px' size=20>";for(var i=0;i<PivotCollection.categories.length;i++){var category=PivotCollection.categories[i];modelHtml+="<option value="+i+" search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"}modelHtml+="</select></td><td width=200><p><select id='pv-select-model'><option>Select Model</option><option>Logit</option><option>Probit</option><option>Log Linear</option></select><p><input id='pv-variables-search' placeholder='Search For Variable...' type='text' size=20><div class='pv-search-clear' id='pv-variables-search-clear'>&nbsp;</div><p><button id='pv-model-submit'>Submit</button></p><p><button id='pv-model-cancel'>Cancel</button></td></table>",$("#pv-model-text").html(modelHtml),$("#pv-all-columns").dblclick(function(a){if(!($("#pv-all-columns option[value='-1']").length>0)){var b=parseFloat($("#pv-all-columns").val()),c=PivotCollection.categories[b];$("#pv-column-select option[value='-1']").length>0&&$("#pv-column-select option[value='-1']").remove();for(var d=$("#pv-column-select option"),e=0;e<d.length&&parseFloat(d[e].value)!=b;e++)if(parseFloat(d[e].value)>b){$(d[e]).before($("<option></option>").attr("search",PV.cleanName(c.name.toLowerCase())).val(b).html(c.name));break}e==d.length&&$("#pv-column-select").append("<option value="+b+" search='"+PV.cleanName(c.name.toLowerCase())+"'>"+c.name+"</option>")}}),$("#pv-column-select").dblclick(function(a){if(!($("#pv-column-select option[value='-1']").length>0)){var b=parseFloat($("#pv-column-select").val());PivotCollection.categories[b];$("#pv-column-select option[value='"+b+"']").remove(),0==$("#pv-column-select option").length&&$("#pv-column-select").append("<option value='-1'>Select Variables...</option>")}}),$("#pv-column-select-all").click(function(a){var b=$("#pv-all-columns option"),c=$("#pv-column-select option");if(b.eq(0).val()!=-1){c.eq(0).val()==-1&&$("#pv-column-select option").remove();for(var d=0,e=0;d<b.length;){var f=parseFloat(b.eq(d).val()),g=PivotCollection.categories[f];e==c.length?($("#pv-column-select").append($("<option></option>").attr("search",PV.cleanName(g.name.toLowerCase())).val(f).html(g.name)),d++):f==parseFloat(c[e].value)?(d++,e++):parseFloat(c[e].value)>f?($(c[e]).before($("<option></option>").attr("search",PV.cleanName(g.name.toLowerCase())).val(f).html(g.name)),d++):e++}}}),$("#pv-column-deselect-all").click(function(a){$("#pv-column-select option").remove(),$("#pv-column-select").append("<option value='-1'>Select Variables...</option>")}),$("#pv-settings-submit").click(function(a){Settings.visibleCategories=[];for(var b=$("#pv-column-select option"),c=0;c<b.length;c++)Settings.visibleCategories.push(b[c].value),Settings.visibleCategories[b[c].innerHTML]=!0;Settings.showMissing=$("#show-missing").prop("checked");var d=Lawnchair({name:PivotCollection.name},function(a,b){});d.save({key:"Settings",value:Settings}),$.publish("/PivotViewer/Settings/Changed",[Settings]),window.open("#pv-modal-dialog-close","_self"),_sortCategory=$("#pv-primsort option").eq(0).html();var e=PivotCollection.getCategoryByName(_sortCategory);e.uiInit||PV.initUICategory(e),LoadSem.acquire(function(a){_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters)),_filterList=[];for(var b=0;b<_tiles.length;b++){var c=_tiles[b];c.missing=!Settings.showMissing&&void 0==c.item.getFacetByName(e.name),c.filtered&&_filterList.push(_tiles[b])}PV.filterViews(),a()})}),$("#pv-Settings-cancel").click(function(a){window.open("#pv-modal-dialog-close","_self"),$("#show-missing").prop("checked",Settings.showMissing),$("#pv-all-columns option").eq(0).val()==-1&&$("#pv-all-columns option").remove(),PV._initAllSelect("#pv-all-columns"),$("#pv-column-select option").eq(0).val()==-1&&$("#pv-column-select option").remove(),PV._initVisibleSelect("#pv-column-select",!0),$("#pv-column-search").val(""),$("#pv-column-search-clear").css("visibility","hidden")}),$("#pv-model-submit").click(function(a){$("#myModal").modal("toggle");var b=$("#pv-all-variables2").val(),c=$("#pv-all-variables1").val();void 0!=b&&void 0!=c||alert("Please select at least one dependent variable, and one independent variable");for(var d="V"+(parseInt(c)+1)+"~",e=b.length,f=0;f<e;f++)0!=f&&(d+="+"),d=d+"V"+(parseInt(b[f])+1);var g=$("#pv-select-model").val();"Select Model"==g?alert("Please select a statistical model"):getModel(g,d)}),$("#pv-model-cancel").click(function(a){window.open("#pv-modal-dialog-close","_self"),$("#pv-all-variables1 option").eq(0).val()==-1&&$("#pv-all-variables1 option").remove(),PV._initAllSelect("#pv-all-variables1"),$("#pv-all-variables2 option").eq(0).val()==-1&&$("#pv-all-variables2 option").remove(),PV._initAllSelect("#pv-all-variables2"),$("#pv-variables-search").val(""),$("#pv-variables-search-clear").css("visibility","hidden")}),$("#pv-column-search").on("keyup",function(a){var b=this.value.toLowerCase();""!=b?($("#pv-all-columns option").eq(0).val()==-1&&$("#pv-all-columns option").remove(),PV._initAllSelect("#pv-all-columns",b),$("#pv-column-search-clear").css("visibility","visible"),0==$("#pv-all-columns option").length&&$("#pv-all-columns").append("<option value='-1' css:'display: block'>No matching variables.</option>")):($("#pv-column-search-clear").css("visibility","hidden"),PV._initAllSelect("#pv-all-columns"))}),$("#pv-column-search-clear").click(function(a){$("#pv-column-search").val(""),$("#pv-column-search-clear").css("visibility","hidden"),$("#pv-all-columns option").eq(0).val()==-1&&$("#pv-all-columns option").remove(),PV._initAllSelect("#pv-all-columns")}),$("#pv-variables-search").on("keyup",function(a){var b=a.target.value.toLowerCase();""!=b?($("#pv-all-variables1 option").eq(0).val()==-1&&$("#pv-all-variables1 option").remove(),PV._initAllSelect("#pv-all-variables1",b),$("#pv-all-variables2 option").eq(0).val()==-1&&$("#pv-all-variables2 option").remove(),PV._initAllSelect("#pv-all-variables2",b),$("#pv-variables-search-clear").css("visibility","visible"),0==$("#pv-all-variables1 option").length&&$("#pv-all-variables1").append("<option value='-1' css:'display: block'>No matching variables.</option>"),0==$("#pv-all-variables2 option").length&&$("#pv-all-variables2").append("<option value='-1' css:'display: block'>No matching variables.</option>")):($("#pv-variables-search-clear").css("visibility","hidden"),PV._initAllSelect("#pv-all-variables1"),PV._initAllSelect("#pv-all-variables2"))}),$("#pv-variables-search-clear").click(function(a){$("#pv-variables-search").val(""),$("#pv-variables-search-clear").css("visibility","hidden"),$("#pv-all-variables1 option").eq(0).val()==-1&&$("#pv-all-variables1 option").remove(),PV._initAllSelect("#pv-all-variables1"),$("#pv-all-variables2 option").eq(0).val()==-1&&$("#pv-all-variables2 option").remove(),PV._initAllSelect("#pv-all-variables2")}),$(".pv-toolbarpanel-view").click(function(a){var b=this.id.substring(this.id.lastIndexOf("-")+1,this.id.length);null!=b&&10!=b&&PV.selectView(parseInt(b))}),$("#pv-primsort").on("change",function(a){_sortCategory=$("#pv-primsort option:selected").html();var b=PivotCollection.getCategoryByName(_sortCategory);b.uiInit||PV.initUICategory(b),LoadSem.acquire(function(a){_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters)),_filterList=[];for(var b=0;b<_tiles.length;b++){var c=_tiles[b];c.missing=!Settings.showMissing&&void 0==c.item.getFacetByName(_sortCategory),c.filtered&&_filterList.push(_tiles[b])}1==_options.authoring&&(PARA.x_axis=_sortCategory),PV.filterViews(),a()})}),$(".pv-facet").click(function(a){PV._filterCategory($(this))}),$(".pv-filterpanel-clearall").click(function(a){var b=$(".pv-facet-value:checked");b.prop("checked",!1);for(var c=0;c<b.length;c++)"CustomRange"==b.eq(c).attr("itemvalue")&&PV._hideCustomDateRange($(b[c]).attr("itemfacet"));var d=$(".pv-facet-numericslider");d.modSlider("clearValues"),d.siblings(".pv-facet-numericslider-range-val").html("&nbsp;"),$(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),$("#pv-long-search-clear").css("visibility","hidden"),$("#pv-long-search").val(""),$(".pv-value-search").val(""),$(".pv-search-clear").css("visibility","hidden"),_longstringFilters=null,PV.filterCollection()}),$(".pv-filterpanel-accordion-heading-clear").click(function(a){$(this).parent().next().find(".pv-value-search").val(""),$(this).parent().next().find(".pv-search-clear").css("visibility","hidden");var b=this.attributes.facetType.value;if("DateTime"==b){var c=$(this).parent().next().find(".pv-facet-value:checked");c.prop("checked",!1);for(var d=0;d<c.length;d++)PV._hideCustomDateRange($(c[d]).attr("itemfacet"))}else if("String"==b){var e=$(this).parent().attr("aria-controls").substring(7),f=_listObj[e],g=f.size();f.page=g,f.update(),$(this).parent().next().find(".pv-facet-value:checked").prop("checked",!1),f.page=10,f.update()}else if("Number"==b||"Ordinal"==b){var h=$(this).parent().next().find(".pv-facet-numericslider");h.modSlider("clearValues"),h.siblings(".pv-facet-numericslider-range-val").html("&nbsp;")}PV.filterCollection(),$(this).css("visibility","hidden")}),$(".pv-facet-customrange").on("change",function(a){PV._changeCustomRange(this)}),$(".pv-infopanel-details").on("click",".detail-item-value-filter",function(a){return $(".pv-facet[aria-controls='pv-cat-"+PV.cleanName($(this).parent().children().attr("pv-detail-item-title"))+"']").trigger("click"),PV.clickValue,$.publish("/PivotViewer/Views/Item/Filtered",[{category:$(this).parent().children().attr("pv-detail-item-title"),min:$(this).attr("pv-detail-item-value"),values:null}]),!1}),$(".pv-infopanel-details").on("click",".pv-infopanel-detail-description-more",function(a){var b=$(this),c=b.prev();"More"==b.text()?(c.css("height",""),b.text("Less")):(c.css("height","100px"),b.text("More"))}),$(".pv-infopanel-controls-navleft").click(function(a){for(var b=1;b<_filterList.length;b++)if(_filterList[b].item.id==_selectedItem.item.id){var c=_filterList[b-1];$.publish("/PivotViewer/Views/Item/Selected",[{item:c}]),_views[_currentView].centerOnTile(c);break}}),$(".pv-infopanel-controls-navright").click(function(a){for(var b=0;b<_filterList.length-1;b++)if(_filterList[b].item.id==_selectedItem.item.id){var c=_filterList[b+1];$.publish("/PivotViewer/Views/Item/Selected",[{item:c}]),_views[_currentView].centerOnTile(c);break}}),$(".pv-toolbarpanel-sort").on("mousedown",function(a){1==$(this).attr("dirty")&&PV._initVisibleSelect("#"+$(this).attr("id"),!1,PV.cleanName($(".pv-filterpanel-search").val().toLowerCase())),$(this).attr("dirty",0)}),$(".pv-value-search").on("keyup",function(a){var b=PV.cleanName(this.value.toLowerCase());if(""!=b){var c=PivotCollection.getCategoryByName(_nameMapping[$(".pv-facet").eq($(".pv-filterpanel-accordion").accordion("option","active")).attr("facet")]),d=[];(c.isString()||c.isLocation())&&c.name.toLowerCase().indexOf(b)==-1&&(d=$('.pv-filterpanel-accordion-facet-list-item[id^="pv-facet-value-'+PV.cleanName(c.name)+'"]'),d.hide(),d=d.filter(function(){return PV.cleanName($(this).children().eq(0).attr("itemvalue").toLowerCase()).indexOf(b)>=0&&$(this).children().eq(2).html()>0}),d.show())}else $(".pv-filterpanel-accordion-facet-list-item").show()}),$("#pv-value-search-clear").click(function(a){$(".pv-value-search").val(""),$("#pv-value-search-clear").css("visibility","hidden"),$(".pv-filterpanel-accordion").accordion("option","collapsible",!1),$(".pv-filterpanel-accordion-facet-list-item").show()}),$(".pv-filterpanel-search").on("keyup",function(a){var b=PV.cleanName(this.value.toLowerCase());if(""!=b){var c=$(".pv-facet[facet*='"+b+"'][visible='visible']");if(c.show(),$(".pv-toolbarpanel-sort").attr("dirty",1),$("#pv-long-search-cat").attr("dirty",1),$("#pv-long-search-cat").val($("#pv-long-search-cat option[value*='"+b+"']").eq(0).val()),$(".pv-facet:not([facet*='"+b+"'][visible='visible'])").hide(),$("#pv-filterpanel-search-clear").css("visibility","visible"),c.length>0){var d=PivotCollection.getCategoryByName(_nameMapping[c.eq(0).attr("facet")]);d.uiInit||PV.initUICategory(d),LoadSem.acquire(function(a){$(".pv-filterpanel-accordion").accordion("option","collapsible",!1),$(".pv-filterpanel-accordion").accordion("option","active",d.visIndex),PV._filterCategory(c.eq(0)),a()})}else $(".pv-filterpanel-accordion").accordion("option","collapsible",!0),$(".pv-filterpanel-accordion").accordion("option","active",!1)}else $(".pv-facet[visible='visible']").show(),$(".pv-toolbarpanel-sort").attr("dirty",1),$("#pv-long-search-cat").attr("dirty",1),$(".pv-filterpanel-accordion").accordion("option","collapsible",!1),$("#pv-filterpanel-search-clear").css("visibility","hidden")}),$("#pv-filterpanel-search-clear").click(function(a){$(".pv-filterpanel-search").val(""),$(".pv-toolbarpanel-sort").attr("dirty",1),$("#pv-long-search-cat").attr("dirty",1),$("#pv-filterpanel-search-clear").css("visibility","hidden"),$(".pv-filterpanel-accordion").accordion("option","collapsible",!1),$(".pv-facet[visible='visible']").show()});var delay=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),canvas=$(".pv-canvas");if($.subscribe("/PivotViewer/ImageController/Selected",function(a){_tooltip_item=a}),$.subscribe("/PivotViewer/ImageController/TooltipEnable",function(a){_tooltip_enable=a}),$('<div class="tooltip">test</div>').appendTo("body"),canvas.on("mousemove",function(a){clearTimeout(timeout),$("div.tooltip").hide(),_tooltip_enable&&(timeout=setTimeout(function(){if(null!=_tooltip_item&&_tooltip_item.isSelected()){var b=a.pageX+10,c=a.pageY-20;$("div.tooltip").text(_tooltip_item.item.name),$("div.tooltip").css({position:"absolute",color:"white",background:"grey","border-radius":5,padding:5,border:1,top:c,left:b,"z-index":999}),$("div.tooltip").show()}},750))}),canvas.mouseup(function(a){if(1!=a.which)return!1;var b=$(this).offset();(!_mouseMove||0==_mouseMove.x&&0==_mouseMove.y)&&PV.getCurrentView().handleClick({x:a.pageX-b.left,y:a.pageY-b.top}),_mouseDrag=null,_mouseMove=!1}),canvas.mouseout(function(a){_mouseDrag=null,_mouseMove=!1}),canvas.mousedown(function(a){if(1!=a.which)return!1;var b=$(this).offset(),c=a.pageX-b.left,d=a.pageY-b.top;_mouseDrag={x:c,y:d}}),canvas.mousemove(function(a){var b=$(this).offset(),c=a.pageX-b.left,d=a.pageY-b.top;
null==_mouseDrag?PV.getCurrentView().handleHover({x:c,y:d}):(_mouseMove={x:c-_mouseDrag.x,y:d-_mouseDrag.y},_mouseDrag={x:c,y:d},$.publish("/PivotViewer/Views/Canvas/Drag",[_mouseMove]))}),canvas.on("mousewheel",function(a,b){var c=$(this).offset();TileController.setQuarticEasingOut();var d=$(".pv-toolbarpanel-zoomslider").slider("option","value");b>0?d=d<5?5:d+5:b<0&&(d-=5),d=Math.max(0,Math.min(100,d)),PV.zoom(d,a.pageX-c.left,a.pageY-c.top)}),canvas.on("contextmenu",function(a){var b=$(this).offset();PV.getCurrentView().handleContextMenu({x:a.pageX-b.left,y:a.pageY-b.top})}),canvas.on("touchstart",function(a){var b=a.originalEvent,c=$(this).offset();_mouseDrag={x:b.touches[0].pageX-c.left,y:b.touches[0].pageY-c.top}}),canvas.on("touchmove",function(a){try{var b=a.originalEvent;if(a.preventDefault(),b.touches.length>1){a.preventDefault();for(var c=1e7,d=1e7,e=0,f=0,g=0;g<b.touches.length;g++)b.touches[g].pageX<c&&(c=b.touches[g].pageX),b.touches[g].pageX>e&&(e=b.touches[g].pageX),b.touches[g].pageY<d&&(d=b.touches[g].pageY),b.touches[g].pageY>f&&(f=b.touches[g].pageY);var h=(c+e)/2,i=(d+f)/2;return TileController.setLinearEasingBoth(),void $.publish("/PivotViewer/Views/Canvas/Zoom",[{x:h,y:i,scale:b.scale}])}var j=$(this).offset(),k=b.touches[0].pageX-j.left,l=b.touches[0].pageY-j.top;_mouseMove={x:k-_mouseDrag.x,y:l-_mouseDrag.y},_mouseDrag={x:k,y:l},$.publish("/PivotViewer/Views/Canvas/Drag",[_mouseMove])}catch(a){Debug.log(a.message)}}),canvas.on("touchend",function(a){var b=a.originalEvent;if(1==b.touches.length&&null==_mouseDrag){var c=$(this).offset(),d=b.touches[0].pageX-c.left,e=b.touches[0].pageY-c.top;(!_mouseMove||0==_mouseMove.x&&0==_mouseMove.y)&&PV.getCurrentView().handleClick({x:d,y:e})}_mouseDrag=null,_mouseMove=!1}),_options.parameter){var para=_options.parameter;para.view&&(_options.View=para.view)}_sortCategory=$("#pv-primsort option").eq(0).html(),1==_options.authoring&&(PARA.x_axis=_sortCategory);var category=PivotCollection.getCategoryByName(_sortCategory);category.uiInit||PV.initUICategory(category),LoadSem.acquire(function(a){_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters));for(var b=0;b<_tiles.length;b++){var c=_tiles[b];c.missing=!Settings.showMissing&&void 0==c.item.getFacetByName(_sortCategory)}if(PV.filterCollection(),_options.parameter){var d=_options.parameter;if(d.string_filters)for(var b=0;b<d.string_filters.length;b++)PV.presetStrFilters(d,b);if(d.num_filters)for(var b=0;b<d.num_filters.length;b++)PV.presetNumFilters(d,b)}if(Settings.visibleCategories.length<PivotCollection.categories.length?$.publish("/PivotViewer/Settings/Changed",[Settings]):$(".pv-facet").attr("visible","visible"),void 0!=_options.View?PV.selectView(_options.View):PV.selectView(0),TileController.beginAnimation(),window.parent.$("#modal-loading").modal("hide"),_options.parameter){var d=_options.parameter;d.x_axis&&($("#pv-primsort option[search='"+PV.cleanName(d.x_axis.toLowerCase())+"']").prop("selected",!0),$("#pv-primsort").trigger("change")),"crosstab"==d.view&&($("#pv-altsort option[search='"+PV.cleanName(d.y_axis.toLowerCase())+"']").prop("selected",!0),$("#pv-altsort").trigger("change")),d.selected_id!=-1&&(1==_options.authoring&&(PARA.selected_loc=d.selected_loc),"map"==d.view?$(".pv-viewpanel-view").promise().done(function(){setTimeout(function(){for(var a=0;a<_filterList.length;a++){var b=_filterList[a].item.id;if(b==d.selected_id){$.publish("/PivotViewer/Views/Item/Selected",[{item:_filterList[a]}]);break}}},3e3)}):$(".pv-viewpanel-view").promise().done(function(){var a=_filterList.length;a*=a<100?200:a<500?5:4,setTimeout(function(){PV.getCurrentView().handleClick({type:"init",id:d.selected_id})},a)}))}a()}),$(window).resize(function(){$(".pv-canvas").width()==_self.width()&&$(".pv-mainpanel").height()==$(window).height()-$(".pv-toolbarpanel").height()-30||delay(function(){$("#ruleModal").hasClass("in")&&$(".modal-backdrop").remove();var a=$(window).height()-$(".pv-toolbarpanel").height()-30;$(".pv-mainpanel").css("height",a+"px");var b=$(".pv-infopanel");b.css("left",$(".pv-mainpanel").offset().left+$(".pv-mainpanel").width()-205+"px").css("height",a-28+"px"),$(".pv-canvas").css("width",_self.width()),$(".pv-canvas").css("height",a);var c=$(".pv-filterpanel");c.css("height",a-13+"px"),$(".pv-filterpanel-search").css("width",c.width()-15+"px"),$(".pv-filterpanel-accordion").css("height",$(".pv-filterpanel").height()-$(".pv-filterpanel-search").height()-75-$("#pv-long-search-box").height()+"px"),$(".pv-filterpanel-accordion").accordion({icons:!1});var d=$(".pv-altinfopanel");d&&(c.css("height",a-13+"px"),$(".pv-altinfopanel").css("left",$(".pv-mainpanel").offset().left+$(".pv-mainpanel").width()-205+"px").css("height",$(window).height()-$(".pv-toolbarpanel").height()-58+"px"));for(var e=_self.width(),f=$(".pv-mainpanel").height(),g=$(".pv-filterpanel").width()+18,h=4,i=0;i<_views.length;i++)_views[i]instanceof PivotViewer.Views.IPivotViewerView&&_views[i].setup(e,f,g,h,TileController.getMaxTileRatio());_views[_currentView].activate(),PV.filterCollection()},300)})}),PV.presetNumFilters=function(a,b){setTimeout(function(){var c=a.num_filters[b];$(".pv-facet[aria-controls='pv-cat-"+PV.cleanName(c.facet)+"']").trigger("click"),$("#pv-cat-"+PV.cleanName(c.facet)).promise().done(function(){var a=$("#pv-facet-numericslider-"+PivotViewer.Utils.escapeMetaChars(PV.cleanName(c.facet)));PV.dragCategorySlider(a,c.selectedMin,c.selectedMax,!0)})},10)},PV.presetStrFilters=function(a,b){setTimeout(function(){$(".pv-facet[aria-controls='pv-cat-"+PV.cleanName(a.string_filters[b].facet)+"']").trigger("click");var c=_listObj[a.string_filters[b].facet],d=c.size();c.page=d,c.update();for(var e in a.string_filters[b].value)PV.setStrFilterValues(a,e,b);c.page=10,c.update()},10)},PV.setStrFilterValues=function(a,b,c){"#pv-facet-value-"+PV.cleanName(a.string_filters[c].facet);$(".pv-facet-value[itemvalue='"+PV.cleanName(a.string_filters[c].value[b])+"'][itemfacet='"+PV.cleanName(a.string_filters[c].facet)+"']").trigger("click")};var oldValue=0;PV.zoom=function(a,b,c){a>100&&(a=100),void 0==b&&(b=$(".pv-canvas").width()/2),void 0==c&&(c=$(".pv-canvas").height()/2),$(".pv-toolbarpanel-zoomslider").slider("option","value",a),$.publish("/PivotViewer/Views/Canvas/Zoom",[{x:b,y:c,delta:.5*(a-oldValue)}]),oldValue=a},PV._initAllSelect=function(a,b){void 0==b&&(b="");for(var c=$(a),d=0;d<c.length;d++){var e=c.eq(d).val();c.eq(d).children().remove();for(var f=0;f<PivotCollection.categories.length;f++){var g=PivotCollection.categories[f];f!=e&&g.name.toLowerCase().indexOf(b)==-1||c.eq(d).append("<option value="+f+" search='"+PV.cleanName(g.name.toLowerCase())+"'>"+g.name+"</option>")}c.eq(d).val(e)}},PV._initAllVisible=function(a,b){void 0==b&&(b="");for(var c=$(a),d=0;d<c.length;d++){var e=c.eq(d).val();c.eq(d).children().remove();for(var f=0;f<PivotCollection.categories.length;f++){var g=PivotCollection.categories[f];f!=e&&g.name.toLowerCase().indexOf(b)==-1||c.eq(d).append("<option value="+f+" search='"+PV.cleanName(g.name.toLowerCase())+"'>"+g.name+"</option>")}c.eq(d).val(e)}},PV._initVisibleSelect=function(a,b,c){void 0==c&&(c=""),void 0==b&&(b=!1);for(var d=$(a),e=0;e<d.length;e++){var f=d.eq(e).val();d.eq(e).children().remove();for(var g=0;g<Settings.visibleCategories.length;g++){var h=Settings.visibleCategories[g],i=PivotCollection.categories[h];!(i.isFilterVisible&&!i.isLongString()||b)||h!=f&&PV.cleanName(i.name).toLowerCase().indexOf(c)==-1||d.eq(e).append("<option value="+Settings.visibleCategories[g]+" search='"+PV.cleanName(i.name.toLowerCase())+"'>"+i.name+"</option>")}d.eq(e).val(f)}},$.subscribe("/PivotViewer/Views/Item/Selected",function(a){if(void 0===a.item||null==a.item)return PV.deselectInfoPanel(),null!=_selectedItem&&_selectedItem.setSelected(!1),_views[_currentView].setSelected(null),void(1==_options.authoring&&(PARA.selected_id=-1,PARA.selected_loc=-1));var b=a.item;if(1==_options.authoring&&(PARA.selected_id=a.item.item.id),null!=b){var c=!0;$(".pv-infopanel-heading").empty(),$(".pv-infopanel-heading").append('<a href="'+b.item.href+'" target="_blank">'+b.item.name+"</a></div>");var d=$(".pv-infopanel-details");d.empty(),void 0!=b.item.description&&b.item.description.length>0&&d.append("<div class='pv-infopanel-detail-description' style='height:100px;'>"+b.item.description+"</div><div class='pv-infopanel-detail-description-more'>More</div>"),b.item.id==_filterList[0].id?($(".pv-infopanel-controls-navleft").hide(),$(".pv-infopanel-controls-navleftdisabled").show()):($(".pv-infopanel-controls-navleft").show(),$(".pv-infopanel-controls-navleftdisabled").hide()),b.item.id==_filterList[_filterList.length-1].id?($(".pv-infopanel-controls-navright").hide(),$(".pv-infopanel-controls-navrightdisabled").show()):($(".pv-infopanel-controls-navright").show(),$(".pv-infopanel-controls-navrightdisabled").hide());for(var e=[],f=Loader.getRow(b.item.id),g=0;g<f.length;g++){var h=PivotCollection.getCategoryByName(f[g].name);if(Settings.visibleCategories[h.name]){e[g]="<div class='pv-infopanel-detail "+(c?"detail-dark":"detail-light")+"'><div class='pv-infopanel-detail-item detail-item-title' pv-detail-item-title='"+h.name+"'>"+h.name+"</div>";for(var i=0;i<f[g].values.length;i++){var j=f[g].values[i];e[g]+="<div pv-detail-item-value='"+j.value+"' class='pv-infopanel-detail-item detail-item-value"+(h.isFilterVisible?" detail-item-value-filter":"")+"'>",null!=j.href&&""!=j.href?e[g]+="<a class='detail-item-link' href='"+j.href+"' target='_blank'>"+j.label+"</a>":e[g]+=j.label,e[g]+="</div>"}e[g]+="</div>",c=!c}}if(b.item.links.length>0){$(".pv-infopanel-related").empty();for(var k=0;k<b.item.links.length;k++)$(".pv-infopanel-related").append("<a href='"+b.item.links[k].href+"'>"+b.item.links[k].name+"</a><br>")}d.append(e.join("")),$(".pv-infopanel").fadeIn(),d.css("height",$(".pv-infopanel").height()-($(".pv-infopanel-controls").height()+$(".pv-infopanel-heading").height()+$(".pv-infopanel-copyright").height()+$(".pv-infopanel-related").height())-20+"px"),null!=_selectedItem&&_selectedItem.setSelected(!1),b.setSelected(!0),_selectedItem=b,_views[_currentView].setSelected(_selectedItem)}}),$.subscribe("/PivotViewer/Views/Item/Filtered",function(a){if(void 0!=a&&null!=a){for(var b=void 0!=a.length?a:[a],c=0;c<b.length;c++){var d=b[c],e=PivotCollection.getCategoryByName(d.category);e.uiInit||(PV.initUICategory(e),e.isNumber()?PV._refreshNumberWidget(e,_numericItemTotals[e.name].values):e.isOrdinal()&&PV._refreshOrdinalWidget(e,_ordinalItemTotals[e.name].values)),LoadSem.acquire(function(a){if(e.isString()||e.isLocation()){var c=_listObj[PV.cleanName(e.name)],f=c.size();if(c.page=f,c.update(),$(".pv-facet-value[itemfacet='"+PV.cleanName(e.name)+"']").prop("checked",!1),d.values){if(1==d.values.length){var g=$(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(e.name)+"__"+PV.cleanName(d.values[0].toString()))+" input");g.prop("checked",!0),1==b.length&&PV.clickValue(g[0])}else if(d.values.length>0){for(var h=0;h<d.values.length;h++)$(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(e.name)+"__"+PV.cleanName(d.values[h].toString()))+" input").prop("checked",!0);$(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(e.name)+"__"+PV.cleanName(d.values[0].toString()))+" input").parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"),1==b.length&&PV.filterCollection()}}else{var g=$(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(e.name)+"__"+PV.cleanName(d.min.toString()))+" input");g.prop("checked",!0),1==b.length&&PV.clickValue(g[0])}c.page=10,c.update()}else if(e.isNumber()||e.isOrdinal()){var i=$("#pv-facet-numericslider-"+PivotViewer.Utils.escapeMetaChars(PV.cleanName(e.name)));void 0==d.max&&(d.max=d.min),PV.dragCategorySlider(i,d.min,d.max,1==b.length)}else if(e.isDateTime()){var j=PV.cleanName(e.name);$("#pv-facet-value-"+j+"__CustomRange:first-child").prop("checked",!0),PV._getCustomDateRange(j);var k=$("#pv-custom-range-"+j+"__StartDate"),l=$("#pv-custom-range-"+j+"__FinishDate"),m=new Date(d.min),n=new Date(d.max);k[0].value=m.getMonth()+1+"/"+m.getDate()+"/"+m.getFullYear(),l[0].value=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear(),k.datepicker("option","minDate",m),l.datepicker("option","maxDate",n);var o=$(k).parent().parent().parent().parent().children().next().find(".pv-facet-value:checked");o.find("[itemvalue!='CustomRange']").prop("checked",!1),o.parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"),1==b.length&&PV.filterCollection()}a()})}b.length>1&&PV.filterCollection()}}),PV.clickValue=function(a){var e,f,b=PivotCollection.getCategoryByName(_nameMapping[$(a).attr("itemfacet")]),c=_listObj[$(a).attr("itemfacet")],d=_nameMapping[$(a).attr("itemvalue")];if($(a).prop("checked")){if($(a).parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"),"CustomRange"==$(a).attr("itemvalue"))return void PV._getCustomDateRange($(a).attr("itemfacet"));if(b.isDateTime())e=$("input[itemfacet|='"+$(a).attr("itemfacet")+"']:checked").length>1;else{for(var g=0,h=0;h<c.items.length;h++)1==c.items[h].elm.childNodes[0].checked&&(g+=1);e=g>1}f=!1}else if(!$(a).prop("checked")){"CustomRange"==$(a).attr("itemvalue")&&PV._hideCustomDateRange($(a).attr("itemfacet"));var g=0;if(b.isDateTime())g=$("input[itemfacet|='"+$(a).attr("itemfacet")+"']:checked").length;else for(var h=0;h<c.items.length;h++)1==c.items[h].elm.childNodes[0].checked&&(g+=1);if(0==g)return e=!0,$(a).parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").trigger("click"),void(f=!0);e=!1,f=!1}b.isString()||b.isLocation()?PV.filterCollection({category:b,enlarge:e,clear:f,value:d,listPage:c}):(start=$(a).attr("startdate"),end=$(a).attr("enddate"),PV.filterCollection({category:b,enlarge:e,clear:f,value:d,min:new Date(start),max:new Date(end)}))},PV.dragCategorySlider=function(a,b,c,d){var e=$(a),f=e.modSlider("option","min"),g=e.modSlider("option","max");"(no info)"==b&&(b=0),b>f||c<g?(e.parent().find(".pv-facet-numericslider-range-val").text(b+" - "+c),e.modSlider("values",0,b),e.modSlider("values",1,c),e.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible")):b==f&&c==g&&e.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),0!=d&&PV.filterCollection()},PV._bucketize=function(a,b,c,d,e){void 0==a[b]&&(a[b]=[]);var f=a[b],g=f[c+"a"];void 0!=g?(g.items[d+"a"]=d,g.items.push(d),g.start>e?g.start=e:g.end<e&&(g.end=e)):(g=new PivotViewer.Models.DateTimeInfo(c,e,e),g.items[d+"a"]=d,g.items.push(d),f.push(g),f[c+"a"]=g)},PV._createDatetimeBuckets=function(a){for(var b=new Date(864e13),c=new Date(-864e13),d=!1,e=!1,f=!1,g=0;g<PivotCollection.items.length;g++){var h=PivotCollection.items[g],i=h.getFacetByName(a.name);if(void 0!=i){var j=new Date(i.values[0].value);j<b&&(b=j),j>c&&(c=j),0!=j.getHours()&&(d=!0),0!=j.getMinutes()&&(e=!0),0!=j.getSeconds()&&(f=!0)}}for(var k=c.getFullYear()-b.getFullYear()+b.getFullYear()%10>9,l=c.getFullYear()>b.getFullYear(),m=l||c.getMonth()>b.getMonth(),n=m||c.getDate()>b.getDate(),g=0;g<PivotCollection.items.length;g++){var h=PivotCollection.items[g],i=h.getFacetByName(a.name);if(void 0!=i){var j=new Date(i.values[0].value),o=0,p=j.getFullYear(),q=p-p%10;k&&PV._bucketize(a.datetimeBuckets,o++,q+"s",h.id,j),l&&PV._bucketize(a.datetimeBuckets,o++,p,h.id,j);var r=PivotViewer.Utils.getMonthName(j);m&&PV._bucketize(a.datetimeBuckets,o++,r+", "+p,h.id,j);var s=j.getDate();n&&PV._bucketize(a.datetimeBuckets,o++,r+" "+s+", "+p,h.id,j);var t=PivotViewer.Utils.getHour(j),u=PivotViewer.Utils.getMeridian(j);d&&PV._bucketize(a.datetimeBuckets,o++,r+" "+s+", "+p+" "+t+" "+u,h.id,j);var v=PivotViewer.Utils.getMinutes(j);e&&PV._bucketize(a.datetimeBuckets,o++,r+" "+s+", "+p+" "+t+":"+v+" "+u,h.id,j);var w=PivotViewer.Utils.getSeconds(j);f&&PV._bucketize(a.datetimeBuckets,o,r+" "+s+", "+p+" "+t+":"+v+":"+w+" "+u,h.id,j)}}for(var g=0;g<a.datetimeBuckets.length;g++)a.datetimeBuckets[g].sort(function(a,b){return a.start-b.start});var o=0;k&&(a.datetimeBuckets.decade=a.datetimeBuckets[o++]),l&&(a.datetimeBuckets.year=a.datetimeBuckets[o++]),m&&(a.datetimeBuckets.month=a.datetimeBuckets[o++]),n&&(a.datetimeBuckets.day=a.datetimeBuckets[o++]),d&&(a.datetimeBuckets.hour=a.datetimeBuckets[o++]),e&&(a.datetimeBuckets.minute=a.datetimeBuckets[o++]),f&&(a.datetimeBuckets.second=a.datetimeBuckets[o])},PV._hideCustomDateRange=function(a){$("#pv-custom-range-"+a+"__Start").css("visibility","hidden"),$("#pv-custom-range-"+a+"__Finish").css("visibility","hidden"),$("#pv-custom-range-"+a+"__StartDate").datepicker("setDate",null),$("#pv-custom-range-"+a+"__FinishDate").datepicker("setDate",null),$("#pv-custom-range-"+a+"__FinishDate").datepicker("option","minDate",null),$("#pv-custom-range-"+a+"__StartDate").datepicker("option","minDate",null),$("#pv-custom-range-"+a+"__FinishDate").datepicker("option","maxDate",null),$("#pv-custom-range-"+a+"__StartDate").datepicker("option","maxDate",null)},PV._getCustomDateRange=function(a){var d,e,f,g,b=_nameMapping[a],c=PivotCollection.getCategoryByName(b);$("#pv-custom-range-"+a+"__Start").css("visibility","visible"),$("#pv-custom-range-"+a+"__Finish").css("visibility","visible"),$("#pv-custom-range-"+a+"__StartDate").datepicker({showOn:"button",changeMonth:!0,changeYear:!0,buttonText:"Show Date",buttonImageOnly:!0,buttonImage:"http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"}),$("#pv-custom-range-"+a+"__FinishDate").datepicker({showOn:"button",changeMonth:!0,changeYear:!0,buttonText:"Show Date",buttonImageOnly:!0,buttonImage:"http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"}),void 0!=c.datetimeBuckets.day&&c.datetimeBuckets.day.length>0&&(f=c.datetimeBuckets.day[c.datetimeBuckets.day.length-1].start,g=c.datetimeBuckets.day[0].start,$("#pv-custom-range-"+a+"__StartDate").datepicker("option","defaultDate",g),$("#pv-custom-range-"+a+"__FinishDate").datepicker("option","defaultDate",f),void 0!=c.datetimeBuckets.year&&c.datetimeBuckets.year.length>0&&(d=c.datetimeBuckets.year[c.datetimeBuckets.year.length-1].name,e=c.datetimeBuckets.year[0].name,$("#pv-custom-range-"+a+"__StartDate").datepicker("option","yearRange",e+":"+d),$("#pv-custom-range-"+a+"__FinishDate").datepicker("option","yearRange",e+":"+d)))},PV._changeCustomRange=function(a){var b,c;if("CustomRangeStart"==$(a).attr("itemvalue")?(b=$(a)[0].value,c=$("#pv-custom-range-"+$(a).attr("itemfacet")+"__FinishDate")[0].value,""==c&&$("#pv-custom-range-"+$(a).attr("itemfacet")+"__FinishDate").datepicker("option","minDate",new Date(b))):"CustomRangeFinish"==$(a).attr("itemvalue")&&(c=$(a)[0].value,b=$("#pv-custom-range-"+$(a).attr("itemfacet")+"__StartDate")[0].value,""==b&&$("#pv-custom-range-"+$(a).attr("itemfacet")+"__StartDate").datepicker("option","maxDate",new Date(c))),b&&c){for(var d=$(a).parent().parent().parent().parent().children().next().find(".pv-facet-value:checked"),e=0;e<d.length;e++)"CustomRange"!=$(d[e]).attr("itemvalue")&&$(d[e]).prop("checked",!1);PV.filterCollection()}},$.fn.PivotViewer=function(a){return methods[a]?methods[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void $.error("Method "+a+" does not exist on jQuery.PivotViewer"):methods.init.apply(this,arguments)}}(jQuery);
